<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Silence</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2020-09-06T15:02:06.325Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>Silence</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>CPP-C++学习笔记</title>
    <link href="http://yoursite.com/2020/09/06/CPP-C++%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    <id>http://yoursite.com/2020/09/06/CPP-C++%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</id>
    <published>2020-09-06T15:01:22.688Z</published>
    <updated>2020-09-06T15:02:06.325Z</updated>
    
    <content type="html"><![CDATA[<ul><li>全文共<code>2981</code>字，为暑期C++学习记录，推荐按照顺序阅读。</li></ul><a id="more"></a><h2 id="头文件"><a href="#头文件" class="headerlink" title="头文件"></a>头文件</h2><ul><li><p>每个<code>.h</code>文件智能定义一个<code>class</code></p></li><li><p>函数主体放在<code>.cpp</code>中</p></li><li><p><code>.h</code>文件需要使用标准头文件格式</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> _NAME_H_</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _NAME_H_</span></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure></li></ul><h2 id="成员变量"><a href="#成员变量" class="headerlink" title="成员变量"></a>成员变量</h2><ul><li>变量是对象自己的</li><li>函数是类的<ul><li>隐藏了<code>this</code>参数将对象传进类的函数</li></ul></li><li>私有变量通过<code>::</code>也<strong>不能</strong>访问</li></ul><h2 id="构造与析构"><a href="#构造与析构" class="headerlink" title="构造与析构"></a>构造与析构</h2><h3 id="构造函数"><a href="#构造函数" class="headerlink" title="构造函数"></a>构造函数</h3><ul><li><p>创建对象时使用</p></li><li><p>和类同名</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    A(); <span class="comment">// no return type</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">A::A()</span><br><span class="line">&#123;</span><br><span class="line">    i = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><strong>没有参数</strong>的构造函数<strong>都叫</strong><code>default constructor</code>，不一定是编译器默认创造的。</p></blockquote></li><li><p>参数化</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tree</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> height;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    Tree(<span class="keyword">int</span> i);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Tree::Tree(<span class="keyword">int</span> i)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">Tree <span class="title">t</span><span class="params">(<span class="number">12</span>)</span></span>;</span><br></pre></td></tr></table></figure></li><li><p>创建对象</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MyClass c1;<span class="comment">//表示使用不带参数的构造函数，或者有默认参数值的构造函数。</span></span><br><span class="line"><span class="function">MyClass <span class="title">c2</span><span class="params">()</span></span>;<span class="comment">//不会调用无参构造函数,各种情况下该处是声明一个返回值为MyClass类型的函数而已</span></span><br><span class="line"><span class="function">MyClass <span class="title">c3</span><span class="params">(<span class="number">1</span>)</span></span>;<span class="comment">//调用参数为int的构造函数</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="析构函数"><a href="#析构函数" class="headerlink" title="析构函数"></a>析构函数</h3><ul><li><p>销毁对象时使用</p><blockquote><p>对象的生存周期是<strong>大括号</strong></p></blockquote></li><li><p>无参数，在构造函数前加一个<code>~</code>.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tree</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">int</span> height; <span class="comment">// default to be private</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    Tree(<span class="keyword">int</span> initialHeight);</span><br><span class="line">    ~Tree();</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">grow</span><span class="params">(<span class="keyword">int</span> years)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">printSize</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li></ul><h2 id="new-amp-delete"><a href="#new-amp-delete" class="headerlink" title="new&amp;delete"></a>new&amp;delete</h2><ul><li><p>delete不能操作没有new的空间</p></li><li><p>delete对同一个对象不能连续使用两次</p></li><li><p>delete[]和new[]需要<strong>成对</strong>使用</p></li><li><p>在delete之前最好判断一下是否是空指针（是空指针<strong>大多数情况</strong>也安全）</p></li><li><p>new创建对象</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*---------------对于new关键字加括号和不加括号的区别---</span></span><br><span class="line"><span class="comment">1.对于自定义类型来说没有区别，都是使用默认构造函数</span></span><br><span class="line"><span class="comment">2.对于内置类型来说加括号会初始化</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">cout</span>&lt;&lt;<span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">MyClass *c4 = <span class="keyword">new</span> MyClass();</span><br><span class="line">c4-&gt;MyMethod();</span><br><span class="line">MyClass *c5 = <span class="keyword">new</span> MyClass(<span class="number">1</span>);</span><br><span class="line">c5-&gt;MyMethod();</span><br><span class="line">MyClass *c6 = <span class="keyword">new</span> MyClass;</span><br><span class="line">c6-&gt;MyMethod();</span><br><span class="line"></span><br><span class="line"><span class="comment">//内置类型</span></span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">cout</span>&lt;&lt;<span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"><span class="keyword">int</span> *pint1 = <span class="keyword">new</span> <span class="keyword">int</span>(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">int</span> *pint2 = <span class="keyword">new</span> <span class="keyword">int</span>(); <span class="comment">// *pint2 is 0</span></span><br><span class="line"><span class="keyword">int</span> *pint3 = <span class="keyword">new</span> <span class="keyword">int</span>; <span class="comment">// *pint3 is a random number</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">cout</span>&lt;&lt;*pint1&lt;&lt;<span class="string">" "</span>&lt;&lt;*pint2&lt;&lt;<span class="string">" "</span>&lt;&lt;*pint3&lt;&lt;<span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br></pre></td></tr></table></figure><ul><li><code>new</code>创建对象需要<strong>指针</strong>接收</li><li><code>new</code>创建对象需要<code>delete</code>销毁</li><li><code>new</code>创建的对象在<strong>堆</strong>上，不使用<code>new</code>创建的对象在<strong>栈</strong>上。</li></ul></li></ul><h2 id="访问限制"><a href="#访问限制" class="headerlink" title="访问限制"></a>访问限制</h2><ul><li><p><code>private</code>的变量在类的函数中可以被<strong>其他的对象</strong>访问，即同类对象可以相互访问私有变量。</p><blockquote><p><code>private</code>只在编译时有限制</p></blockquote></li><li><p>使用<code>friend</code>授权某些函数访问<strong>私有变量</strong></p></li><li><p>class的访问属性默认为<code>private</code>，struct默认为<code>public</code>.</p></li></ul><h2 id="初始化列表"><a href="#初始化列表" class="headerlink" title="初始化列表"></a>初始化列表</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Point</span> &#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">float</span> x, y;</span><br><span class="line">    Point(<span class="keyword">float</span> xa = <span class="number">0.0</span>, <span class="keyword">float</span> ya = <span class="number">0.0</span>): x(xa), y(ya)&#123;&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li><p>初始化列表在构造函数<strong>之前</strong>执行</p></li><li><p>和构造器赋值的区别</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Student::Student(String s): name(s)&#123;&#125;</span><br><span class="line">Student::Student(String s) &#123;name = s;&#125;</span><br></pre></td></tr></table></figure><blockquote><p>推荐使用初始化列表进行对象的初始化。</p><p>在构造器赋值时，如果有一个成员变量是自定义类的对象，并且该类没有无参数构造函数，那么在构造函数中对该对象赋值时就会报错。（因为在<strong>构造函数</strong>中，会默认调用无参数构造函数）</p></blockquote></li></ul><h2 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h2><ul><li><p>名称隐藏：当子类覆写父类函数时，所有的父类函数都会被子类屏蔽。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    A(<span class="keyword">int</span> ii) : i(ii) &#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">(<span class="keyword">int</span> arg)</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> :</span> <span class="keyword">public</span> A</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    B() : A(<span class="number">15</span>) &#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">(<span class="keyword">char</span> c)</span> </span>&#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    B b;</span><br><span class="line">    b.print(<span class="string">'c'</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><code>b</code><strong>没有</strong>无参数的<code>print</code>方法</p></blockquote></li></ul><h2 id="默认参数值"><a href="#默认参数值" class="headerlink" title="默认参数值"></a>默认参数值</h2><ul><li><p>只能在<code>.h</code>（函数声明）时设置默认值，<strong>不可以</strong>在函数定义处使用。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">f</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> j=<span class="number">10</span>)</span></span>;</span><br></pre></td></tr></table></figure></li><li><p>和Python不同的是，修改<code>j</code>时直接传数据即可，<strong>不需要</strong>写参数名称。</p></li><li><p>尽量<strong>不使用</strong>默认参数值</p></li></ul><h2 id="内联函数"><a href="#内联函数" class="headerlink" title="内联函数"></a>内联函数</h2><ul><li><p>在调用的地方直接展开，减少调用函数时的栈操作。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="title">f</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> i * <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a = <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">int</span> b = f(a); <span class="comment">// int b = a * 2;</span></span><br><span class="line">    <span class="keyword">int</span> c = f(<span class="number">4</span>, <span class="number">10</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>内联函数的定义<strong>不在</strong><code>.cpp</code>文件中，而应该和声明<strong>都放在</strong><code>.h</code>中</p><blockquote><p>因为<code>inline</code>告诉编译器这是个<strong>函数声明</strong>而不是定义，在<strong>使用函数</strong>的地方再进行展开。</p></blockquote></li><li><p>当<code>inline</code>函数太大时（例如递归），编译器可能会拒绝展开。</p></li><li><p>类的<code>.h</code>文件中直接写出函数体的函数<strong>都是</strong>内联函数，在<code>.h</code>中也可以单独声明内联函数。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">A::print</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"this is a inline function defined in header file."</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>循环体中的<strong>小函数</strong>推荐使用内联函数</p></li><li><p>和宏相比，内联函数可以做类型检查，更加安全。</p></li></ul><h2 id="const"><a href="#const" class="headerlink" title="const"></a>const</h2><ul><li><p><strong>不可修改</strong>机制是在编译时确定的，因此是编译器进行检查。</p><ul><li><p>编译时确定的值可以用来声明数组</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> class_size = <span class="number">12</span>;</span><br><span class="line"><span class="keyword">int</span> finalGrade[class_size];</span><br></pre></td></tr></table></figure></li><li><p><code>const</code>在<code>*</code>前后对指针的影响</p><ul><li><p>在<code>*</code>前：<strong>对象</strong>是<code>const</code>（<strong>不能</strong>通过该指针改变对象，但是<strong>可以</strong>通过其他指针）</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> a = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> *p1 = &amp;a;</span><br><span class="line"><span class="keyword">int</span> *p2 = &amp;a;</span><br><span class="line">*p2 = <span class="number">100</span>;</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; *p1 &lt;&lt; <span class="built_in">endl</span>;</span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Person *p = &amp;p1;</span><br><span class="line">Person <span class="keyword">const</span> *p = &amp;p1;</span><br></pre></td></tr></table></figure></li><li><p>在<code>*</code>后：<strong>指针</strong>是<code>const</code>（<strong>不能</strong>改变该指针的指向）</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Person *<span class="keyword">const</span> p = &amp;p1;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>普通指针<strong>不能</strong>指向<code>const</code>变量</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> *ip;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> ci = <span class="number">3</span>;</span><br><span class="line">ip = &amp;ci; <span class="comment">// Error!</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>不可</strong>修改对象的函数</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Date::get_day</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123;</span><br><span class="line">    day++; <span class="comment">// Error!</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>在声明和定义处要重复<code>const</code></p></li><li><p>便于编译器对<code>const</code>对象调用方法时进行安全检查</p></li><li><p>本质是将<code>this</code>设置为<code>const</code></p></li><li><p><code>const</code>可以实现重载</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    A() : i(<span class="number">0</span>)&#123;&#125;;</span><br><span class="line">    ~A()&#123;&#125;;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"f()"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">()</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"f() with const"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">const</span> A a;</span><br><span class="line">    a.f();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>const</code>对象<strong>只能</strong>调用<code>const</code>函数</li></ul></li></ul></li><li><p><code>const</code>成员变量必须在<strong>初始化列表</strong>中初始化（<strong>不可以</strong>在构造函数中进行）</p></li></ul><h2 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h2><ul><li><p>一种访问对象的方式</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span> &amp;p = c;</span><br></pre></td></tr></table></figure><ul><li>引用<strong>必须</strong>初始化（成员变量、函数参数除外）</li><li>引用相当于是<strong>别名</strong></li><li>引用的目的就是为了减少代码中的<code>*</code></li></ul></li><li><p>引用和指针的比较</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> *<span class="title">f</span><span class="params">(<span class="keyword">int</span> *x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    (*x)++;</span><br><span class="line">    <span class="keyword">return</span> x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> &amp;<span class="title">f</span><span class="params">(<span class="keyword">int</span> &amp;x)</span></span>&#123;</span><br><span class="line">    x++;</span><br><span class="line">    <span class="keyword">return</span> x;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p><strong>不同于</strong>指针，引用在执行过程中<strong>不能</strong>改变对象。</p></li><li><p>引用<strong>不能</strong>是<code>NULL</code></p></li><li><p>传入的<code>x</code>在两种情况中<strong>都会</strong>被修改</p></li><li><p>传入函数的参数<strong>不是指针</strong>时，也<strong>可能</strong>被修改。</p></li><li><p>引用是由<code>const</code>指针实现的</p></li><li><p>引用的引用实际上<strong>不存在</strong>，只是改变了引用的对象。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> x;</span><br><span class="line"><span class="keyword">int</span> y;</span><br><span class="line"><span class="keyword">int</span> &amp;a = x;</span><br><span class="line"><span class="keyword">int</span> &amp;b = y; </span><br><span class="line"></span><br><span class="line">b = a; <span class="comment">// y = x, but not b refer to a.</span></span><br></pre></td></tr></table></figure><blockquote><p>Java的引用实际上对应C++的指针</p></blockquote></li><li><p>引用的指针可以存在，但是指针的引用不存在。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> &amp;*p1; <span class="comment">// illegal</span></span><br><span class="line"><span class="keyword">int</span> *&amp;p2; <span class="comment">// reference to pointer</span></span><br></pre></td></tr></table></figure><blockquote><p>引用<strong>没有</strong>地址</p></blockquote></li><li><p><strong>没有</strong>引用数组（因为引用并不是实体，<strong>没有</strong>地址）</p></li></ul></li><li><p>引用作为成员变量时，需要在初始化列表中写上这个引用。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> &amp;a;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    A(<span class="keyword">int</span> &amp;b): a(b) &#123;&#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>作为返回值时，最好<strong>不是</strong>局部变量。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">double</span> &amp;<span class="title">subscript</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">array</span>[i];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>作为函数参数传入</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">func</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> &amp;y, <span class="keyword">int</span>&amp;z)</span></span>&#123;</span><br><span class="line">    z *= <span class="number">5</span>; <span class="comment">// OK</span></span><br><span class="line">    y += <span class="number">8</span>; <span class="comment">// Error!</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>传<strong>非</strong><code>const</code>引用时<strong>不可以</strong>是算式</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> &amp;i)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; i &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">f(i * <span class="number">3</span>); <span class="comment">// OK</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">g</span><span class="params">(<span class="keyword">int</span> &amp;i)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; i &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">f(i * <span class="number">3</span>); <span class="comment">// Error!</span></span><br></pre></td></tr></table></figure></li></ul></li></ul><h2 id="多态"><a href="#多态" class="headerlink" title="多态"></a>多态</h2><ul><li><p>动态调用的方法需要使用<code>virtual</code>关键字声明</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">render</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure><ul><li>在父类中声明一次<code>virtual</code>后，所有子类中的函数都是虚函数，可以省略<code>virtual</code>，但是推荐加上。</li><li>所有含虚函数的类的对象都会增加一个<code>vptr</code>指针，指向类自己的<code>vtable</code>，存储了<strong>该类</strong>所有的虚函数。</li></ul></li><li><p>继承关系对象的赋值<strong>不改变</strong><code>vtable</code>（与指针赋值不同）</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">A a;</span><br><span class="line">B b;</span><br><span class="line"></span><br><span class="line">a = b;</span><br><span class="line">a.f(); <span class="comment">// A's f() instead of B's</span></span><br></pre></td></tr></table></figure></li><li><p>析构函数需要是<code>virtual</code>的</p></li><li>多态需要使用指针实现，<strong>不能</strong>通过<code>.</code>实现。</li></ul><h2 id="拷贝构造"><a href="#拷贝构造" class="headerlink" title="拷贝构造"></a>拷贝构造</h2><ul><li><p>编译器默认的拷贝构造是浅拷贝</p><ul><li><p>当字符串是<code>char *</code>时，内存会被<code>delete</code>两次，这样会发生错误。因此Cpp通常使用<code>string</code>类来定义字符串。</p><blockquote><p>尽管是浅拷贝，标准库中的类<strong>也不会</strong>出现内存问题。</p></blockquote></li></ul></li><li><p>拷贝构造和<strong>初始化</strong>的形式相同，</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Person p1 = p;</span><br><span class="line"><span class="function">Person <span class="title">p1</span><span class="params">(p)</span></span>;</span><br></pre></td></tr></table></figure></li><li><p>一个类必须声明的三个函数</p><ul><li><p>默认构造函数（参数列表为空）</p></li><li><p><code>virtual</code>的析构函数</p></li><li><p>自定义的拷贝构造</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ClassName(<span class="keyword">const</span> ClassName &amp;p) &#123;&#125;</span><br></pre></td></tr></table></figure></li></ul></li></ul><h2 id="静态"><a href="#静态" class="headerlink" title="静态"></a>静态</h2><h3 id="对象"><a href="#对象" class="headerlink" title="对象"></a>对象</h3><ul><li>Cpp保证对象只被构造一次</li><li><code>static</code>让对象变成全局的</li></ul><h3 id="成员变量-1"><a href="#成员变量-1" class="headerlink" title="成员变量"></a>成员变量</h3><ul><li><p>通过<code>static</code>成为和对象<strong>无关</strong>的变量</p></li><li><p>类中只是<strong>声明</strong>，需要单独定义后才能使用。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    A() &#123;i = <span class="number">0</span>;&#125; <span class="comment">// A():i(0) &#123;&#125; is illegal</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;<span class="built_in">cout</span> &lt;&lt; i &lt;&lt; <span class="built_in">endl</span>;&#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> i;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> A::i; <span class="comment">// not static int A::i</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    A a, b;</span><br><span class="line">    a.<span class="built_in">set</span>(<span class="number">10</span>);</span><br><span class="line">    b.print();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>初始化列表只能对<strong>非静态</strong>成员变量使用</li></ul></li></ul><h3 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h3><ul><li>调用<ul><li>对象：<code>a.f()</code></li><li>类：<code>A::f()</code></li></ul></li><li>在静态函数中<strong>没有</strong><code>this</code>参数</li></ul><h2 id="运算符重载"><a href="#运算符重载" class="headerlink" title="运算符重载"></a>运算符重载</h2><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><ul><li>在Cpp中，几乎所有的运算符都可以被重载，除了<code>./.*/::/?:</code>.</li><li>重载只能在类/枚举类发生</li><li>优先级、运算格式<strong>不能</strong>改变。</li><li><p>关键字<code>operator</code>+运算符表示重载函数</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">operator</span> *(...);</span><br><span class="line"><span class="keyword">const</span> String String::<span class="keyword">operator</span>+(<span class="keyword">const</span> String &amp;that);</span><br><span class="line"><span class="keyword">const</span> Integer <span class="keyword">operator</span>+(<span class="keyword">const</span> Integer &amp;n) <span class="keyword">const</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Integer(i + n.i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">z = x + y; <span class="comment">// OK</span></span><br><span class="line">z = x + <span class="number">3</span>; <span class="comment">// OK</span></span><br><span class="line">z = <span class="number">3</span> + <span class="number">7</span>; <span class="comment">// OK</span></span><br><span class="line">z = <span class="number">3</span> + y; <span class="comment">// Error!</span></span><br><span class="line">z = x + <span class="number">3.5</span> <span class="comment">// Error!</span></span><br></pre></td></tr></table></figure><ul><li><p>设置全局函数解决<code>z=3+y</code></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Integer</span> </span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">friend</span> <span class="keyword">const</span> Integer <span class="keyword">operator</span>+ (<span class="keyword">const</span> Integer &amp;l, <span class="keyword">const</span> Integer &amp;r);    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Integer <span class="keyword">operator</span>+ (<span class="keyword">const</span> Integer &amp;l, <span class="keyword">const</span> Integer &amp;r)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> Integer(l.i + r.i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>一元运算符<strong>不需要</strong>设置参数，应该是成员的。</li><li><code>=/()/[]/-&gt;/-&gt;*</code><strong>必须是</strong>成员的</li><li>其他二元运算符<strong>最好是</strong>全局的</li></ul></li></ul></li></ul><h3 id="原型"><a href="#原型" class="headerlink" title="原型"></a>原型</h3><ul><li><p><code>+-*/%^&amp;|~</code>:<code>const T operatorX(const T &amp;l, const T&amp;r) const;</code></p></li><li><p><code>!/&amp;&amp;/||/&lt;/&lt;=/==/&gt;=/&gt;</code>:<code>bool operatorX(const T &amp;l, const T &amp;r) const;</code></p></li><li><p><code>[]</code>:<code>T &amp;T::operator[](int index);</code></p></li><li><p><code>++/--</code>：参数填一个占位<code>int</code>表示<strong>后置</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Integer &amp;<span class="keyword">operator</span>++() <span class="comment">// ++a</span></span><br><span class="line">&#123;</span><br><span class="line">    *<span class="keyword">this</span> += <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> Integer <span class="keyword">operator</span>++(<span class="keyword">int</span>) <span class="comment">// a++</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function">Integer <span class="title">old</span><span class="params">(*<span class="keyword">this</span>)</span></span>;</span><br><span class="line">    ++(*<span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">return</span> old;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="赋值"><a href="#赋值" class="headerlink" title="赋值"></a>赋值</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ClassName a = b; <span class="comment">// copy construct</span></span><br><span class="line">a = b; <span class="comment">// assign</span></span><br></pre></td></tr></table></figure><ul><li><p>标准写法</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">T &amp;T::<span class="keyword">operator</span>=(<span class="keyword">const</span> T &amp;r)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">this</span> != &amp;r) &#123;</span><br><span class="line">        <span class="comment">// assign</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> *<span class="keyword">this</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>自己和自己相等进行赋值时，若成员中有指针，可能出现指针被改变后导致原来的内容无法访问，从而赋值失败的问题。</li></ul></li></ul><h3 id="类型转换"><a href="#类型转换" class="headerlink" title="类型转换"></a>类型转换</h3><ul><li><p>禁止<strong>隐式</strong>类型转换：<code>explicit</code></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Two</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">Two</span><span class="params">(class One &amp;)</span> </span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">one = two <span class="comment">// Error!</span></span><br></pre></td></tr></table></figure><ul><li>定义在<code>Two</code>中</li></ul></li><li><p>强制类型转换</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">ClassName::<span class="keyword">operator</span> <span class="title">double</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure><ul><li>定义在<code>One</code>中（不是<code>double</code>）</li><li><strong>没有</strong>返回类型</li></ul><blockquote><ul><li>两者地位相同，有哪种用哪种。</li><li>两种类型转换<strong>只能</strong>存在一种，除非第一种加了<code>explicit</code>.</li></ul></blockquote></li><li><p>不推荐使用默认转换，应该写成显式的转换方法<code>toXXX()</code>.</p></li></ul><h2 id="模板"><a href="#模板" class="headerlink" title="模板"></a>模板</h2><ul><li><p>重用代码的一种方式，类似于Java中的泛型编程。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt; // &lt;class Key, class Value&gt;</span></span><br><span class="line"><span class="class"><span class="title">void</span> <span class="title">foo</span>(<span class="title">void</span>) &#123;</span><span class="comment">/* ... */</span>&#125;</span><br><span class="line">foo&lt;<span class="keyword">int</span>&gt;(); <span class="comment">// type for T is int</span></span><br><span class="line">foo&lt;<span class="keyword">float</span>&gt;();</span><br></pre></td></tr></table></figure></li><li><p>指定其他参数</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>, <span class="title">int</span> <span class="title">bounds</span> = 100&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>继承</p><ul><li><p>模板之间不能继承，只能用来指定父类。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">A</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">Son</span> :</span> <span class="keyword">public</span> List&lt;A&gt; &#123;&#125;;</span><br></pre></td></tr></table></figure></li></ul></li></ul><h2 id="异常"><a href="#异常" class="headerlink" title="异常"></a>异常</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    func();</span><br><span class="line">&#125; <span class="keyword">catch</span> (VectorIndexError &amp;e) &#123;</span><br><span class="line">    <span class="comment">// throw;</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>不带对象的<code>throw</code>就是抛出<strong>原异常</strong></p></li><li><p><code>catch(...)</code>捕捉<strong>所有的</strong>异常，但是没有办法确定具体是哪一种。</p></li><li><p>函数声明</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">abc</span><span class="params">(<span class="keyword">int</span> a)</span> : <span class="title">throw</span><span class="params">(MathErr)</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure></li><li><p>构造函数抛异常之前，使用<code>delete this;</code>防止出现内存垃圾。</p></li></ul><h2 id="流"><a href="#流" class="headerlink" title="流"></a>流</h2><ul><li><p>自定义类的输入流</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">operator</span>&gt;&gt;(istream &amp;is, T &amp;obj)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// construct obj</span></span><br><span class="line">    <span class="keyword">return</span> is;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h2 id="STL"><a href="#STL" class="headerlink" title="STL"></a>STL</h2><ul><li>包含常见的数据结构和算法<ul><li><code>Vector</code></li><li><code>List</code></li><li><code>Deque</code></li><li><code>Sets &amp; Maps</code></li></ul></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;ul&gt;
&lt;li&gt;全文共&lt;code&gt;2981&lt;/code&gt;字，为暑期C++学习记录，推荐按照顺序阅读。&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
    
      <category term="CPP" scheme="http://yoursite.com/categories/CPP/"/>
    
    
  </entry>
  
  <entry>
    <title>AI-TensorFlow笔记</title>
    <link href="http://yoursite.com/2020/09/06/AI-TensorFlow%E7%AC%94%E8%AE%B0/"/>
    <id>http://yoursite.com/2020/09/06/AI-TensorFlow%E7%AC%94%E8%AE%B0/</id>
    <published>2020-09-06T08:03:31.896Z</published>
    <updated>2020-09-06T08:04:47.977Z</updated>
    
    <content type="html"><![CDATA[<p>全文共<code>3487</code>字，是暑期学习TensorFlow的记录，推荐按照顺序进行阅读。</p><a id="more"></a><h2 id="张量、计算图、会话"><a href="#张量、计算图、会话" class="headerlink" title="张量、计算图、会话"></a>张量、计算图、会话</h2><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><ul><li>用<strong>张量</strong>表示数据，用<strong>计算图</strong>搭建神经网络，用<strong>会话</strong>执行计算图，优化线上的权重（参数），得到模型。</li></ul><h3 id="张量-tensor"><a href="#张量-tensor" class="headerlink" title="张量(tensor)"></a>张量(tensor)</h3><ul><li><p>多维数组（列表）</p></li><li><p>根据中括号数判断维数</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">scalar = <span class="number">1</span></span><br><span class="line">vector = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">matrix = [[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]]</span><br><span class="line">tensor = [[[...]...]...]</span><br></pre></td></tr></table></figure></li><li><p>常量的声明</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"></span><br><span class="line">a = tf.constant([[<span class="number">1.0</span>, <span class="number">2.0</span>]]) <span class="comment"># a matrix instead of a vector</span></span><br><span class="line">b = tf.constant([[<span class="number">3.0</span>], [<span class="number">4.0</span>]])</span><br><span class="line"></span><br><span class="line">result = tf.matmul(a, b)</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure></li></ul><h3 id="计算图"><a href="#计算图" class="headerlink" title="计算图"></a>计算图</h3><ul><li>只搭建，不计算。</li></ul><h3 id="会话-Session"><a href="#会话-Session" class="headerlink" title="会话(Session)"></a>会话(Session)</h3><ul><li><p>执行运算</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> tf.Session() <span class="keyword">as</span> sess:</span><br><span class="line">    sess.run(y)</span><br></pre></td></tr></table></figure></li></ul><blockquote><ul><li><p>在TensorFlow1中，需要先建立计算图才能够计算。但是TensowFlow2中默认将两步合并，即<code>matmul</code>操作时就直接计算结果。</p></li><li><p>在2中调用1的方法/类</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tf.compat.v1.Session() <span class="comment"># tf.compat.v1.xxx</span></span><br></pre></td></tr></table></figure></li><li><p>运行时屏蔽TensorFlow的警告信息：在文件<strong>最前面</strong>（先于<code>import tensorflow</code>）</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line">os.environ[<span class="string">'TF_CPP_MIN_LOG_LEVEL'</span>]=<span class="string">'2'</span></span><br></pre></td></tr></table></figure></li></ul></blockquote><h3 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h3><ul><li><p>神经网络线上的权重W</p></li><li><p>生成</p><ul><li><code>random_normal</code>：正态分布</li><li><code>truncated_normal</code>：去掉$2σ$以外的数据的正态分布</li><li><code>random_uniform</code>：平均分布</li><li><code>zeros</code></li><li><code>ones</code></li><li><code>fill</code>：全定值</li><li><code>constant</code>：直接给值</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">w = tf.Variable(tf.compat.v1.random_normal([<span class="number">2</span>, <span class="number">3</span>], stddev=<span class="number">2</span>, mean=<span class="number">0</span>, seed=<span class="number">1</span>))</span><br><span class="line">tf.zeros([<span class="number">3</span>, <span class="number">2</span>])</span><br><span class="line">tf.fill([<span class="number">3</span>, <span class="number">2</span>], <span class="number">6</span>)</span><br></pre></td></tr></table></figure></li></ul><h3 id="神经网络搭建"><a href="#神经网络搭建" class="headerlink" title="神经网络搭建"></a>神经网络搭建</h3><ul><li>准备数据集</li><li>搭建NN结构，从输入到输出。<ul><li>搭建计算图</li><li>绘画执行</li></ul></li><li>迭代优化NN参数</li><li>使用训练好的模型进行预测和分类</li></ul><h2 id="前向传播"><a href="#前向传播" class="headerlink" title="前向传播"></a>前向传播</h2><p>模型搭建，实现推理。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'''两层简单全连接神经网络'''</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义输入和参数</span></span><br><span class="line">x = tf.constant([[<span class="number">0.7</span>, <span class="number">0.5</span>]])</span><br><span class="line">w1 = tf.Variable(tf.compat.v1.random_normal([<span class="number">2</span>, <span class="number">3</span>], stddev=<span class="number">1</span>, seed=<span class="number">1</span>))</span><br><span class="line">w2 = tf.Variable(tf.compat.v1.random_normal([<span class="number">3</span>, <span class="number">1</span>], stddev=<span class="number">1</span>, seed=<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义前向传播过程</span></span><br><span class="line">a = tf.matmul(x, w1)</span><br><span class="line">y = tf.matmul(a, w2)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 用会话计算结果</span></span><br><span class="line"><span class="keyword">with</span> tf.compat.v1.Session() <span class="keyword">as</span> sess:</span><br><span class="line">    init_op= tf.compat.v1.global_variables_initializer()</span><br><span class="line">    sess.run(init_op)</span><br><span class="line">    print(sess.run(y))</span><br></pre></td></tr></table></figure><ul><li><p><code>global_variables_initializer</code>返回<strong>初始化</strong>所有的<strong>全局变量</strong>(<code>Variable</code>)的操作，使用会话进行执行。</p><ul><li><p>全局变量</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tf.Variable(<span class="number">1</span>, name=<span class="string">'var_z'</span>)</span><br></pre></td></tr></table></figure></li><li><p>局部变量</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">e = tf.Variable(<span class="number">6</span>, name=<span class="string">'var_e'</span>, collections=[tf.GraphKeys.LOCAL_VARIABLES])</span><br></pre></td></tr></table></figure></li></ul></li><li><p>用<code>placeholder</code>实现<strong>输入</strong>定义</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">x = tf.compat.v1.placeholder(tf.float32, shape=(<span class="number">1</span>, <span class="number">2</span>))</span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line">print(sess.run(y, feed_dict=&#123;x: [[<span class="number">0.7</span>, <span class="number">0.5</span>]]&#125;))</span><br></pre></td></tr></table></figure><ul><li><p>输入多组数据</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">x = tf.compat.v1.placeholder(tf.float32, shape=(<span class="literal">None</span>, <span class="number">2</span>))</span><br><span class="line">sess.run(y, feed_dict=&#123;x: [[<span class="number">0.7</span>, <span class="number">0.5</span>], [<span class="number">0.2</span>, <span class="number">0.3</span>], [<span class="number">0.3</span>, <span class="number">0.4</span>]]&#125;)</span><br></pre></td></tr></table></figure><blockquote><p>返回<strong>多组</strong>计算值（不只一个<code>y</code>）</p></blockquote></li></ul></li></ul><h2 id="反向传播"><a href="#反向传播" class="headerlink" title="反向传播"></a>反向传播</h2><p>训练模型参数，在所有参数上使用梯度下降，使NN模型在训练数据上的<strong>损失函数</strong>最小。</p><ul><li><p>损失函数：预测值(<code>y</code>)和已知答案(<code>y_</code>)之间的差距</p></li><li><p>均方差(MSE)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">loss = tf.reduce_mean(tf.square(y_ - y))</span><br></pre></td></tr></table></figure></li><li><p>训练方法：减小loss值为优化目标</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tf.compat.v1.train.GradientDescentOptimizer(learning_rate).minimize(loss)</span><br><span class="line">tf.compat.v1.train.MomentumOptimizer(learning_rate, momentum).minimize(loss)</span><br><span class="line">tf.compat.v1.train.AdamOptimizer(learning_rate).minimize(loss)</span><br></pre></td></tr></table></figure><ul><li><code>learning_rate</code>：学习率，决定参数每次更新的幅度</li></ul></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'''两层简单全连接神经网络'''</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">os.environ[<span class="string">'TF_CPP_MIN_LOG_LEVEL'</span>] = <span class="string">'2'</span></span><br><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">tf.compat.v1.disable_eager_execution()</span><br><span class="line"></span><br><span class="line">BATCH_SIZE = <span class="number">8</span></span><br><span class="line">seed = <span class="number">23455</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成随机矩阵对象</span></span><br><span class="line">rng = np.random.RandomState(seed)</span><br><span class="line"><span class="comment"># 返回随机的 32 * 2 矩阵</span></span><br><span class="line">X = rng.rand(<span class="number">32</span>, <span class="number">2</span>)</span><br><span class="line"><span class="comment"># 将合法数据的结果置为1 否则为0</span></span><br><span class="line">Y = [[int(x0 + x1 &lt; <span class="number">1</span>)] <span class="keyword">for</span> (x0, x1) <span class="keyword">in</span> X]</span><br><span class="line">print(<span class="string">"X:"</span> + str(X))</span><br><span class="line">print(<span class="string">"Y:"</span> + str(Y))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义输入和参数</span></span><br><span class="line">x = tf.compat.v1.placeholder(tf.float32, shape=(<span class="literal">None</span>, <span class="number">2</span>))</span><br><span class="line">w1 = tf.Variable(tf.compat.v1.random_normal([<span class="number">2</span>, <span class="number">3</span>], stddev=<span class="number">1</span>, seed=<span class="number">1</span>))</span><br><span class="line">w2 = tf.Variable(tf.compat.v1.random_normal([<span class="number">3</span>, <span class="number">1</span>], stddev=<span class="number">1</span>, seed=<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义标准输出</span></span><br><span class="line">y_ = tf.compat.v1.placeholder(tf.float32, shape=(<span class="literal">None</span>, <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义前向传播过程</span></span><br><span class="line">a = tf.matmul(x, w1)</span><br><span class="line">y = tf.matmul(a, w2)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义损失函数和反向传播的方法</span></span><br><span class="line">loss = tf.compat.v1.reduce_mean(tf.square(y - y_))</span><br><span class="line">train_step = tf.compat.v1.train.GradientDescentOptimizer(<span class="number">0.001</span>).minimize(loss)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> tf.compat.v1.Session() <span class="keyword">as</span> sess:</span><br><span class="line">    init_op = tf.compat.v1.global_variables_initializer()</span><br><span class="line">    sess.run(init_op)</span><br><span class="line">    <span class="comment"># 未经训练的参数值</span></span><br><span class="line">    print(<span class="string">'initial w1: '</span> + str(sess.run(w1)))</span><br><span class="line">    print(<span class="string">'initial w2: '</span> + str(sess.run(w2)))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 训练模型</span></span><br><span class="line">    <span class="comment"># 使用同一数据集的不同数据组合训练3000轮</span></span><br><span class="line">    STEPS = <span class="number">3000</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(STEPS):</span><br><span class="line">        start = (i * BATCH_SIZE) % <span class="number">32</span></span><br><span class="line">        end = start + BATCH_SIZE</span><br><span class="line">        <span class="comment"># 传入y_指定标准输出</span></span><br><span class="line">        sess.run(train_step, feed_dict=&#123;x: X[start:end], y_: Y[start:end]&#125;)</span><br><span class="line"></span><br><span class="line">    print(<span class="string">'final w1: '</span> + str(sess.run(w1)))</span><br><span class="line">    print(<span class="string">'final w2: '</span> + str(sess.run(w2)))</span><br></pre></td></tr></table></figure><h3 id="神经网络八股"><a href="#神经网络八股" class="headerlink" title="神经网络八股"></a>神经网络八股</h3><ul><li><p>准备</p><ul><li><code>import</code></li><li>常量定义</li><li>生成数据集</li></ul></li><li><p>前传</p><ul><li>定义输入、参数、标准输出</li></ul></li><li><p>反传</p><ul><li>定义损失函数和反传优化方法</li></ul></li><li><p>迭代</p><ul><li><p>生成会话，训练<code>STEPS</code>轮。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> tf.compat.v1.Session() <span class="keyword">as</span> sess:</span><br><span class="line">    init_op = tf.compat.v1.global_variables_initializer()</span><br><span class="line">    sess.run(init_op)</span><br><span class="line"></span><br><span class="line">    STEPS = <span class="number">3000</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(STEPS):</span><br><span class="line">        start = ...</span><br><span class="line">        end = ...</span><br><span class="line">        sess.run(train_step, feed_dict=&#123;...&#125;)</span><br></pre></td></tr></table></figure></li></ul></li></ul><h2 id="损失函数"><a href="#损失函数" class="headerlink" title="损失函数"></a>损失函数</h2><h3 id="激活函数"><a href="#激活函数" class="headerlink" title="激活函数"></a>激活函数</h3><ul><li><code>relu</code>:<code>tf.nn.relu()</code></li><li><code>sigmoid</code>:<code>tf.nn.sigmoid()</code></li><li><code>tanh</code>:<code>tf.nn.tanh()</code></li></ul><h3 id="NN复杂度"><a href="#NN复杂度" class="headerlink" title="NN复杂度"></a>NN复杂度</h3><ul><li>层数=隐藏层+输出层</li><li>总参数=总W+总b<ul><li><code>b</code>是偏置值，计算层一个结果神经元对应一个偏置。</li></ul></li></ul><h3 id="自定义损失函数"><a href="#自定义损失函数" class="headerlink" title="自定义损失函数"></a>自定义损失函数</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">COST = <span class="number">1</span></span><br><span class="line">PROFIT = <span class="number">9</span></span><br><span class="line">loss = tf.reduce_sum(tf.where(tf.greater(y, y_), COST * (y - y_), PROFIT * (y_ - y)))</span><br></pre></td></tr></table></figure><h3 id="交叉熵"><a href="#交叉熵" class="headerlink" title="交叉熵"></a>交叉熵</h3><ul><li><p>表征两个概率分布之间的<strong>距离</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ce = -tf.reduce_mean(y_ * tf.log(clip_by_value(y, <span class="number">1e-12</span>, <span class="number">1.0</span>)))</span><br></pre></td></tr></table></figure><ul><li><p>将<code>n</code>分类的<code>n</code>个输出通过<code>softmax()</code>函数处理使其满足概率和为1的分布</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ce = tf.nn.sparse_softmax_cross_entropy_with_logits(logits=y, labels=tf.argmax(y_, <span class="number">1</span>))</span><br><span class="line">cem = tf.reduce_mean(ce) <span class="comment"># loss function</span></span><br></pre></td></tr></table></figure></li></ul></li></ul><h2 id="学习率"><a href="#学习率" class="headerlink" title="学习率"></a>学习率</h2><ul><li>每次更新的幅度</li></ul><h3 id="指数衰减学习率"><a href="#指数衰减学习率" class="headerlink" title="指数衰减学习率"></a>指数衰减学习率</h3><ul><li><p>根据训练情况动态更新学习率</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line">os.environ[<span class="string">'TF_CPP_MIN_LOG_LEVEL'</span>] = <span class="string">'2'</span></span><br><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line">tf.compat.v1.disable_eager_execution()</span><br><span class="line"></span><br><span class="line">LEARNING_RATE_BASE = <span class="number">0.1</span>  <span class="comment"># 初始学习率</span></span><br><span class="line">LEARNING_RATE_DECAY = <span class="number">0.99</span>  <span class="comment"># 学习率衰减律</span></span><br><span class="line">LEARNING_RATE_STEP = <span class="number">1</span>  <span class="comment"># 学习率更新频度 一般为总样本数/BATCH_SIZE</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 轮数计数器 初值为0 设置为不被训练</span></span><br><span class="line">global_step = tf.Variable(<span class="number">0</span>, trainable=<span class="literal">False</span>)</span><br><span class="line"><span class="comment"># 定义指数下降学习率</span></span><br><span class="line">learning_rate = tf.compat.v1.train.exponential_decay(</span><br><span class="line">    LEARNING_RATE_BASE,</span><br><span class="line">    global_step,</span><br><span class="line">    LEARNING_RATE_STEP,</span><br><span class="line">    LEARNING_RATE_DECAY,</span><br><span class="line">    staircase=<span class="literal">True</span>)  <span class="comment"># 为True表示学习率的下降是梯度曲线</span></span><br><span class="line"><span class="comment"># 定义待优化参数</span></span><br><span class="line">w = tf.Variable(tf.constant(<span class="number">5</span>, dtype=tf.float32))</span><br><span class="line"><span class="comment"># 定义损失函数</span></span><br><span class="line">loss = tf.square(w + <span class="number">1</span>)</span><br><span class="line"><span class="comment"># 反向传播方法</span></span><br><span class="line">train_step = tf.compat.v1.train.GradientDescentOptimizer(</span><br><span class="line">    learning_rate).minimize(loss, global_step=global_step)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> tf.compat.v1.Session() <span class="keyword">as</span> sess:</span><br><span class="line">    init_op = tf.compat.v1.global_variables_initializer()</span><br><span class="line">    sess.run(init_op)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">40</span>):</span><br><span class="line">        sess.run(train_step)</span><br><span class="line">        learning_rate_val = sess.run(learning_rate)</span><br><span class="line">        global_step_val = sess.run(global_step)</span><br><span class="line">        w_val = sess.run(w)</span><br><span class="line">        loss_val = sess.run(loss)</span><br><span class="line">        print(w_val)</span><br></pre></td></tr></table></figure></li></ul><h2 id="滑动平均（影子值）"><a href="#滑动平均（影子值）" class="headerlink" title="滑动平均（影子值）"></a>滑动平均（影子值）</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ema = tf.compat.v1.train.ExponentialMovingAverage(MOVING_AVERAGE_DECAY, global_step) <span class="comment"># 衰减率和当前轮数</span></span><br><span class="line">ema_op = ema.apply(tf.compat.v1.trainable_variables()) <span class="comment"># 对所有的待优化参数求平均值</span></span><br><span class="line"><span class="keyword">with</span> tf.control_dependencies([train_step, ema_op]):</span><br><span class="line">    train_op = tf.no_op(name=<span class="string">'train'</span>) <span class="comment"># 将训练和滑动平均操作绑定</span></span><br></pre></td></tr></table></figure><blockquote><p><code>ema.average(arg)</code>：查看参数的滑动平均值</p></blockquote><h2 id="正则化"><a href="#正则化" class="headerlink" title="正则化"></a>正则化</h2><ul><li>缓解过拟合：通过给某些参数权值，弱化训练数据的噪声，将其正则化。</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line">os.environ[<span class="string">'TF_CPP_MIN_LOG_LEVEL'</span>] = <span class="string">'2'</span></span><br><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line">tf.compat.v1.disable_eager_execution()</span><br><span class="line"></span><br><span class="line">BATCH_SIZE = <span class="number">30</span></span><br><span class="line">seed = <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 基于seed产生随机数</span></span><br><span class="line">rdm = np.random.RandomState(seed)</span><br><span class="line"><span class="comment"># 产生300组2维坐标</span></span><br><span class="line">X = rdm.randn(<span class="number">300</span>, <span class="number">2</span>)</span><br><span class="line"><span class="comment"># 根据是否在园内为每个点设置颜色</span></span><br><span class="line">Y_ = [int(x0**<span class="number">2</span> + x1**<span class="number">2</span> &lt; <span class="number">2</span>) <span class="keyword">for</span> (x0, x1) <span class="keyword">in</span> X]</span><br><span class="line">Y_c = [[<span class="string">'red'</span> <span class="keyword">if</span> y <span class="keyword">else</span> <span class="string">'blue'</span>] <span class="keyword">for</span> y <span class="keyword">in</span> Y_]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对数据集X和标签Y进行shape整理为矩阵</span></span><br><span class="line"><span class="comment"># 第一个参数-1表示属性值由第二个参数决定</span></span><br><span class="line"><span class="comment"># 第二个参数表示有多少列 即X为n行2列 Y为n行1列</span></span><br><span class="line">X = np.vstack(X).reshape(<span class="number">-1</span>, <span class="number">2</span>)</span><br><span class="line">Y_ = np.vstack(Y_).reshape(<span class="number">-1</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 取X所有坐标的第0/1列元素并指定颜色进行绘制</span></span><br><span class="line">plt.scatter(X[:, <span class="number">0</span>], X[:, <span class="number">1</span>], c=np.squeeze(Y_c))</span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义输入 参数 输出 和前向传播过程</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_weight</span><span class="params">(shape, regularizer)</span>:</span></span><br><span class="line">    w = tf.Variable(tf.compat.v1.random_normal(shape), dtype=tf.float32)</span><br><span class="line">    tf.compat.v1.add_to_collection(</span><br><span class="line">        <span class="string">'losses'</span>,</span><br><span class="line">        tf.keras.regularizers.l2(regularizer)(w))</span><br><span class="line">        <span class="comment"># tf.contrib.layers.l2_regularizer(regularizer)(w))</span></span><br><span class="line">    <span class="keyword">return</span> w</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_bias</span><span class="params">(shape)</span>:</span></span><br><span class="line">    b = tf.Variable(tf.constant(<span class="number">0.01</span>, shape=shape))</span><br><span class="line">    <span class="keyword">return</span> b</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">x = tf.compat.v1.placeholder(tf.float32, shape=(<span class="literal">None</span>, <span class="number">2</span>))</span><br><span class="line">y_ = tf.compat.v1.placeholder(tf.float32, shape=(<span class="literal">None</span>, <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">w1 = get_weight([<span class="number">2</span>, <span class="number">11</span>], <span class="number">0.01</span>)</span><br><span class="line">b1 = get_bias([<span class="number">11</span>])</span><br><span class="line">y1 = tf.nn.relu(tf.matmul(x, w1) + b1)  <span class="comment"># 激活隐藏层</span></span><br><span class="line"></span><br><span class="line">w2 = get_weight([<span class="number">11</span>, <span class="number">1</span>], <span class="number">0.01</span>)</span><br><span class="line">b2 = get_bias([<span class="number">1</span>])</span><br><span class="line">y = tf.matmul(y1, w2) + b2  <span class="comment"># 输出层不激活</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义损失函数</span></span><br><span class="line">loss_mse = tf.reduce_mean(tf.square(y - y_))</span><br><span class="line">loss_total = loss_mse + tf.compat.v1.add_n(</span><br><span class="line">    tf.compat.v1.get_collection(<span class="string">'losses'</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 不含正则化的反向传播</span></span><br><span class="line">train_step = tf.compat.v1.train.AdamOptimizer(<span class="number">0.0001</span>).minimize(loss_mse)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 包含正则化的反向传播</span></span><br><span class="line">train_step = tf.compat.v1.train.AdamOptimizer(<span class="number">0.0001</span>).minimize(loss_total)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> tf.compat.v1.Session() <span class="keyword">as</span> sess:</span><br><span class="line">    init_op = tf.compat.v1.global_variables_initializer()</span><br><span class="line">    sess.run(init_op)</span><br><span class="line">    STEPS = <span class="number">40000</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(STEPS):</span><br><span class="line">        start = (i * BATCH_SIZE) % <span class="number">300</span></span><br><span class="line">        end = start + BATCH_SIZE</span><br><span class="line">        sess.run(train_step, feed_dict=&#123;x: X[start:end], y_: Y_[start:end]&#125;)</span><br><span class="line">        <span class="keyword">if</span> i % <span class="number">2000</span> == <span class="number">0</span>:</span><br><span class="line">            loss_mse_v = sess.run(loss_mse, feed_dict=&#123;x: X, y_: Y_&#125;)</span><br><span class="line">    <span class="comment"># 在[-3,3]上以0.01为步长生成二维网格坐标点</span></span><br><span class="line">    xx, yy = np.mgrid[<span class="number">-3</span>:<span class="number">3</span>:<span class="number">.01</span>, <span class="number">-3</span>:<span class="number">3</span>:<span class="number">.01</span>]</span><br><span class="line">    <span class="comment"># 将xx, yy拉直，合并成2列的矩阵</span></span><br><span class="line">    grid = np.c_[xx.ravel(), yy.ravel()]</span><br><span class="line">    <span class="comment"># 将点喂入神经网络</span></span><br><span class="line">    probs = sess.run(y, feed_dict=&#123;x: grid&#125;)</span><br><span class="line">    <span class="comment"># 调成probs的shape为和xx相同</span></span><br><span class="line">    probs = probs.reshape(xx.shape)</span><br><span class="line"></span><br><span class="line">plt.scatter(X[:, <span class="number">0</span>], X[:, <span class="number">1</span>], c=np.squeeze(Y_c))</span><br><span class="line">plt.contour(xx, yy, probs, levels=[<span class="number">.5</span>])</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><h2 id="搭建八股"><a href="#搭建八股" class="headerlink" title="搭建八股"></a>搭建八股</h2><ul><li><p>生成数据集</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate</span><span class="params">()</span>:</span></span><br><span class="line">    rdm = np.random.RandomState(seed)</span><br><span class="line">    X = </span><br><span class="line">    Y_ = </span><br><span class="line">    Y_c = </span><br><span class="line">    </span><br><span class="line">    X = np.vstack(X).reshape()</span><br><span class="line">    Y = np.vstack(Y).reshape()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> X, Y_, Y_c</span><br></pre></td></tr></table></figure></li><li><p>前向传播</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'''forward.py'''</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(x, regularizer)</span>:</span></span><br><span class="line">    w = </span><br><span class="line">    b = </span><br><span class="line">    y = </span><br><span class="line">    <span class="keyword">return</span> y</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_weight</span><span class="params">(shape, regularizer)</span>:</span></span><br><span class="line">    w = tf.Variable()</span><br><span class="line">    tf.add_to_collection(<span class="string">'losses'</span>, tf,contrib.layers.l2_regularizer(regularizer)(w))</span><br><span class="line">    <span class="keyword">return</span> w</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_bias</span><span class="params">(shape)</span>:</span></span><br><span class="line">    b = tf.Variable()</span><br><span class="line">    <span class="keyword">return</span> b</span><br></pre></td></tr></table></figure></li><li><p>反向传播</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'''backward.py'''</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">backward</span><span class="params">()</span>:</span></span><br><span class="line">    x = tf.palceholer()</span><br><span class="line">    y_ = tf.palceholer()</span><br><span class="line">    y = forward.firward(x, REGULARIZER)</span><br><span class="line">    global_step = tf.Variable(<span class="number">0</span>, trainable=<span class="literal">False</span>)</span><br><span class="line">    loss = </span><br><span class="line"></span><br><span class="line">    train_step = tf.train.GradientDescentOptimizer(learning_rate).minimize(loss, global_step=global_step)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">with</span> tf.Session() <span class="keyword">as</span> sess:</span><br><span class="line">        init_op = tf.global_variables_initializer()</span><br><span class="line">        sess.run(init_op)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(STEPS):</span><br><span class="line">            sess.run(train_step, feed_dict=&#123;x:, y_:&#125;)</span><br><span class="line"></span><br><span class="line"> <span class="keyword">if</span> __name__==<span class="string">'__main__'</span>:</span><br><span class="line">    backward()</span><br></pre></td></tr></table></figure></li></ul><h2 id="MNIST数据集"><a href="#MNIST数据集" class="headerlink" title="MNIST数据集"></a>MNIST数据集</h2><h3 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h3><ul><li><code>tf.get_collection(&#39;&#39;)</code>：取<code>collection</code>中的所有变量并生成一个列表</li><li><code>tf.add_n([])</code>：将列表中对应的元素相加</li><li><code>tf.cast(x, dtype)</code>：将<code>x</code>的类型转换为<code>dtype</code></li><li><code>tf.argmax(x, axis)</code>：返回最大值所在的索引号</li><li><code>os.path.join(&#39;home&#39;, &#39;name&#39;)</code>：返回<code>home/name</code></li><li><code>with tf.Graph().as_default() as g:</code>：语句块中的节点在计算图<code>g</code>中（多用于<strong>复现</strong>神经网络）</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'''mnist_forward.py'''</span></span><br><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"></span><br><span class="line">INPUT_NODE = <span class="number">784</span></span><br><span class="line">OUTPUT_NODE = <span class="number">10</span></span><br><span class="line">LAYER_NODE = <span class="number">500</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_weight</span><span class="params">(shape, regularizer)</span>:</span></span><br><span class="line">    <span class="comment">#beijieduande biaozhuncha buhuichaoguo liangge biaozhuncha</span></span><br><span class="line">    w = tf.Variable(tf.compat.v1.truncated_normal(shape, stddev=<span class="number">0.1</span>))</span><br><span class="line">    <span class="keyword">if</span> regularizer != <span class="literal">None</span>:</span><br><span class="line">        tf.compat.v1.add_to_collection(</span><br><span class="line">            <span class="string">"losses"</span>,</span><br><span class="line">            tf.keras.regularizers.l2(regularizer)(w))</span><br><span class="line">    <span class="keyword">return</span> w</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_bias</span><span class="params">(shape)</span>:</span></span><br><span class="line">    b = tf.Variable(tf.zeros(shape))</span><br><span class="line">    <span class="keyword">return</span> b</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(x, regularizer)</span>:</span></span><br><span class="line">    w1 = get_weight((INPUT_NODE, LAYER_NODE), regularizer)</span><br><span class="line">    b1 = get_bias(LAYER_NODE)</span><br><span class="line">    y1 = tf.nn.relu(tf.matmul(x, w1) + b1)</span><br><span class="line"></span><br><span class="line">    w2 = get_weight((LAYER_NODE, OUTPUT_NODE), regularizer)</span><br><span class="line">    b2 = get_bias(OUTPUT_NODE)</span><br><span class="line">    y2 = tf.matmul(y1, w2) + b2</span><br><span class="line">    <span class="keyword">return</span> y2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    x = np.random.random((<span class="number">3</span>, <span class="number">784</span>))</span><br><span class="line">    x = x.astype(np.float32)</span><br><span class="line">    print(<span class="string">"x.shape:"</span>, x.shape)</span><br><span class="line">    regularizer = <span class="number">0.001</span></span><br><span class="line">    print(x.dtype)</span><br><span class="line"></span><br><span class="line">    pred_y = forward(x, regularizer)</span><br><span class="line">    print(<span class="string">"pred_y:"</span>, pred_y[:])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'''mnist_backward.py'''</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">os.environ[<span class="string">'TF_CPP_MIN_LOG_LEVEL'</span>] = <span class="string">'2'</span></span><br><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"><span class="keyword">from</span> tensorflow.examples.tutorials.mnist <span class="keyword">import</span> input_data</span><br><span class="line"><span class="keyword">import</span> mnist_forward</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">tf.compat.v1.disable_eager_execution()</span><br><span class="line"></span><br><span class="line">BATCH_SIZE = <span class="number">32</span></span><br><span class="line">LEARNING_RATE_BASE = <span class="number">0.1</span></span><br><span class="line">LEARNING_RATE_DECAY = <span class="number">0.99</span></span><br><span class="line">REGULARIZER = <span class="number">0.0001</span></span><br><span class="line">STEPS = <span class="number">50000</span></span><br><span class="line">MOVING_AVERAGE_DECAY = <span class="number">0.99</span></span><br><span class="line">MODEL_SAVE_PATH = <span class="string">"./model/"</span></span><br><span class="line">MODEL_NAME = <span class="string">'mnist_model'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">backward</span><span class="params">(mnist)</span>:</span></span><br><span class="line"></span><br><span class="line">    x = tf.compat.v1.placeholder(tf.float32, [<span class="literal">None</span>, mnist_forward.INPUT_NODE])</span><br><span class="line">    y_ = tf.compat.v1.placeholder(tf.float32,</span><br><span class="line">                                  [<span class="literal">None</span>, mnist_forward.OUTPUT_NODE])</span><br><span class="line">    y = mnist_forward.forward(x, REGULARIZER)</span><br><span class="line">    global_step = tf.Variable(<span class="number">0</span>, trainable=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">    ce = tf.nn.sparse_softmax_cross_entropy_with_logits(logits=y,</span><br><span class="line">                                                        labels=tf.argmax(</span><br><span class="line">                                                            y_, <span class="number">1</span>))</span><br><span class="line">    cem = tf.reduce_mean(ce)</span><br><span class="line">    loss = cem + tf.add_n(tf.compat.v1.get_collection(<span class="string">"losses"</span>))</span><br><span class="line"></span><br><span class="line">    learning_rate = tf.compat.v1.train.exponential_decay(LEARNING_RATE_BASE,</span><br><span class="line">                                               global_step,</span><br><span class="line">                                               mnist.train.num_examples /</span><br><span class="line">                                               BATCH_SIZE,</span><br><span class="line">                                               LEARNING_RATE_DECAY,</span><br><span class="line">                                               staircase=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    train_step = tf.compat.v1.train.GradientDescentOptimizer(learning_rate).minimize(</span><br><span class="line">        loss, global_step=global_step)</span><br><span class="line"></span><br><span class="line">    ema = tf.compat.v1.train.ExponentialMovingAverage(MOVING_AVERAGE_DECAY, global_step)</span><br><span class="line">    ema_op = ema.apply(tf.compat.v1.trainable_variables())</span><br><span class="line">    <span class="keyword">with</span> tf.control_dependencies([train_step, ema_op]):</span><br><span class="line">        train_op = tf.no_op(name=<span class="string">"train"</span>)</span><br><span class="line"></span><br><span class="line">    saver = tf.compat.v1.train.Saver()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> tf.compat.v1.Session() <span class="keyword">as</span> sess:</span><br><span class="line">        init_op = tf.compat.v1.global_variables_initializer()</span><br><span class="line">        sess.run(init_op)</span><br><span class="line">        ckpt = tf.compat.v1.train.get_checkpoint_state(MODEL_SAVE_PATH)</span><br><span class="line">        exclude = [<span class="string">''</span>]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ckpt <span class="keyword">and</span> ckpt.model_checkpoint_path:</span><br><span class="line">            saver.restore(sess, ckpt.model_checkpoint_path)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(STEPS):</span><br><span class="line">            xs, ys = mnist.train.next_batch(BATCH_SIZE)</span><br><span class="line">            _, loss_value, step = sess.run([train_op, loss, global_step],</span><br><span class="line">                                           feed_dict=&#123;</span><br><span class="line">                                               x: xs,</span><br><span class="line">                                               y_: ys</span><br><span class="line">                                           &#125;)</span><br><span class="line">            <span class="keyword">if</span> i % <span class="number">1000</span> == <span class="number">0</span>:</span><br><span class="line">                print(</span><br><span class="line">                    <span class="string">"After %d training step(s), losses on trianing batch is %f. "</span></span><br><span class="line">                    % (step, loss_value))</span><br><span class="line">                saver.save(sess,</span><br><span class="line">                           os.path.join(MODEL_SAVE_PATH, MODEL_NAME),</span><br><span class="line">                           global_step=global_step)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    mnist = input_data.read_data_sets(<span class="string">"./MNIST_data/"</span>, one_hot=<span class="literal">True</span>)</span><br><span class="line">    backward(mnist)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'''mnist_test.py'''</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">os.environ[<span class="string">'TF_CPP_MIN_LOG_LEVEL'</span>] = <span class="string">'2'</span></span><br><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"><span class="keyword">from</span> tensorflow.examples.tutorials.mnist <span class="keyword">import</span> input_data</span><br><span class="line"><span class="keyword">import</span> mnist_forward</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">tf.compat.v1.disable_eager_execution()</span><br><span class="line"><span class="keyword">import</span> mnist_forward</span><br><span class="line"><span class="keyword">import</span> mnist_backward</span><br><span class="line">TEST_INTERVAL_SECS = <span class="number">5</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">(mnist)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> tf.Graph().as_default() <span class="keyword">as</span> g:</span><br><span class="line">        x = tf.compat.v1.placeholder(tf.float32, [<span class="literal">None</span>, mnist_forward.INPUT_NODE])</span><br><span class="line">        y_ = tf.compat.v1.placeholder(tf.float32, [<span class="literal">None</span>, mnist_forward.OUTPUT_NODE])</span><br><span class="line">        y = mnist_forward.forward(x, <span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line">        ema = tf.compat.v1.train.ExponentialMovingAverage(</span><br><span class="line">            mnist_backward.MOVING_AVERAGE_DECAY)</span><br><span class="line">        ema_restore = ema.variables_to_restore()</span><br><span class="line">        saver = tf.compat.v1.train.Saver(ema_restore)</span><br><span class="line"></span><br><span class="line">        correct_prediction = tf.equal(tf.argmax(y, <span class="number">1</span>), tf.argmax(y_, <span class="number">1</span>))</span><br><span class="line">        <span class="comment">#qiupingjun</span></span><br><span class="line">        accuracy = tf.reduce_mean(tf.cast(correct_prediction, tf.float32))</span><br><span class="line">        j = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> j &lt; <span class="number">20</span>:</span><br><span class="line">            <span class="comment">#gpu_options=tf.GPUOptions(per_process_gpu_memory_fraction=0.333)</span></span><br><span class="line">            <span class="comment">#with tf.Session(config=tf.ConfigProto(gpu_options=gpu_options)) as sess:</span></span><br><span class="line">            <span class="keyword">with</span> tf.compat.v1.Session() <span class="keyword">as</span> sess:</span><br><span class="line">                ckpt = tf.compat.v1.train.get_checkpoint_state(</span><br><span class="line">                    mnist_backward.MODEL_SAVE_PATH)</span><br><span class="line">                <span class="comment">#                print("----")</span></span><br><span class="line">                <span class="comment">#                print(ckpt)</span></span><br><span class="line">                <span class="comment">#                print("----")</span></span><br><span class="line">                <span class="keyword">if</span> ckpt <span class="keyword">and</span> ckpt.model_checkpoint_path:</span><br><span class="line">                    <span class="comment">#                    print("ok?")</span></span><br><span class="line">                    saver.restore(sess, ckpt.model_checkpoint_path)</span><br><span class="line">                    global_step = ckpt.model_checkpoint_path.split(</span><br><span class="line">                        <span class="string">'/'</span>)[<span class="number">-1</span>].split(<span class="string">'-'</span>)[<span class="number">-1</span>]</span><br><span class="line">                    <span class="comment">#                    print("global_step:",global_step)</span></span><br><span class="line">                    accuracy_score = sess.run(accuracy,</span><br><span class="line">                                              feed_dict=&#123;</span><br><span class="line">                                                  x: mnist.test.images[:<span class="number">256</span>],</span><br><span class="line">                                                  y_: mnist.test.labels[:<span class="number">256</span>]</span><br><span class="line">                                              &#125;)</span><br><span class="line">                    print(<span class="string">"After %s training step(s). test accuracy = %f"</span> %</span><br><span class="line">                          (global_step, accuracy_score))</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    print(<span class="string">"No checkpoint file found"</span>)</span><br><span class="line">                    <span class="keyword">return</span></span><br><span class="line">                time.sleep(TEST_INTERVAL_SECS)</span><br><span class="line">                j += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    mnist = input_data.read_data_sets(<span class="string">"./MNIST_data/"</span>, one_hot=<span class="literal">True</span>)</span><br><span class="line">    test(mnist)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'''mnist_app.py'''</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">Created on Wed Nov 28 22:37:56 2018</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">@author: lele</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">os.environ[<span class="string">'TF_CPP_MIN_LOG_LEVEL'</span>] = <span class="string">'2'</span></span><br><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">import</span> mnist_backward</span><br><span class="line"><span class="keyword">import</span> mnist_forward</span><br><span class="line"></span><br><span class="line">tf.compat.v1.disable_eager_execution()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">restore_model</span><span class="params">(testPicArr)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> tf.Graph().as_default() <span class="keyword">as</span> g:</span><br><span class="line">        x = tf.compat.v1.placeholder(tf.float32, [<span class="literal">None</span>, mnist_forward.INPUT_NODE])</span><br><span class="line">        y = mnist_forward.forward(x, <span class="literal">None</span>)</span><br><span class="line">        preValue = tf.compat.v1.arg_max(y, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        variable_averages = tf.compat.v1.train.ExponentialMovingAverage(</span><br><span class="line">            mnist_backward.MOVING_AVERAGE_DECAY)</span><br><span class="line">        variable_to_restore = variable_averages.variables_to_restore()</span><br><span class="line">        saver = tf.compat.v1.train.Saver(variable_to_restore)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">with</span> tf.compat.v1.Session() <span class="keyword">as</span> sess:</span><br><span class="line">            ckpt = tf.compat.v1.train.get_checkpoint_state(</span><br><span class="line">                mnist_backward.MODEL_SAVE_PATH)</span><br><span class="line">            <span class="keyword">if</span> ckpt <span class="keyword">and</span> ckpt.model_checkpoint_path:</span><br><span class="line">                saver.restore(sess, ckpt.model_checkpoint_path)</span><br><span class="line"></span><br><span class="line">                preValue = sess.run(preValue, feed_dict=&#123;x: testPicArr&#125;)</span><br><span class="line">                <span class="keyword">return</span> preValue</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                print(<span class="string">"No checkpoint file found"</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pre_pic</span><span class="params">(picName)</span>:</span></span><br><span class="line">    fp = open(picName, <span class="string">'rb'</span>)</span><br><span class="line">    img = Image.open(fp)</span><br><span class="line">    reIm = img.resize((<span class="number">28</span>, <span class="number">28</span>), Image.ANTIALIAS)</span><br><span class="line">    im_arr = np.array(reIm.convert(<span class="string">'L'</span>))</span><br><span class="line">    threshold = <span class="number">50</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">28</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">28</span>):</span><br><span class="line">            im_arr[i][j] = <span class="number">255</span> - im_arr[i][j]</span><br><span class="line">            <span class="keyword">if</span> (im_arr[i][j] &lt; threshold):</span><br><span class="line">                im_arr[i][j] = <span class="number">0</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                im_arr[i][j] = <span class="number">255</span></span><br><span class="line"></span><br><span class="line">    nm_arr = im_arr.reshape([<span class="number">1</span>, <span class="number">784</span>])</span><br><span class="line">    nm_arr = nm_arr.astype(np.float32)</span><br><span class="line">    img_ready = np.multiply(nm_arr, <span class="number">1.0</span> / <span class="number">255.0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> img_ready</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">application</span><span class="params">()</span>:</span></span><br><span class="line">    testNum = int(input(<span class="string">"input the num of the test pictures:"</span>))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(testNum):</span><br><span class="line">        testPic = input(<span class="string">"the path of test picture:"</span>)</span><br><span class="line">        testPicArr = pre_pic(testPic)</span><br><span class="line">        preValue = restore_model(testPicArr)</span><br><span class="line">        print(<span class="string">"the prediction num is:"</span>, preValue)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    application()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><h2 id="卷积神经网络"><a href="#卷积神经网络" class="headerlink" title="卷积神经网络"></a>卷积神经网络</h2><h3 id="概述-1"><a href="#概述-1" class="headerlink" title="概述"></a>概述</h3><ul><li><p>待优化参数过多会导致过拟合</p></li><li><p>为了避免过拟合，通常先将图片进行预处理（提取特征）。</p></li><li><p>卷积是一种有效的<strong>提取图像特征</strong>的方法</p></li><li><p>$输出图片边长=(输入图片边长-卷积核长+1)/步长(向上取整)$</p><blockquote><p>为了将输出图片和输入图片的边长保持一致，可以对输入图片进行<strong>全零填充(Padding)</strong>。</p></blockquote></li></ul><h3 id="卷积计算"><a href="#卷积计算" class="headerlink" title="卷积计算"></a>卷积计算</h3><ul><li><p><code>tf.nn.conv2d</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tf.nn.conv2d([batch, <span class="number">5</span>, <span class="number">5</span>, <span class="number">3</span>], [<span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">16</span>], [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>], padding=<span class="string">'SAME'</span>)</span><br></pre></td></tr></table></figure><ul><li><code>padding</code><ul><li><code>VALID</code>：不进行填充</li><li><code>SAME</code>：进行填充</li></ul></li><li>核个数指定<strong>输出</strong>的通道数</li></ul></li></ul><h3 id="池化-Pooling"><a href="#池化-Pooling" class="headerlink" title="池化(Pooling)"></a>池化(Pooling)</h3><ul><li><p>减少特征数量（模糊处理）</p></li><li><p>最大值池化：提取图片纹理</p></li><li><p>均值池化：保留背景特征</p></li><li><p>计算</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pool = tf.nn.max_pool([batch, <span class="number">28</span>, <span class="number">28</span>, <span class="number">6</span>], [<span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>], [<span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>], padding=<span class="string">'SAME'</span>) <span class="comment"># tf.nn.avg_pool</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="舍弃-Dropout"><a href="#舍弃-Dropout" class="headerlink" title="舍弃(Dropout)"></a>舍弃(Dropout)</h3><ul><li><p>训练时随机舍弃一些神经元，但是在使用时<strong>会恢复</strong>。</p></li><li><p>实现</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tf.nn.dropout(上层输出， 舍弃的概率)</span><br></pre></td></tr></table></figure><blockquote><p>一般放在<strong>全连接</strong>网络中</p></blockquote></li></ul><h3 id="结构"><a href="#结构" class="headerlink" title="结构"></a>结构</h3><ul><li>卷积</li><li>激活</li><li>池化</li><li>全连接</li></ul><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li>TensorFlow Notebook, Peking University, 2018.</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;全文共&lt;code&gt;3487&lt;/code&gt;字，是暑期学习TensorFlow的记录，推荐按照顺序进行阅读。&lt;/p&gt;
    
    </summary>
    
    
      <category term="AI" scheme="http://yoursite.com/categories/AI/"/>
    
      <category term="Python" scheme="http://yoursite.com/categories/Python/"/>
    
    
  </entry>
  
  <entry>
    <title>Python-Python变量</title>
    <link href="http://yoursite.com/2020/08/30/Python-Python%E5%8F%98%E9%87%8F/"/>
    <id>http://yoursite.com/2020/08/30/Python-Python%E5%8F%98%E9%87%8F/</id>
    <published>2020-08-30T14:40:49.404Z</published>
    <updated>2020-08-30T14:41:36.148Z</updated>
    
    <content type="html"><![CDATA[<p>全文共<code>2007</code>字，推荐阅读时间<code>10~15</code>分钟。</p><a id="more"></a><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>Python里的变量是什么？是一个代号还是具体的内存中存储的值？还是另有它意？</p><p>最近在看《Fluent Python》时受到作者启发，想要记录一些目前关于Python最基础的变量部分的理解，同时也是为了小仙女能把这里搞明白。</p><h2 id="两个概念"><a href="#两个概念" class="headerlink" title="两个概念"></a>两个概念</h2><ul><li><p>变量名</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="number">3</span></span><br></pre></td></tr></table></figure><ul><li><code>a</code>就是我们所说的变量名</li></ul></li><li><p><strong>数据</strong>类型（仅涉及常见类型）</p><ul><li>数字(int/long/float/complex)</li><li>字符串(str)</li><li>列表(list)</li><li>元组(tuple)</li><li>字典(dict)</li></ul><blockquote><p>Q：为什么不是<strong>变量</strong>类型？</p><p>A：在笔者看来，Python是一种<strong>弱类型</strong>语言，变量<strong>没有</strong>固定的类型——今天是数字，明天可能就变成了列表。因此，说<strong>数据类型</strong>分为哪些类相比于<strong>变量类型</strong>更为准确。</p></blockquote></li></ul><p>以上是最常见的关于Python变量的描述，它们具体应该怎么使用并不是本文探讨的重点。因此接下来我们从变量本身的一些性质出发，理解Python中相关的一些特殊情况。</p><h2 id="可变与不可变"><a href="#可变与不可变" class="headerlink" title="可变与不可变"></a>可变与不可变</h2><h3 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h3><ul><li>可变：list/dict</li><li>不可变：tuple/str/int/long/float/complex</li></ul><h3 id="表现"><a href="#表现" class="headerlink" title="表现"></a>表现</h3><p>什么叫可变？就是单纯的可以被改变吗？</p><p>什么是不可变？不可以被改变就叫不可变吗？</p><p>显然，这可能是正确答案，但是一定不是一个准确的答案。</p><p>为了介绍清楚这两者的区别，我们首先介绍一个函数：<code>id()</code>.</p><blockquote><p><code>id()</code>这个函数的作用和它的名字一样简单粗暴：获取<strong>对象</strong>唯一的<strong>标识符</strong>。</p></blockquote><h4 id="标识符"><a href="#标识符" class="headerlink" title="标识符"></a>标识符</h4><p>首先我们先讲讲什么叫做标识符：可以把它理解成身份证号，一个对象<strong>有且仅有</strong>一个的编号。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="number">1</span></span><br><span class="line">id(a) <span class="comment"># 140709554144928</span></span><br></pre></td></tr></table></figure><blockquote><p>不同的电脑和不同版本的Python解释器可能会返回不同的<code>id()</code>结果</p></blockquote><p>接下来就是本文的重点了，什么是对象？</p><h4 id="对象"><a href="#对象" class="headerlink" title="对象"></a>对象</h4><p>这是一个现代编程领域及其复杂的概念，想要通过简单的几句话说清楚并不太现实。但是我们可以抓住主要矛盾进行剖析：<strong>对象的定义在不同的语言中是不同的</strong>。有了这个基本共识之后，我们就可以开始认识Python的对象了。</p><p><strong>Python是一门可以问心无愧地说“一切都是对象”的语言。<del>（至少相比于Java是这样）</del></strong></p><blockquote><p>在Python中，小到<code>int</code>都是一个对象。<del>（Java你倒是看看啊）</del></p></blockquote><p>因此，在Python里，我们可以把<strong>变量</strong>理解成一个我们可以随便取名字的<strong>对象索引</strong>。</p><blockquote><ul><li>刚才就提到了，对象在不同语言里的定义是不同的，因此变量的定义<strong>也是不同的</strong>。</li><li>这仅仅是一个笔者认为简单的理解，不一定严密，如果有不同意见欢迎分享。</li></ul></blockquote><p>那么，什么叫做索引呢？</p><p>我们在生活中看见过书籍索引、楼层索引等等。说白了，它们的作用就是书/房子这个大容器的<strong>路牌</strong>。</p><p>在Python中，变量就是对象的路牌，帮助我们找到对象的具体位置。因此，我们把变量作为参数传递给<code>id()</code>函数后，就可以得到这个变量所对应的对象的身份证号了呢！是不是好神奇~</p><p>说了这么久，请问我们为什么要找对象呢？</p><p><strong>因为对象里存着我们需要的信息啊！</strong></p><p>忙活半天不就是为了处理数据嘛？勿忘初心哦~</p><p>如果看到这里有一点晕，可以把对象这一小节反复读一读，相信聪明的你一定能够理解我想要表达的意思。</p><h3 id="变or不变"><a href="#变or不变" class="headerlink" title="变or不变"></a>变or不变</h3><p>有了前面的铺垫，我们终于可以开始讲什么是可变与不可变了，我们先分析下面的例子。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">l = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">t = (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">l[<span class="number">0</span>] = <span class="number">3</span> <span class="comment"># l: [3, 2, 3]</span></span><br><span class="line">t[<span class="number">0</span>] = <span class="number">3</span> <span class="comment"># Error!</span></span><br></pre></td></tr></table></figure><p>为什么不能进行<code>t[0]</code>的赋值操作呢？相信了解元组最基本特性的您一定知道：<strong>元组不可变！</strong>这是正解没错，那么我们来看看下面的例子呢：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">t = (<span class="number">1</span>, <span class="number">2</span>, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line">t[<span class="number">2</span>].append(<span class="number">4</span>) <span class="comment"># t: (1, 2, [1, 2, 3, 4])</span></span><br></pre></td></tr></table></figure><p>咦？为啥这里元组被修改了？难道元组可变了？</p><p>其实背后的原理就在我们之前讲到的<strong>对象</strong>中：Python的可变和不可变都是针对<strong>对象</strong>而言的，而<strong>不是变量</strong>。</p><p>在第一个例子中，<code>t[0]</code>变量是一个<code>int</code>对象的索引。因为<code>int</code>是不可变的，所以我们如果要改变<code>t[0]</code>，就必须为它<strong>换一个对象</strong>。而这里的换对象，就是改变这个路牌的指向，让它指向另外一个地方。</p><p>刚才我们讲到<code>id()</code>可以获得对象的身份证号，那么我们就来做这样一个实验：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="number">1</span></span><br><span class="line">id(a) <span class="comment"># 140709554144928</span></span><br><span class="line">a = <span class="number">2</span></span><br><span class="line">id(a) <span class="comment"># 140709554144960</span></span><br></pre></td></tr></table></figure><blockquote><p>这说明，<code>a</code>这个路牌的箭头确实被改了，对<code>a</code>值得修改<strong>并没有</strong>在原来存储1的内存位置上发生。</p></blockquote><p>综上，此时我们对元组中的<code>t[0]</code>变量进行修改，就得改变<code>id(t[0])</code>，这触犯了<strong>元组不可变</strong>的特性，因此是不被允许的。</p><p>那么我们现在来看第二个例子：为啥元组又被修改了呢？</p><p>看看<code>t[2]</code>对应的是啥？是<code>[1, 2, 3]</code>这个列表(list)！</p><p>列表是什么类型？可变类型！</p><p>不可变类型<strong>不允许</strong>对象的<code>id</code>发生变化，那么可变类型自然就……<strong>允许</strong>呢！</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">t[<span class="number">2</span>].append(<span class="number">4</span>) <span class="comment"># t: (1, 2, [1, 2, 3, 4])</span></span><br></pre></td></tr></table></figure><p>这一条语句可以被拆成以下的行为：</p><ul><li>获取元组<code>t</code>中的第三个元素<code>t[2]</code>，发现是个可变的列表。</li><li>列表类型的尾部增加元素操作<code>append</code></li></ul><p>这两步中涉及到的变量和对象有：</p><ul><li>变量：指向列表的<code>t[2]</code></li><li>对象：<code>[1, 2, 3]</code>这个<strong>列表</strong>，我们给他起个名字叫<code>a</code>好了。</li></ul><p><code>a</code>列表是可变的，<code>a[0]</code>/<code>a[1]</code>这些都是<strong>变量</strong>，所以我们可以使用<code>append</code>为它增加一个<code>a[3]</code><strong>变量</strong>，并且让它指向数字<code>4</code>这个<strong>对象</strong>。</p><p>因为<code>a</code>是可变的，所以我们对它的修改不需要“另觅新欢”，<strong>只需要在原来的内存位置进行就好了</strong>。</p><p>所以，<code>t[2]</code>这个变量对应对象的<code>id</code>在过程中发生过变化吗？没有！也就是说<code>id(t[2])</code>在增加元素的前后没有变化。以下是控制台的运行结果：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">t = (<span class="number">1</span>, <span class="number">2</span>, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line">id(t[<span class="number">2</span>]) <span class="comment"># 1590806815744</span></span><br><span class="line">t[<span class="number">2</span>].append(<span class="number">4</span>) <span class="comment"># t: (1, 2, [1, 2, 3, 4])</span></span><br><span class="line">id(t[<span class="number">2</span>]) <span class="comment"># 1590806815744</span></span><br></pre></td></tr></table></figure><p>只要<code>id(t[2])</code>没有发生变化，那么元组的不可改变特性<strong>就没有</strong>被破坏，自然就可以这么操作啊！</p><p>但是这是个好现象吗，显然不是的，因此我们要避免在不可变类型中塞进可变的对象，这里使用这个例子只是为了强调Python中变量和对象的关系。</p><h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><ul><li>Python中，一切都是对象。<del>（是真的一切！）</del></li><li>用对象来理解变量，才能更清楚地知道自己使用的变量究竟是什么。</li><li>可变和不可变不要记概念，判断对象的<code>id</code>是否改变最准确。</li><li>希望小仙女看懂了。</li></ul><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li>Fluent Python, Luciano Ramalho.</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;全文共&lt;code&gt;2007&lt;/code&gt;字，推荐阅读时间&lt;code&gt;10~15&lt;/code&gt;分钟。&lt;/p&gt;
    
    </summary>
    
    
      <category term="Python" scheme="http://yoursite.com/categories/Python/"/>
    
    
  </entry>
  
  <entry>
    <title>Django-Chapter4-Query Expressions</title>
    <link href="http://yoursite.com/2020/08/17/Django-Chapter4-Query%20Expressions/"/>
    <id>http://yoursite.com/2020/08/17/Django-Chapter4-Query%20Expressions/</id>
    <published>2020-08-17T03:22:49.731Z</published>
    <updated>2020-08-17T03:27:12.652Z</updated>
    
    <content type="html"><![CDATA[<p>全文共<code>857</code>字，推荐阅读时间<code>7~10</code>分钟。</p><a id="more"></a><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><ul><li><p>Django支持Python的常见运算类型</p></li><li><p>实例</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Count, F, Value</span><br><span class="line"><span class="keyword">from</span> django.db.models.functions <span class="keyword">import</span> Length, Upper</span><br><span class="line"></span><br><span class="line"><span class="comment"># Find companies that have more employees than chairs.</span></span><br><span class="line">Company.objects.filter(num_employees__gt=F(<span class="string">'num_chairs'</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># Find companies that have at least twice as many employees</span></span><br><span class="line"><span class="comment"># as chairs. Both the querysets below are equivalent.</span></span><br><span class="line">Company.objects.filter(num_employees__gt=F(<span class="string">'num_chairs'</span>) * <span class="number">2</span>)</span><br><span class="line">Company.objects.filter(</span><br><span class="line">    num_employees__gt=F(<span class="string">'num_chairs'</span>) + F(<span class="string">'num_chairs'</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># How many chairs are needed for each company to seat all employees?</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>company = Company.objects.filter(</span><br><span class="line"><span class="meta">... </span>   num_employees__gt=F(<span class="string">'num_chairs'</span>)).annotate(</span><br><span class="line"><span class="meta">... </span>   chairs_needed=F(<span class="string">'num_employees'</span>) - F(<span class="string">'num_chairs'</span>)).first()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>company.num_employees</span><br><span class="line"><span class="number">120</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>company.num_chairs</span><br><span class="line"><span class="number">50</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>company.chairs_needed</span><br><span class="line"><span class="number">70</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create a new company using expressions.</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>company = Company.objects.create(name=<span class="string">'Google'</span>, ticker=Upper(Value(<span class="string">'goog'</span>)))</span><br><span class="line"><span class="comment"># Be sure to refresh it if you need to access the field.</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>company.refresh_from_db()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>company.ticker</span><br><span class="line"><span class="string">'GOOG'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Annotate models with an aggregated value. Both forms</span></span><br><span class="line"><span class="comment"># below are equivalent.</span></span><br><span class="line">Company.objects.annotate(num_products=Count(<span class="string">'products'</span>))</span><br><span class="line">Company.objects.annotate(num_products=Count(F(<span class="string">'products'</span>)))</span><br><span class="line"></span><br><span class="line"><span class="comment"># Aggregates can contain complex computations also</span></span><br><span class="line">Company.objects.annotate(num_offerings=Count(F(<span class="string">'products'</span>) + F(<span class="string">'services'</span>)))</span><br><span class="line"></span><br><span class="line"><span class="comment"># Expressions can also be used in order_by(), either directly</span></span><br><span class="line">Company.objects.order_by(Length(<span class="string">'name'</span>).asc())</span><br><span class="line">Company.objects.order_by(Length(<span class="string">'name'</span>).desc())</span><br><span class="line"><span class="comment"># or using the double underscore lookup syntax.</span></span><br><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> CharField</span><br><span class="line"><span class="keyword">from</span> django.db.models.functions <span class="keyword">import</span> Length</span><br><span class="line">CharField.register_lookup(Length)</span><br><span class="line">Company.objects.order_by(<span class="string">'name__length'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Boolean expression can be used directly in filters.</span></span><br><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Exists</span><br><span class="line">Company.objects.filter(</span><br><span class="line">    Exists(Employee.objects.filter(company=OuterRef(<span class="string">'pk'</span>), salary__gt=<span class="number">10</span>))</span><br><span class="line">)</span><br></pre></td></tr></table></figure></li></ul><h2 id="内置表达式"><a href="#内置表达式" class="headerlink" title="内置表达式"></a>内置表达式</h2><h3 id="F"><a href="#F" class="headerlink" title="F()"></a>F()</h3><ul><li><p>直接访问数据库而不是让Python来操作</p><blockquote><p>可以<strong>避免竞争</strong></p></blockquote></li><li><p>减少检索语句</p></li></ul><h4 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> F</span><br><span class="line"></span><br><span class="line">reporter = Reporters.objects.get(name=<span class="string">'Tintin'</span>)</span><br><span class="line">reporter.stories_filed = F(<span class="string">'stories_filed'</span>) + <span class="number">1</span></span><br><span class="line">reporter.save()</span><br><span class="line">reporter = Reporters.objects.get(pk=reporter.pk)</span><br><span class="line"><span class="comment"># Or, more succinctly:</span></span><br><span class="line">reporter.refresh_from_db()</span><br></pre></td></tr></table></figure><ul><li><p>想要获取正确的新值，需要调用<code>refresh_from_db</code>.</p><ul><li><p><code>F</code>语句造成的更新在所有的<code>save</code>中都会生效，因此需要每次<code>save</code>后调用<code>refresh_from_db</code>.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">reporter = Reporters.objects.get(name=<span class="string">'Tintin'</span>)</span><br><span class="line">reporter.stories_filed = F(<span class="string">'stories_filed'</span>) + <span class="number">1</span></span><br><span class="line">reporter.save()</span><br><span class="line"></span><br><span class="line">reporter.name = <span class="string">'Tintin Jr.'</span></span><br><span class="line">reporter.save()</span><br></pre></td></tr></table></figure><blockquote><p><code>stories_filed</code>的终值是3</p></blockquote></li></ul></li><li><p>使用<code>update</code>简化</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">reporter = Reporters.objects.filter(name=<span class="string">'Tintin'</span>)</span><br><span class="line">reporter.update(stories_filed=F(<span class="string">'stories_filed'</span>) + <span class="number">1</span>)</span><br></pre></td></tr></table></figure></li></ul><h4 id="F-amp-Other-Query-Expressions"><a href="#F-amp-Other-Query-Expressions" class="headerlink" title="F()&amp;Other Query Expressions"></a>F()&amp;Other Query Expressions</h4><ul><li><p><code>filter</code></p></li><li><p><code>annotate</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">company = Company.objects.annotate(</span><br><span class="line">    chairs_needed=F(<span class="string">'num_employees'</span>) - F(<span class="string">'num_chairs'</span>))</span><br></pre></td></tr></table></figure><ul><li><p>当返回类型不确定时，需要使用<strong>包装器</strong>进行指定。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> DateTimeField, ExpressionWrapper, F</span><br><span class="line"></span><br><span class="line">Ticket.objects.annotate(</span><br><span class="line">    expires=ExpressionWrapper(</span><br><span class="line">        F(<span class="string">'active_at'</span>) + F(<span class="string">'duration'</span>), output_field=DateTimeField()))</span><br></pre></td></tr></table></figure></li><li><p>访问外键域时，<code>F()</code>返回的是<strong>主键值</strong>，而<strong>不是实例</strong>。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; car = Company.objects.annotate(built_by=F(<span class="string">'manufacturer'</span>))[<span class="number">0</span>]</span><br><span class="line">&gt;&gt; car.manufacturer</span><br><span class="line">&lt;Manufacturer: Toyota&gt;</span><br><span class="line">&gt;&gt; car.built_by</span><br><span class="line"><span class="number">3</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p>对<code>null</code>排序</p><p>通过<code>asc()</code>和<code>desc()</code>实现</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> F</span><br><span class="line">Company.objects.order_by(F(<span class="string">'last_contacted'</span>).desc(nulls_last=<span class="literal">True</span>))</span><br></pre></td></tr></table></figure></li></ul><h3 id="Func"><a href="#Func" class="headerlink" title="Func()"></a>Func()</h3><ul><li><code>Func()</code>是所有数据库函数的基础函数</li></ul><h3 id="Aggregate"><a href="#Aggregate" class="headerlink" title="Aggregate()"></a>Aggregate()</h3><ul><li><code>Aggregate()</code>是所有聚集函数的基础函数，例如<code>Sum()</code>/<code>Count()</code>.</li></ul><h3 id="Value"><a href="#Value" class="headerlink" title="Value()"></a>Value()</h3><ul><li>很少直接使用，但是在底层很重要。</li></ul><h3 id="ExpressionWrapper"><a href="#ExpressionWrapper" class="headerlink" title="ExpressionWrapper()"></a>ExpressionWrapper()</h3><ul><li>在使用<code>F()</code>时常常辅助使用</li></ul><h3 id="Subquery"><a href="#Subquery" class="headerlink" title="Subquery()"></a>Subquery()</h3><ul><li><p><code>class Subquery(queryset, output_field=None)</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> django.db.models <span class="keyword">import</span> OuterRef, Subquery</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>newest = Comment.objects.filter(post=OuterRef(<span class="string">'pk'</span>)).order_by(<span class="string">'-created_at'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Post.objects.annotate(newest_commenter_email=Subquery(newest.values(<span class="string">'email'</span>)[:<span class="number">1</span>]))</span><br></pre></td></tr></table></figure></li><li><p><code>OuterRef(field)</code>：在<code>Subquery</code>内部的<code>QuerySet</code>需要查询<strong>外部域</strong>时使用</p></li><li><p>限制<code>Subquery()</code>为<strong>一列</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> datetime <span class="keyword">import</span> timedelta</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> django.utils <span class="keyword">import</span> timezone</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>one_day_ago = timezone.now() - timedelta(days=<span class="number">1</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>posts = Post.objects.filter(published_at__gte=one_day_ago)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Comment.objects.filter(post__in=Subquery(posts.values(<span class="string">'pk'</span>)))</span><br></pre></td></tr></table></figure></li><li><p>限制<code>Subquery()</code>为一行</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>subquery = Subquery(newest.values(<span class="string">'email'</span>)[:<span class="number">1</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Post.objects.annotate(newest_commenter_email=subquery)</span><br></pre></td></tr></table></figure><blockquote><p>不能使用<code>get()</code>，因为<code>OuterRef</code>只有在<code>Subquery</code>内才会被解析。</p></blockquote></li><li><p><code>Exists()</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Exists, OuterRef</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> datetime <span class="keyword">import</span> timedelta</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> django.utils <span class="keyword">import</span> timezone</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>one_day_ago = timezone.now() - timedelta(days=<span class="number">1</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>recent_comments = Comment.objects.filter(</span><br><span class="line"><span class="meta">... </span>    post=OuterRef(<span class="string">'pk'</span>),</span><br><span class="line"><span class="meta">... </span>    created_at__gte=one_day_ago,</span><br><span class="line"><span class="meta">... </span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Post.objects.annotate(recent_comment=Exists(recent_comments))</span><br></pre></td></tr></table></figure><ul><li><code>~Exists()</code>即不存在</li></ul></li><li><p>在<code>Subquery</code>内使用<code>aggregation</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> django.db.models <span class="keyword">import</span> OuterRef, Subquery, Sum</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>comments = Comment.objects.filter(post=OuterRef(<span class="string">'pk'</span>)).order_by().values(<span class="string">'post'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>total_comments = comments.annotate(total=Sum(<span class="string">'length'</span>)).values(<span class="string">'total'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Post.objects.filter(length__gt=Subquery(total_comments))</span><br></pre></td></tr></table></figure></li></ul><h2 id="Expression-API"><a href="#Expression-API" class="headerlink" title="Expression API"></a>Expression API</h2><ul><li><p><code>get_source_expressions()</code>：返回内部表达式的列表</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>Sum(F(<span class="string">'foo'</span>)).get_source_expressions()</span><br><span class="line">[F(<span class="string">'foo'</span>)]</span><br></pre></td></tr></table></figure><ul><li><code>set_source_expressions()</code>是逆操作</li></ul></li><li><p><code>asc(nulls_first=False, nulls_last=False)</code>：返回访问后<strong>升序</strong>表达式</p></li><li><p><code>desc(nulls_first=False, nulls_last=False)</code>：返回访问后<strong>降序</strong>表达式</p></li><li><p><code>reverse_ordering()</code></p></li></ul><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://docs.djangoproject.com/en/3.1/ref/models/expressions/" target="_blank" rel="noopener">https://docs.djangoproject.com/en/3.1/ref/models/expressions/</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;全文共&lt;code&gt;857&lt;/code&gt;字，推荐阅读时间&lt;code&gt;7~10&lt;/code&gt;分钟。&lt;/p&gt;
    
    </summary>
    
    
      <category term="Web" scheme="http://yoursite.com/categories/Web/"/>
    
      <category term="Django" scheme="http://yoursite.com/categories/Django/"/>
    
    
  </entry>
  
  <entry>
    <title>Django-Chapter5-Conditional Expressions</title>
    <link href="http://yoursite.com/2020/08/17/Django-Chapter5-Conditional%20Expressions/"/>
    <id>http://yoursite.com/2020/08/17/Django-Chapter5-Conditional%20Expressions/</id>
    <published>2020-08-17T03:22:49.731Z</published>
    <updated>2020-08-17T03:25:36.413Z</updated>
    
    <content type="html"><![CDATA[<p>全文共<code>620</code>字，推荐阅读时间<code>7~10</code>分钟。</p><a id="more"></a><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><ul><li><p>条件表达式用于在<code>filter</code>/<code>annotate</code>/<code>aggregate</code>/<code>update</code>中实现<code>if</code>逻辑。</p></li><li><p>取以下模型为例</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Client</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    REGULAR = <span class="string">'R'</span></span><br><span class="line">    GOLD = <span class="string">'G'</span></span><br><span class="line">    PLATINUM = <span class="string">'P'</span></span><br><span class="line">    ACCOUNT_TYPE_CHOICES = [</span><br><span class="line">        (REGULAR, <span class="string">'Regular'</span>),</span><br><span class="line">        (GOLD, <span class="string">'Gold'</span>),</span><br><span class="line">        (PLATINUM, <span class="string">'Platinum'</span>),</span><br><span class="line">    ]</span><br><span class="line">    name = models.CharField(max_length=<span class="number">50</span>)</span><br><span class="line">    registered_on = models.DateField()</span><br><span class="line">    account_type = models.CharField(</span><br><span class="line">        max_length=<span class="number">1</span>,</span><br><span class="line">        choices=ACCOUNT_TYPE_CHOICES,</span><br><span class="line">        default=REGULAR,</span><br><span class="line">    )</span><br></pre></td></tr></table></figure></li></ul><h2 id="When"><a href="#When" class="headerlink" title="When"></a>When</h2><ul><li><p><code>class When(condition=None, then=None, **lookups)</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> django.db.models <span class="keyword">import</span> F, Q, When</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># String arguments refer to fields; the following two examples are equivalent:</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>When(account_type=Client.GOLD, then=<span class="string">'name'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>When(account_type=Client.GOLD, then=F(<span class="string">'name'</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># You can use field lookups in the condition</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> datetime <span class="keyword">import</span> date</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>When(registered_on__gt=date(<span class="number">2014</span>, <span class="number">1</span>, <span class="number">1</span>),</span><br><span class="line"><span class="meta">... </span>     registered_on__lt=date(<span class="number">2015</span>, <span class="number">1</span>, <span class="number">1</span>),</span><br><span class="line"><span class="meta">... </span>     then=<span class="string">'account_type'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># Complex conditions can be created using Q objects</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>When(Q(name__startswith=<span class="string">"John"</span>) | Q(name__startswith=<span class="string">"Paul"</span>),</span><br><span class="line"><span class="meta">... </span>     then=<span class="string">'name'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># Condition can be created using boolean expressions.</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Exists, OuterRef</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>non_unique_account_type = Client.objects.filter(</span><br><span class="line"><span class="meta">... </span>    account_type=OuterRef(<span class="string">'account_type'</span>),</span><br><span class="line"><span class="meta">... </span>).exclude(pk=OuterRef(<span class="string">'pk'</span>)).values(<span class="string">'pk'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>When(Exists(non_unique_account_type), then=Value(<span class="string">'non unique'</span>))</span><br></pre></td></tr></table></figure><ul><li><code>When</code>接收返回布尔值的表达式，根据<code>then</code><strong>确定</strong>返回值。</li></ul></li></ul><h2 id="Case"><a href="#Case" class="headerlink" title="Case"></a>Case</h2><ul><li><p><code>class Case(*cases, **extra)</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> datetime <span class="keyword">import</span> date, timedelta</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Case, Value, When</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Client.objects.create(</span><br><span class="line"><span class="meta">... </span>    name=<span class="string">'Jane Doe'</span>,</span><br><span class="line"><span class="meta">... </span>    account_type=Client.REGULAR,</span><br><span class="line"><span class="meta">... </span>    registered_on=date.today() - timedelta(days=<span class="number">36</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Client.objects.create(</span><br><span class="line"><span class="meta">... </span>    name=<span class="string">'James Smith'</span>,</span><br><span class="line"><span class="meta">... </span>    account_type=Client.GOLD,</span><br><span class="line"><span class="meta">... </span>    registered_on=date.today() - timedelta(days=<span class="number">5</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Client.objects.create(</span><br><span class="line"><span class="meta">... </span>    name=<span class="string">'Jack Black'</span>,</span><br><span class="line"><span class="meta">... </span>    account_type=Client.PLATINUM,</span><br><span class="line"><span class="meta">... </span>    registered_on=date.today() - timedelta(days=<span class="number">10</span> * <span class="number">365</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># Get the discount for each Client based on the account type</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Client.objects.annotate(</span><br><span class="line"><span class="meta">... </span>    discount=Case(</span><br><span class="line"><span class="meta">... </span>        When(account_type=Client.GOLD, then=Value(<span class="string">'5%'</span>)),</span><br><span class="line"><span class="meta">... </span>        When(account_type=Client.PLATINUM, then=Value(<span class="string">'10%'</span>)),</span><br><span class="line"><span class="meta">... </span>        default=Value(<span class="string">'0%'</span>),</span><br><span class="line"><span class="meta">... </span>    ),</span><br><span class="line"><span class="meta">... </span>).values_list(<span class="string">'name'</span>, <span class="string">'discount'</span>)</span><br><span class="line">&lt;QuerySet [(<span class="string">'Jane Doe'</span>, <span class="string">'0%'</span>), (<span class="string">'James Smith'</span>, <span class="string">'5%'</span>), (<span class="string">'Jack Black'</span>, <span class="string">'10%'</span>)]&gt;</span><br></pre></td></tr></table></figure><ul><li><p><code>Case</code>根据传入的<code>When</code>表达式选择返回值（类似<code>switich-case</code>语句）</p><blockquote><p><code>Case</code>实际上就是在组织多个<code>When</code></p></blockquote></li></ul></li><li><p><code>Case</code>&amp;<code>filter</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a_month_ago = date.today() - timedelta(days=<span class="number">30</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a_year_ago = date.today() - timedelta(days=<span class="number">365</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Client.objects.filter(</span><br><span class="line"><span class="meta">... </span>    registered_on__lte=Case(</span><br><span class="line"><span class="meta">... </span>        When(account_type=Client.GOLD, then=a_month_ago),</span><br><span class="line"><span class="meta">... </span>        When(account_type=Client.PLATINUM, then=a_year_ago),</span><br><span class="line"><span class="meta">... </span>    ),</span><br><span class="line"><span class="meta">... </span>).values_list(<span class="string">'name'</span>, <span class="string">'account_type'</span>)</span><br><span class="line">&lt;QuerySet [(<span class="string">'Jack Black'</span>, <span class="string">'P'</span>)]&gt;</span><br></pre></td></tr></table></figure></li></ul><h2 id="高级查询"><a href="#高级查询" class="headerlink" title="高级查询"></a>高级查询</h2><h3 id="条件更新"><a href="#条件更新" class="headerlink" title="条件更新"></a>条件更新</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a_month_ago = date.today() - timedelta(days=<span class="number">30</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a_year_ago = date.today() - timedelta(days=<span class="number">365</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># Update the account_type for each Client from the registration date</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Client.objects.update(</span><br><span class="line"><span class="meta">... </span>    account_type=Case(</span><br><span class="line"><span class="meta">... </span>        When(registered_on__lte=a_year_ago,</span><br><span class="line"><span class="meta">... </span>             then=Value(Client.PLATINUM)),</span><br><span class="line"><span class="meta">... </span>        When(registered_on__lte=a_month_ago,</span><br><span class="line"><span class="meta">... </span>             then=Value(Client.GOLD)),</span><br><span class="line"><span class="meta">... </span>        default=Value(Client.REGULAR)</span><br><span class="line"><span class="meta">... </span>    ),</span><br><span class="line"><span class="meta">... </span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Client.objects.values_list(<span class="string">'name'</span>, <span class="string">'account_type'</span>)</span><br><span class="line">&lt;QuerySet [(<span class="string">'Jane Doe'</span>, <span class="string">'G'</span>), (<span class="string">'James Smith'</span>, <span class="string">'R'</span>), (<span class="string">'Jack Black'</span>, <span class="string">'P'</span>)]&gt;</span><br></pre></td></tr></table></figure><h3 id="条件聚合"><a href="#条件聚合" class="headerlink" title="条件聚合"></a>条件聚合</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># Create some more Clients first so we can have something to count</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Client.objects.create(</span><br><span class="line"><span class="meta">... </span>    name=<span class="string">'Jean Grey'</span>,</span><br><span class="line"><span class="meta">... </span>    account_type=Client.REGULAR,</span><br><span class="line"><span class="meta">... </span>    registered_on=date.today())</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Client.objects.create(</span><br><span class="line"><span class="meta">... </span>    name=<span class="string">'James Bond'</span>,</span><br><span class="line"><span class="meta">... </span>    account_type=Client.PLATINUM,</span><br><span class="line"><span class="meta">... </span>    registered_on=date.today())</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Client.objects.create(</span><br><span class="line"><span class="meta">... </span>    name=<span class="string">'Jane Porter'</span>,</span><br><span class="line"><span class="meta">... </span>    account_type=Client.PLATINUM,</span><br><span class="line"><span class="meta">... </span>    registered_on=date.today())</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># Get counts for each value of account_type</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Count</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Client.objects.aggregate(</span><br><span class="line"><span class="meta">... </span>    regular=Count(<span class="string">'pk'</span>, filter=Q(account_type=Client.REGULAR)),</span><br><span class="line"><span class="meta">... </span>    gold=Count(<span class="string">'pk'</span>, filter=Q(account_type=Client.GOLD)),</span><br><span class="line"><span class="meta">... </span>    platinum=Count(<span class="string">'pk'</span>, filter=Q(account_type=Client.PLATINUM)),</span><br><span class="line"><span class="meta">... </span>)</span><br><span class="line">&#123;<span class="string">'regular'</span>: <span class="number">2</span>, <span class="string">'gold'</span>: <span class="number">1</span>, <span class="string">'platinum'</span>: <span class="number">3</span>&#125;</span><br></pre></td></tr></table></figure><h3 id="条件过滤"><a href="#条件过滤" class="headerlink" title="条件过滤"></a>条件过滤</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>non_unique_account_type = Client.objects.filter(</span><br><span class="line"><span class="meta">... </span>    account_type=OuterRef(<span class="string">'account_type'</span>),</span><br><span class="line"><span class="meta">... </span>).exclude(pk=OuterRef(<span class="string">'pk'</span>)).values(<span class="string">'pk'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Client.objects.filter(~Exists(non_unique_account_type))</span><br></pre></td></tr></table></figure><ul><li><code>OuterRef()</code>的作用类似于<code>F()</code></li></ul><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://docs.djangoproject.com/en/dev/ref/models/conditional-expressions/" target="_blank" rel="noopener">https://docs.djangoproject.com/en/dev/ref/models/conditional-expressions/</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;全文共&lt;code&gt;620&lt;/code&gt;字，推荐阅读时间&lt;code&gt;7~10&lt;/code&gt;分钟。&lt;/p&gt;
    
    </summary>
    
    
      <category term="Web" scheme="http://yoursite.com/categories/Web/"/>
    
      <category term="Django" scheme="http://yoursite.com/categories/Django/"/>
    
    
  </entry>
  
  <entry>
    <title>Django-Chapter3-Aggregation</title>
    <link href="http://yoursite.com/2020/08/16/Django-Chapter3-Aggregation/"/>
    <id>http://yoursite.com/2020/08/16/Django-Chapter3-Aggregation/</id>
    <published>2020-08-16T07:18:24.832Z</published>
    <updated>2020-08-16T07:18:58.632Z</updated>
    
    <content type="html"><![CDATA[<p>全文共<code>934</code>字，推荐阅读时间<code>10~15</code>分钟。</p><a id="more"></a><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><ul><li><p>用于不同对象的<strong>组合信息</strong>查询</p></li><li><p>小节基础模型</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Author</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">100</span>)</span><br><span class="line">    age = models.IntegerField()</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Publisher</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">300</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Book</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">300</span>)</span><br><span class="line">    pages = models.IntegerField()</span><br><span class="line">    price = models.DecimalField(max_digits=<span class="number">10</span>, decimal_places=<span class="number">2</span>)</span><br><span class="line">    rating = models.FloatField()</span><br><span class="line">    authors = models.ManyToManyField(Author)</span><br><span class="line">    publisher = models.ForeignKey(Publisher, on_delete=models.CASCADE)</span><br><span class="line">    pubdate = models.DateField()</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Store</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">300</span>)</span><br><span class="line">    books = models.ManyToManyField(Book)</span><br></pre></td></tr></table></figure></li></ul><h2 id="Cheat-sheet"><a href="#Cheat-sheet" class="headerlink" title="Cheat sheet"></a>Cheat sheet</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Total number of books.</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Book.objects.count()</span><br><span class="line"><span class="number">2452</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Total number of books with publisher=BaloneyPress</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Book.objects.filter(publisher__name=<span class="string">'BaloneyPress'</span>).count()</span><br><span class="line"><span class="number">73</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Average price across all books.</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Avg</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Book.objects.all().aggregate(Avg(<span class="string">'price'</span>))</span><br><span class="line">&#123;<span class="string">'price__avg'</span>: <span class="number">34.35</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Max price across all books.</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Max</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Book.objects.all().aggregate(Max(<span class="string">'price'</span>))</span><br><span class="line">&#123;<span class="string">'price__max'</span>: Decimal(<span class="string">'81.20'</span>)&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Difference between the highest priced book and the average price of all books.</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> django.db.models <span class="keyword">import</span> FloatField</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Book.objects.aggregate(</span><br><span class="line"><span class="meta">... </span>    price_diff=Max(<span class="string">'price'</span>, output_field=FloatField()) - Avg(<span class="string">'price'</span>))</span><br><span class="line">&#123;<span class="string">'price_diff'</span>: <span class="number">46.85</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># All the following queries involve traversing the Book&lt;-&gt;Publisher</span></span><br><span class="line"><span class="comment"># foreign key relationship backwards.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Each publisher, each with a count of books as a "num_books" attribute.</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Count</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pubs = Publisher.objects.annotate(num_books=Count(<span class="string">'book'</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pubs</span><br><span class="line">&lt;QuerySet [&lt;Publisher: BaloneyPress&gt;, &lt;Publisher: SalamiPress&gt;, ...]&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pubs[<span class="number">0</span>].num_books</span><br><span class="line"><span class="number">73</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Each publisher, with a separate count of books with a rating above and below 5</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Q</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>above_5 = Count(<span class="string">'book'</span>, filter=Q(book__rating__gt=<span class="number">5</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>below_5 = Count(<span class="string">'book'</span>, filter=Q(book__rating__lte=<span class="number">5</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pubs = Publisher.objects.annotate(below_5=below_5).annotate(above_5=above_5)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pubs[<span class="number">0</span>].above_5</span><br><span class="line"><span class="number">23</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pubs[<span class="number">0</span>].below_5</span><br><span class="line"><span class="number">12</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The top 5 publishers, in order by number of books.</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pubs = Publisher.objects.annotate(num_books=Count(<span class="string">'book'</span>)).order_by(<span class="string">'-num_books'</span>)[:<span class="number">5</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pubs[<span class="number">0</span>].num_books</span><br><span class="line"><span class="number">1323</span></span><br></pre></td></tr></table></figure><h2 id="创建"><a href="#创建" class="headerlink" title="创建"></a>创建</h2><ul><li><p>对<code>QuerySet</code>使用<code>.aggregate()</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Avg</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Book.objects.all().aggregate(Avg(<span class="string">'price'</span>))</span><br><span class="line">&#123;<span class="string">'price__avg'</span>: <span class="number">34.35</span>&#125;</span><br><span class="line"><span class="comment"># identical</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Book.objects.aggregate(Avg(<span class="string">'price'</span>))</span><br><span class="line">&#123;<span class="string">'price__avg'</span>: <span class="number">34.35</span>&#125;</span><br></pre></td></tr></table></figure><ul><li><p>可以自定义返回的域名</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>Book.objects.aggregate(average_price=Avg(<span class="string">'price'</span>))</span><br><span class="line">&#123;<span class="string">'average_price'</span>: <span class="number">34.35</span>&#125;</span><br></pre></td></tr></table></figure></li><li><p>返回多个组合结果</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Avg, Max, Min</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Book.objects.aggregate(Avg(<span class="string">'price'</span>), Max(<span class="string">'price'</span>), Min(<span class="string">'price'</span>))</span><br><span class="line">&#123;<span class="string">'price__avg'</span>: <span class="number">34.35</span>, <span class="string">'price__max'</span>: Decimal(<span class="string">'81.20'</span>), <span class="string">'price__min'</span>: Decimal(<span class="string">'12.99'</span>)&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>对<code>QuerySet</code>使用<code>.annotate()</code>作用在<strong>每个实例</strong>上</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Build an annotated queryset</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Count</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>q = Book.objects.annotate(Count(<span class="string">'authors'</span>))</span><br><span class="line"><span class="comment"># Interrogate the first object in the queryset</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>q[<span class="number">0</span>]</span><br><span class="line">&lt;Book: The Definitive Guide to Django&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>q[<span class="number">0</span>].authors__count</span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="comment"># Interrogate the second object in the queryset</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>q[<span class="number">1</span>]</span><br><span class="line">&lt;Book: Practical Django Projects&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>q[<span class="number">1</span>].authors__count</span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure><ul><li><p>域名可以自定义，否则默认为<code>FOO_function</code>.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>q = Book.objects.annotate(num_authors=Count(<span class="string">'authors'</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>q[<span class="number">0</span>].num_authors</span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>q[<span class="number">1</span>].num_authors</span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure></li><li><p><code>annotate()</code>支持<strong>链式</strong>调用，但是<code>aggregate()</code><strong>不支持</strong>。</p></li><li><p><code>annotate()</code><strong>传入多个参数</strong>时，由于结果叠加，可能会造成错误。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>book = Book.objects.first()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>book.authors.count()</span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>book.store_set.count()</span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>q = Book.objects.annotate(Count(<span class="string">'authors'</span>), Count(<span class="string">'store'</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>q[<span class="number">0</span>].authors__count</span><br><span class="line"><span class="number">6</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>q[<span class="number">0</span>].store__count</span><br><span class="line"><span class="number">6</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>q = Book.objects.annotate(Count(<span class="string">'authors'</span>, distinct=<span class="literal">True</span>), Count(<span class="string">'store'</span>, distinct=<span class="literal">True</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>q[<span class="number">0</span>].authors__count</span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>q[<span class="number">0</span>].store__count</span><br><span class="line"><span class="number">3</span></span><br></pre></td></tr></table></figure></li><li><p>可以进行域扩展</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>Store.objects.aggregate(min_price=Min(<span class="string">'books__price'</span>), max_price=Max(<span class="string">'books__price'</span>))</span><br></pre></td></tr></table></figure></li><li><p>逆向查询</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Avg, Count, Min, Sum</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Publisher.objects.annotate(Count(<span class="string">'book'</span>))</span><br></pre></td></tr></table></figure><ul><li><p><code>Count()</code>的参数是<strong>小写</strong>Model名</p></li><li><p>可以进行域扩展</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>Author.objects.annotate(total_pages=Sum(<span class="string">'book__pages'</span>))</span><br></pre></td></tr></table></figure></li></ul></li></ul></li><li><p><code>aggregate</code>/<code>annotate</code>&amp;other functions</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>Book.objects.filter(name__startswith=<span class="string">"Django"</span>).aggregate(Avg(<span class="string">'price'</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Book.objects.annotate(num_authors=Count(<span class="string">'authors'</span>)).filter(num_authors__gt=<span class="number">1</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>highly_rated = Count(<span class="string">'book'</span>, filter=Q(book__rating__gte=<span class="number">7</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Author.objects.annotate(num_books=Count(<span class="string">'book'</span>), highly_rated_books=highly_rated)</span><br></pre></td></tr></table></figure><ul><li><code>Author</code>查询集中的元素都会有<code>num_books</code>和<code>highly_rated_books</code>两个元素</li></ul></li><li><p><code>order_by()</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>Book.objects.annotate(num_authors=Count(<span class="string">'authors'</span>)).order_by(<span class="string">'num_authors'</span>)</span><br></pre></td></tr></table></figure></li><li><p><code>values()</code>：返回包含<strong>数据字典</strong>对象的<code>QuerySet</code>，<strong>不是</strong>实例。（相当于从数据库中查到了所有的数据并缓存在<code>QuerySet</code>中）</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>Blog.objects.filter(name__startswith=<span class="string">'Beatles'</span>)</span><br><span class="line">&lt;QuerySet [&lt;Blog: Beatles Blog&gt;]&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Blog.objects.filter(name__startswith=<span class="string">'Beatles'</span>).values()</span><br><span class="line">&lt;QuerySet [&#123;<span class="string">'id'</span>: <span class="number">1</span>, <span class="string">'name'</span>: <span class="string">'Beatles Blog'</span>, <span class="string">'tagline'</span>: <span class="string">'All the latest Beatles news.'</span>&#125;]&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Blog.objects.values(<span class="string">'id'</span>, <span class="string">'name'</span>)</span><br><span class="line">&lt;QuerySet [&#123;<span class="string">'id'</span>: <span class="number">1</span>, <span class="string">'name'</span>: <span class="string">'Beatles Blog'</span>&#125;]&gt;</span><br></pre></td></tr></table></figure><ul><li>将<code>Author</code>中<code>name</code>相同的对象合并为一组进行<code>annotate</code>操作</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>Author.objects.values(<span class="string">'name'</span>).annotate(average_rating=Avg(<span class="string">'book__rating'</span>))</span><br></pre></td></tr></table></figure><blockquote><p>尽管<code>values</code>没有取<code>book</code>域，但是<code>annotate</code>依然可以使用<strong>其他域</strong>的内容。</p></blockquote><ul><li><code>values</code>在<code>annotate</code>之后则需要<strong>手动增加</strong>选择的域</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>Author.objects.annotate(average_rating=Avg(<span class="string">'book__rating'</span>)).values(<span class="string">'name'</span>, <span class="string">'average_rating'</span>)</span><br></pre></td></tr></table></figure><blockquote><p>每个<code>Author</code>对象都会增加<code>average_rating</code>域，但是返回的对象中<strong>只有</strong><code>name</code>/<code>average_rating</code>两个域。</p></blockquote></li><li><p>当对象已经默认有排序元素时，需要重新调用<code>order_by</code>避免出现<strong>多要素排序</strong>。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Warning: not quite correct!</span></span><br><span class="line">Item.objects.values(<span class="string">"data"</span>).annotate(Count(<span class="string">"id"</span>))</span><br><span class="line"><span class="comment"># correct</span></span><br><span class="line">Item.objects.values(<span class="string">"data"</span>).annotate(Count(<span class="string">"id"</span>)).order_by()</span><br></pre></td></tr></table></figure></li></ul><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://docs.djangoproject.com/en/dev/topics/db/aggregation/" target="_blank" rel="noopener">https://docs.djangoproject.com/en/dev/topics/db/aggregation/</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;全文共&lt;code&gt;934&lt;/code&gt;字，推荐阅读时间&lt;code&gt;10~15&lt;/code&gt;分钟。&lt;/p&gt;
    
    </summary>
    
    
      <category term="Web" scheme="http://yoursite.com/categories/Web/"/>
    
      <category term="Django" scheme="http://yoursite.com/categories/Django/"/>
    
    
  </entry>
  
  <entry>
    <title>Django-Chapter2-Making queries</title>
    <link href="http://yoursite.com/2020/08/16/Django-Chapter2-Making%20queries/"/>
    <id>http://yoursite.com/2020/08/16/Django-Chapter2-Making%20queries/</id>
    <published>2020-08-16T01:38:54.400Z</published>
    <updated>2020-08-16T01:41:28.141Z</updated>
    
    <content type="html"><![CDATA[<p>全文共<code>2291</code>字，推荐阅读时间<code>20~25</code>分钟</p><a id="more"></a><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><ul><li><p>本节的查询都建立在如下模型上</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Blog</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">100</span>)</span><br><span class="line">    tagline = models.TextField()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.name</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Author</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">200</span>)</span><br><span class="line">    email = models.EmailField()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.name</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Entry</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    blog = models.ForeignKey(Blog, on_delete=models.CASCADE)</span><br><span class="line">    headline = models.CharField(max_length=<span class="number">255</span>)</span><br><span class="line">    body_text = models.TextField()</span><br><span class="line">    pub_date = models.DateField()</span><br><span class="line">    mod_date = models.DateField()</span><br><span class="line">    authors = models.ManyToManyField(Author)</span><br><span class="line">    number_of_comments = models.IntegerField()</span><br><span class="line">    number_of_pingbacks = models.IntegerField()</span><br><span class="line">    rating = models.IntegerField()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.headline</span><br></pre></td></tr></table></figure></li></ul><h2 id="创建"><a href="#创建" class="headerlink" title="创建"></a>创建</h2><ul><li>使用关键词参数创建实例</li><li>调用<code>save()</code>操作（<strong>没有</strong>返回值）</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> blog.models <span class="keyword">import</span> Blog</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = Blog(name=<span class="string">'Beatles Blog'</span>, tagline=<span class="string">'All the latest Beatles news.'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b.save()</span><br></pre></td></tr></table></figure><blockquote><p>使用<code>create()</code>可以合并上述两步</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">p = Person.objects.create(first_name=<span class="string">"Bruce"</span>, last_name=<span class="string">"Springsteen"</span>)</span><br></pre></td></tr></table></figure></blockquote><h3 id="修改对象"><a href="#修改对象" class="headerlink" title="修改对象"></a>修改对象</h3><ul><li>修改</li><li>调用<code>save()</code>操作（<strong>没有</strong>返回值）</li></ul><h3 id="修改关系"><a href="#修改关系" class="headerlink" title="修改关系"></a>修改关系</h3><ul><li><p><code>ForeignKey</code></p>  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> blog.models <span class="keyword">import</span> Blog, Entry</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>entry = Entry.objects.get(pk=<span class="number">1</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>cheese_blog = Blog.objects.get(name=<span class="string">"Cheddar Talk"</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>entry.blog = cheese_blog</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>entry.save()</span><br></pre></td></tr></table></figure></li><li><p><code>ManyToManyField</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> blog.models <span class="keyword">import</span> Author</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>joe = Author.objects.create(name=<span class="string">"Joe"</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>entry.authors.add(joe)</span><br></pre></td></tr></table></figure><ul><li><p>可以一次性添加多个关系</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>john = Author.objects.create(name=<span class="string">"John"</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>paul = Author.objects.create(name=<span class="string">"Paul"</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>george = Author.objects.create(name=<span class="string">"George"</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ringo = Author.objects.create(name=<span class="string">"Ringo"</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>entry.authors.add(john, paul, george, ringo)</span><br></pre></td></tr></table></figure></li><li><p>修改关系直接影响数据库，因此<code>add()</code>会<strong>自动</strong>保存。</p></li><li><p>在修改关系之前，必须<strong>先保存</strong>数据库。（因为关系会用一张表单独存）</p></li></ul></li></ul><h2 id="检索"><a href="#检索" class="headerlink" title="检索"></a>检索</h2><ul><li><p><strong>通过<code>Manager</code>创建<code>QuerySet</code>进行检索</strong></p></li><li><p>通过<strong>类（不是实例）的</strong><code>objects</code>属性获取<code>Manager</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; Blog.objects</span></span><br><span class="line">&lt;django.db.models.manager.Manager object at ...&gt;</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; b = Blog(name=<span class="string">'Foo'</span>, tagline=<span class="string">'Bar'</span>)</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; b.objects</span></span><br><span class="line">Traceback:</span><br><span class="line">    ...</span><br><span class="line">AttributeError: "Manager isn't accessible via Blog instances."</span><br></pre></td></tr></table></figure></li><li><p>获取所有实例</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>all_entries = Entry.objects.all()</span><br></pre></td></tr></table></figure><ul><li>返回一个含有所有实例的<code>QuerySet</code></li></ul></li><li><p>获取特定实例</p><ul><li><p><code>filter</code>：返回<strong>符合</strong>筛选条件的实例组成的<code>QuerySet</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Entry.objects.filter(pub_date__year=<span class="number">2006</span>)</span><br><span class="line"><span class="comment"># equals</span></span><br><span class="line">Entry.objects.all().filter(pub_date__year=<span class="number">2006</span>)</span><br></pre></td></tr></table></figure></li><li><p><code>exclude</code>：返回<strong>不符合</strong>筛选条件的实例组成的<code>QuerySet</code></p></li><li><p>链式调用</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>Entry.objects.filter(</span><br><span class="line"><span class="meta">... </span>    headline__startswith=<span class="string">'What'</span></span><br><span class="line"><span class="meta">... </span>).exclude(</span><br><span class="line"><span class="meta">... </span>    pub_date__gte=datetime.date.today()</span><br><span class="line"><span class="meta">... </span>).filter(</span><br><span class="line"><span class="meta">... </span>    pub_date__gte=datetime.date(<span class="number">2005</span>, <span class="number">1</span>, <span class="number">30</span>)</span><br><span class="line"><span class="meta">... </span>)</span><br></pre></td></tr></table></figure></li><li><p>每一次过滤得到的<code>QuerySet</code>都是<strong>崭新的</strong></p></li></ul></li><li><p>获取<strong>某个</strong>特定实例</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>one_entry = Entry.objects.get(pk=<span class="number">1</span>)</span><br></pre></td></tr></table></figure><ul><li>与<code>filter</code>返回空<code>QuerySet</code>不同，<code>get</code>方法在实例不存在时会抛出<code>DoseNotExist</code>异常。</li><li>当多个元素满足条件时，<code>get</code>会抛出<code>MultipleObjectsReturned</code>异常。</li></ul></li><li><p>限制个数</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>Entry.objects.all()[:<span class="number">5</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Entry.objects.all()[<span class="number">5</span>:<span class="number">10</span>]</span><br><span class="line"><span class="comment"># Entry.objects.all()[-1] is not supported</span></span><br></pre></td></tr></table></figure><ul><li><p>取首元素</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>Entry.objects.order_by(<span class="string">'headline'</span>)[<span class="number">0</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Entry.objects.order_by(<span class="string">'headline'</span>)[<span class="number">0</span>:<span class="number">1</span>].get()</span><br></pre></td></tr></table></figure><blockquote><ul><li>数组索引语法对<code>QuerySet</code>是<strong>基本适用</strong>的</li><li><code>get()</code>在<code>QuerySet</code>只有一个元素时可以<strong>不传参</strong>直接获取该元素</li><li><code>list(QuerySet)</code>可以直接转换为实例列表</li></ul></blockquote></li></ul></li><li><p><code>Field lookups</code>：属性域查询</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># SELECT * FROM blog_entry WHERE pub_date &lt;= '2006-01-01';</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Entry.objects.filter(pub_date__lte=<span class="string">'2006-01-01'</span>)</span><br></pre></td></tr></table></figure><ul><li><p>域通常都有<strong>双下划线</strong>引出，但是<code>_id</code>例外。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>Entry.objects.filter(blog_id=<span class="number">4</span>)</span><br></pre></td></tr></table></figure></li><li><p><code>exact</code>：全字段匹配</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>Entry.objects.get(headline__exact=<span class="string">"Cat bites dog"</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Blog.objects.get(id__exact=<span class="number">14</span>)  <span class="comment"># Explicit form</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Blog.objects.get(id=<span class="number">14</span>)         <span class="comment"># __exact is implied</span></span><br></pre></td></tr></table></figure><ul><li><code>exact</code>会被<strong>默认</strong>指定</li></ul></li><li><p><code>iexact</code>：忽略大小写匹配</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>Blog.objects.get(name__iexact=<span class="string">"beatles blog"</span>)</span><br></pre></td></tr></table></figure></li><li><p><code>contains</code>：大小写<strong>敏感</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Entry.objects.get(headline__contains=<span class="string">'Lennon'</span>)</span><br></pre></td></tr></table></figure></li><li><p><code>icontains</code>：忽略大小写</p></li><li><p><code>startswith</code>/<code>istartswith</code>/<code>endswith</code>/<code>iendswith</code></p></li></ul></li><li><p>主键查询</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>Blog.objects.get(id__exact=<span class="number">14</span>) <span class="comment"># Explicit form</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Blog.objects.get(id=<span class="number">14</span>) <span class="comment"># __exact is implied</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Blog.objects.get(pk=<span class="number">14</span>) <span class="comment"># pk implies id__exact</span></span><br><span class="line"><span class="comment"># Get blogs entries with id 1, 4 and 7</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Blog.objects.filter(pk__in=[<span class="number">1</span>,<span class="number">4</span>,<span class="number">7</span>])</span><br><span class="line"><span class="comment"># Get all blog entries with id &gt; 14</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Blog.objects.filter(pk__gt=<span class="number">14</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Entry.objects.filter(blog__id__exact=<span class="number">3</span>) <span class="comment"># Explicit form</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Entry.objects.filter(blog__id=<span class="number">3</span>)        <span class="comment"># __exact is implied</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Entry.objects.filter(blog__pk=<span class="number">3</span>)        <span class="comment"># __pk implies __id__exact</span></span><br></pre></td></tr></table></figure><h3 id="关系索引"><a href="#关系索引" class="headerlink" title="关系索引"></a>关系索引</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># filter one</span></span><br><span class="line">Blog.objects.filter(entry__headline__contains=<span class="string">'Lennon'</span>, entry__pub_date__year=<span class="number">2008</span>)</span><br><span class="line"><span class="comment"># filter two</span></span><br><span class="line">Blog.objects.filter(entry__headline__contains=<span class="string">'Lennon'</span>).filter(entry__pub_date__year=<span class="number">2008</span>)</span><br></pre></td></tr></table></figure><ul><li>第一个索引只能找到<strong>含有两个条件同时满足的Entry</strong>的Blog对象</li><li>第二个索引可以找到含有Entry<strong>分别满足两个条件之一</strong>的Blog对象</li></ul><blockquote><p><code>filter()</code>和<code>exclude()</code>的<strong>区别</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Blog.objects.exclude(</span><br><span class="line">    entry__headline__contains=<span class="string">'Lennon'</span>,</span><br><span class="line">    entry__pub_date__year=<span class="number">2008</span>,</span><br><span class="line">)</span><br></pre></td></tr></table></figure><ul><li>排除的是含有<strong>两者满足至少一个</strong>的Entry的Blog</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Blog.objects.exclude(</span><br><span class="line">    entry__in=Entry.objects.filter(</span><br><span class="line">        headline__contains=<span class="string">'Lennon'</span>,</span><br><span class="line">        pub_date__year=<span class="number">2008</span>,</span><br><span class="line">    ),</span><br><span class="line">)</span><br></pre></td></tr></table></figure><ul><li>排除的是含有<strong>两个条件都满足</strong>的Entry的Blog</li></ul></blockquote></li></ul><h3 id="属性索引"><a href="#属性索引" class="headerlink" title="属性索引"></a>属性索引</h3><ul><li><p>使用<code>F()</code>将Model的不同属性之间的比较作为筛选条件</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> django.db.models <span class="keyword">import</span> F</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Entry.objects.filter(number_of_comments__gt=F(<span class="string">'number_of_pingbacks'</span>))</span><br><span class="line"><span class="comment"># mult</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Entry.objects.filter(number_of_comments__gt=F(<span class="string">'number_of_pingbacks'</span>) * <span class="number">2</span>)</span><br><span class="line"><span class="comment"># add</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Entry.objects.filter(rating__lt=F(<span class="string">'number_of_comments'</span>) + F(<span class="string">'number_of_pingbacks'</span>))</span><br></pre></td></tr></table></figure></li><li><p>域关系扩展</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>Entry.objects.filter(authors__name=F(<span class="string">'blog__name'</span>))</span><br></pre></td></tr></table></figure></li><li><p>日期查询</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> datetime <span class="keyword">import</span> timedelta</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Entry.objects.filter(mod_date__gt=F(<span class="string">'pub_date'</span>) + timedelta(days=<span class="number">3</span>))</span><br></pre></td></tr></table></figure></li><li><p>位运算</p><ul><li><p><code>bitand()</code>/<code>bitor()</code>/<code>bitxor()</code>/<code>bitrightshift()</code>/<code>bitleftshift()</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>F(<span class="string">'somefield'</span>).bitand(<span class="number">16</span>)</span><br></pre></td></tr></table></figure></li></ul></li></ul><h3 id="JSON查询"><a href="#JSON查询" class="headerlink" title="JSON查询"></a>JSON查询</h3><ul><li><p>JSON的查询和其他域不同，取以下Model为例。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">200</span>)</span><br><span class="line">    data = models.JSONField(null=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.name</span><br></pre></td></tr></table></figure></li><li><p>查询<code>None</code>（在SQL中存储为<code>NULL</code>，JSON中存储为<code>null</code>）</p><ul><li><p>在<strong>查询</strong>时，<code>None</code>会被解释为JSON的<code>null</code>，SQL中<code>NULL</code>的判断应该使用<code>isnull</code>.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>Dog.objects.create(name=<span class="string">'Max'</span>, data=<span class="literal">None</span>)  <span class="comment"># SQL NULL.</span></span><br><span class="line">&lt;Dog: Max&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Dog.objects.create(name=<span class="string">'Archie'</span>, data=Value(<span class="string">'null'</span>))  <span class="comment"># JSON null.</span></span><br><span class="line">&lt;Dog: Archie&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Dog.objects.filter(data=<span class="literal">None</span>)</span><br><span class="line">&lt;QuerySet [&lt;Dog: Archie&gt;]&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Dog.objects.filter(data=Value(<span class="string">'null'</span>))</span><br><span class="line">&lt;QuerySet [&lt;Dog: Archie&gt;]&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Dog.objects.filter(data__isnull=<span class="literal">True</span>)</span><br><span class="line">&lt;QuerySet [&lt;Dog: Max&gt;]&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Dog.objects.filter(data__isnull=<span class="literal">False</span>)</span><br><span class="line">&lt;QuerySet [&lt;Dog: Archie&gt;]&gt;</span><br></pre></td></tr></table></figure></li><li><p>在域中设置<code>null=False</code>可以限制SQL不能为<code>NULL</code>，但是JSON中<strong>依然可以</strong>有<code>null</code>.</p></li></ul></li><li><p>属性查询</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>Dog.objects.create(name=<span class="string">'Rufus'</span>, data=&#123;</span><br><span class="line"><span class="meta">... </span>    <span class="string">'breed'</span>: <span class="string">'labrador'</span>,</span><br><span class="line"><span class="meta">... </span>    <span class="string">'owner'</span>: &#123;</span><br><span class="line"><span class="meta">... </span>        <span class="string">'name'</span>: <span class="string">'Bob'</span>,</span><br><span class="line"><span class="meta">... </span>        <span class="string">'other_pets'</span>: [&#123;</span><br><span class="line"><span class="meta">... </span>            <span class="string">'name'</span>: <span class="string">'Fishy'</span>,</span><br><span class="line"><span class="meta">... </span>        &#125;],</span><br><span class="line"><span class="meta">... </span>    &#125;,</span><br><span class="line"><span class="meta">... </span>&#125;)</span><br><span class="line">&lt;Dog: Rufus&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Dog.objects.create(name=<span class="string">'Meg'</span>, data=&#123;<span class="string">'breed'</span>: <span class="string">'collie'</span>, <span class="string">'owner'</span>: <span class="literal">None</span>&#125;)</span><br><span class="line">&lt;Dog: Meg&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Dog.objects.filter(data__breed=<span class="string">'collie'</span>)</span><br><span class="line">&lt;QuerySet [&lt;Dog: Meg&gt;]&gt;</span><br><span class="line">&gt;&gt; Dog.objects.filter(data__owner__name=<span class="string">'Bob'</span>)</span><br><span class="line">&lt;QuerySet [&lt;Dog: Rufus&gt;]&gt;</span><br><span class="line"><span class="comment"># If the key is an integer, it will be interpreted as an index transform in an array.</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Dog.objects.filter(data__owner__other_pets__0__name=<span class="string">'Fishy'</span>)</span><br><span class="line">&lt;QuerySet [&lt;Dog: Rufus&gt;]&gt;</span><br></pre></td></tr></table></figure></li><li><p>包含查询</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>Dog.objects.create(name=<span class="string">'Rufus'</span>, data=&#123;<span class="string">'breed'</span>: <span class="string">'labrador'</span>, <span class="string">'owner'</span>: <span class="string">'Bob'</span>&#125;)</span><br><span class="line">&lt;Dog: Rufus&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Dog.objects.create(name=<span class="string">'Meg'</span>, data=&#123;<span class="string">'breed'</span>: <span class="string">'collie'</span>, <span class="string">'owner'</span>: <span class="string">'Bob'</span>&#125;)</span><br><span class="line">&lt;Dog: Meg&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Dog.objects.create(name=<span class="string">'Fred'</span>, data=&#123;&#125;)</span><br><span class="line">&lt;Dog: Fred&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Dog.objects.filter(data__contains=&#123;<span class="string">'owner'</span>: <span class="string">'Bob'</span>&#125;)</span><br><span class="line">&lt;QuerySet [&lt;Dog: Rufus&gt;, &lt;Dog: Meg&gt;]&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Dog.objects.filter(data__contains=&#123;<span class="string">'breed'</span>: <span class="string">'collie'</span>&#125;)</span><br><span class="line">&lt;QuerySet [&lt;Dog: Meg&gt;]&gt;</span><br></pre></td></tr></table></figure></li><li><p><strong>逆包含</strong>查询：查询的元素的属性是指定条件的<strong>子集</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>Dog.objects.create(name=<span class="string">'Rufus'</span>, data=&#123;<span class="string">'breed'</span>: <span class="string">'labrador'</span>, <span class="string">'owner'</span>: <span class="string">'Bob'</span>&#125;)</span><br><span class="line">&lt;Dog: Rufus&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Dog.objects.create(name=<span class="string">'Meg'</span>, data=&#123;<span class="string">'breed'</span>: <span class="string">'collie'</span>, <span class="string">'owner'</span>: <span class="string">'Bob'</span>&#125;)</span><br><span class="line">&lt;Dog: Meg&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Dog.objects.create(name=<span class="string">'Fred'</span>, data=&#123;&#125;)</span><br><span class="line">&lt;Dog: Fred&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Dog.objects.filter(data__contained_by=&#123;<span class="string">'breed'</span>: <span class="string">'collie'</span>, <span class="string">'owner'</span>: <span class="string">'Bob'</span>&#125;)</span><br><span class="line">&lt;QuerySet [&lt;Dog: Meg&gt;, &lt;Dog: Fred&gt;]&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Dog.objects.filter(data__contained_by=&#123;<span class="string">'breed'</span>: <span class="string">'collie'</span>&#125;)</span><br><span class="line">&lt;QuerySet [&lt;Dog: Fred&gt;]&gt;</span><br></pre></td></tr></table></figure></li><li><p>键查询</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># has_key</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Dog.objects.create(name=<span class="string">'Rufus'</span>, data=&#123;<span class="string">'breed'</span>: <span class="string">'labrador'</span>&#125;)</span><br><span class="line">&lt;Dog: Rufus&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Dog.objects.create(name=<span class="string">'Meg'</span>, data=&#123;<span class="string">'breed'</span>: <span class="string">'collie'</span>, <span class="string">'owner'</span>: <span class="string">'Bob'</span>&#125;)</span><br><span class="line">&lt;Dog: Meg&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Dog.objects.filter(data__has_key=<span class="string">'owner'</span>)</span><br><span class="line">&lt;QuerySet [&lt;Dog: Meg&gt;]&gt;</span><br><span class="line"><span class="comment"># has_keys</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Dog.objects.create(name=<span class="string">'Rufus'</span>, data=&#123;<span class="string">'breed'</span>: <span class="string">'labrador'</span>&#125;)</span><br><span class="line">&lt;Dog: Rufus&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Dog.objects.create(name=<span class="string">'Meg'</span>, data=&#123;<span class="string">'breed'</span>: <span class="string">'collie'</span>, <span class="string">'owner'</span>: <span class="string">'Bob'</span>&#125;)</span><br><span class="line">&lt;Dog: Meg&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Dog.objects.filter(data__has_keys=[<span class="string">'breed'</span>, <span class="string">'owner'</span>])</span><br><span class="line">&lt;QuerySet [&lt;Dog: Meg&gt;]&gt;</span><br><span class="line"><span class="comment"># has_any_keys</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Dog.objects.create(name=<span class="string">'Rufus'</span>, data=&#123;<span class="string">'breed'</span>: <span class="string">'labrador'</span>&#125;)</span><br><span class="line">&lt;Dog: Rufus&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Dog.objects.create(name=<span class="string">'Meg'</span>, data=&#123;<span class="string">'owner'</span>: <span class="string">'Bob'</span>&#125;)</span><br><span class="line">&lt;Dog: Meg&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Dog.objects.filter(data__has_any_keys=[<span class="string">'owner'</span>, <span class="string">'breed'</span>])</span><br><span class="line">&lt;QuerySet [&lt;Dog: Rufus&gt;, &lt;Dog: Meg&gt;]&gt;</span><br></pre></td></tr></table></figure></li></ul><h3 id="关键字查询"><a href="#关键字查询" class="headerlink" title="关键字查询"></a>关键字查询</h3><ul><li><p>使用<code>Q()</code>解决<code>filter</code>只能够组织<code>AND</code>关系的局限</p></li><li><p>创建查询条件</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Q</span><br><span class="line">Q(question__startswith=<span class="string">'What'</span>)</span><br></pre></td></tr></table></figure></li><li><p>组合查询条件</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Q(question__startswith=<span class="string">'Who'</span>) | Q(question__startswith=<span class="string">'What'</span>)</span><br><span class="line">Q(question__startswith=<span class="string">'Who'</span>) | ~Q(pub_date__year=<span class="number">2005</span>)</span><br></pre></td></tr></table></figure><ul><li><code>~</code>进行条件取反</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Poll.objects.get(</span><br><span class="line">    Q(question__startswith=<span class="string">'Who'</span>),</span><br><span class="line">    Q(pub_date=date(<span class="number">2005</span>, <span class="number">5</span>, <span class="number">2</span>)) | Q(pub_date=date(<span class="number">2005</span>, <span class="number">5</span>, <span class="number">6</span>))</span><br><span class="line">)</span><br></pre></td></tr></table></figure><ul><li><code>,</code>相当于是<code>AND</code></li></ul></li><li><p>Q查询和关键词查询可以混合，但是Q查询必须放在<strong>前面</strong>。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Poll.objects.get(</span><br><span class="line">    Q(pub_date=date(<span class="number">2005</span>, <span class="number">5</span>, <span class="number">2</span>)) | Q(pub_date=date(<span class="number">2005</span>, <span class="number">5</span>, <span class="number">6</span>)),</span><br><span class="line">    question__startswith=<span class="string">'Who'</span>,</span><br><span class="line">)</span><br></pre></td></tr></table></figure></li></ul><h2 id="比较"><a href="#比较" class="headerlink" title="比较"></a>比较</h2><ul><li><p>使用<code>==</code>是比较两个实例的<strong>主键值</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>some_entry == other_entry</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>some_entry.id == other_entry.id</span><br></pre></td></tr></table></figure><blockquote><p><code>id</code>可以是任意的主键名</p></blockquote></li></ul><h2 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h2><ul><li><p><code>delete()</code>：返回删除的实例个数，以及连带删除的各个类型的实例的个数。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>e.delete()</span><br><span class="line">(<span class="number">1</span>, &#123;<span class="string">'weblog.Entry'</span>: <span class="number">1</span>&#125;)</span><br></pre></td></tr></table></figure></li><li><p><code>QuerySet</code>可以批量删除</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>Entry.objects.filter(pub_date__year=<span class="number">2005</span>).delete()</span><br><span class="line">(<span class="number">5</span>, &#123;<span class="string">'webapp.Entry'</span>: <span class="number">5</span>&#125;)</span><br></pre></td></tr></table></figure></li></ul><h2 id="复制"><a href="#复制" class="headerlink" title="复制"></a>复制</h2><ul><li><p>重置<code>pk</code>再保存即可复制</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">blog = Blog(name=<span class="string">'My blog'</span>, tagline=<span class="string">'Blogging is easy'</span>)</span><br><span class="line">blog.save() <span class="comment"># blog.pk == 1</span></span><br><span class="line"></span><br><span class="line">blog.pk = <span class="literal">None</span></span><br><span class="line">blog.save() <span class="comment"># blog.pk == 2</span></span><br></pre></td></tr></table></figure></li><li><p>子类需要<strong>同时重置</strong><code>pk</code>和<code>id</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThemeBlog</span><span class="params">(Blog)</span>:</span></span><br><span class="line">    theme = models.CharField(max_length=<span class="number">200</span>)</span><br><span class="line"></span><br><span class="line">django_blog = ThemeBlog(name=<span class="string">'Django'</span>, tagline=<span class="string">'Django is easy'</span>, theme=<span class="string">'python'</span>)</span><br><span class="line">django_blog.save() <span class="comment"># django_blog.pk == 3</span></span><br><span class="line">django_blog.pk = <span class="literal">None</span></span><br><span class="line">django_blog.id = <span class="literal">None</span></span><br><span class="line">django_blog.save() <span class="comment"># django_blog.pk == 4</span></span><br></pre></td></tr></table></figure></li><li><p>复制过程<strong>不会</strong>复制<strong>外键</strong>关系</p></li></ul><h2 id="更新"><a href="#更新" class="headerlink" title="更新"></a>更新</h2><ul><li><p>更新多个对象的<strong>非关系</strong>属性</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Update all the headlines with pub_date in 2007.</span></span><br><span class="line">Entry.objects.filter(pub_date__year=<span class="number">2007</span>).update(headline=<span class="string">'Everything is the same'</span>)</span><br></pre></td></tr></table></figure></li><li><p>更新<strong>关系</strong>属性</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = Blog.objects.get(pk=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Change every Entry so that it belongs to this Blog.</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Entry.objects.all().update(blog=b)</span><br></pre></td></tr></table></figure><ul><li>将关系属性置为<strong>对象实例</strong></li></ul></li><li><p>更新<strong>不会</strong>自动保存，需要遍历<code>QuerySet</code>进行<code>save()</code>保存。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> my_queryset:</span><br><span class="line">    item.save()</span><br></pre></td></tr></table></figure></li><li><p>更新只能够对查询Model的<strong>主表</strong>进行操作，不能够跨表操作（区别于<code>filter</code>）。</p></li><li><p><code>update</code>中的<code>F</code><strong>不能够</strong>进行域扩展</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># This will raise a FieldError</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Entry.objects.update(headline=F(<span class="string">'blog__name'</span>))</span><br></pre></td></tr></table></figure></li></ul><h2 id="外键关系"><a href="#外键关系" class="headerlink" title="外键关系"></a>外键关系</h2><h3 id="多对一"><a href="#多对一" class="headerlink" title="多对一"></a>多对一</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>e = Entry.objects.get(id=<span class="number">2</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>e.blog <span class="comment"># Returns the related Blog object.</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>e = Entry.objects.get(id=<span class="number">2</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>e.blog = some_blog</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>e.save()</span><br></pre></td></tr></table></figure><ul><li><p>当外键关系允许<code>null</code>时(<code>null=True</code>)，可以通过<code>None</code>对关系进行删除</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>e = Entry.objects.get(id=<span class="number">2</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>e.blog = <span class="literal">None</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>e.save() <span class="comment"># "UPDATE blog_entry SET blog_id = NULL ...;"</span></span><br></pre></td></tr></table></figure></li><li><p>逆向查询：<code>FOO_set</code>即<strong>“多”</strong>对象的<code>Manager</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = Blog.objects.get(id=<span class="number">1</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b.entry_set.all() <span class="comment"># Returns all Entry objects related to Blog.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># b.entry_set is a Manager that returns QuerySets.</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b.entry_set.filter(headline__contains=<span class="string">'Lennon'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b.entry_set.count()</span><br></pre></td></tr></table></figure><ul><li><p><code>FOO_set</code>的名字可以通过<code>related_name</code>设置</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># within Model Entry</span></span><br><span class="line">blog = ForeignKey(Blog, on_delete=models.CASCADE, related_name=<span class="string">'entries'</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = Blog.objects.get(id=<span class="number">1</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b.entries.all() <span class="comment"># Returns all Entry objects related to Blog.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># b.entries is a Manager that returns QuerySets.</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b.entries.filter(headline__contains=<span class="string">'Lennon'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b.entries.count()</span><br></pre></td></tr></table></figure></li></ul></li><li><p>其他操作</p><ul><li><p><code>add(obj1, obj2, ...)</code>：将多个对象和指定对象的外键域关联起来</p></li><li><p><code>create(**kwargs)</code>：创建并保存对象然后返回</p></li><li><p><code>remove(obj1, obj2, ...)</code>：<code>add</code>的逆操作</p></li><li><p><code>clear()</code>：清除<code>QuerySet</code>中的所有元素</p></li><li><p><code>set(objs)</code>：重置外键域</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">b = Blog.objects.get(id=<span class="number">1</span>)</span><br><span class="line">b.entry_set.set([e1, e2])</span><br></pre></td></tr></table></figure></li></ul><blockquote><p>所有的<code>add</code>/<code>create</code>/<code>delete</code>操作都是直接作用于数据库的</p></blockquote></li></ul><h3 id="多对多"><a href="#多对多" class="headerlink" title="多对多"></a>多对多</h3><ul><li><p>逆向查询时的Manager依然是<code>FOO_name</code>，并且可以通过<code>related_name</code>指定。</p></li><li><p>和多对一不同的是，多对多可以使用<code>pk</code>进行增删操作。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># identical operations</span></span><br><span class="line">a = Author.objects.get(id=<span class="number">5</span>)</span><br><span class="line">a.entry_set.set([e1, e2])</span><br><span class="line">a.entry_set.set([e1.pk, e2.pk])</span><br></pre></td></tr></table></figure></li></ul><h3 id="一对一"><a href="#一对一" class="headerlink" title="一对一"></a>一对一</h3><ul><li>逆向查询时直接使用<code>Model</code>的<strong>小写</strong>名称</li></ul><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://docs.djangoproject.com/en/dev/topics/db/queries/" target="_blank" rel="noopener">https://docs.djangoproject.com/en/dev/topics/db/queries/</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;全文共&lt;code&gt;2291&lt;/code&gt;字，推荐阅读时间&lt;code&gt;20~25&lt;/code&gt;分钟&lt;/p&gt;
    
    </summary>
    
    
      <category term="Web" scheme="http://yoursite.com/categories/Web/"/>
    
      <category term="Django" scheme="http://yoursite.com/categories/Django/"/>
    
    
  </entry>
  
  <entry>
    <title>Django-Chapter0-Django学习笔记</title>
    <link href="http://yoursite.com/2020/08/15/Django-Chapter0-Django%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    <id>http://yoursite.com/2020/08/15/Django-Chapter0-Django%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</id>
    <published>2020-08-15T02:51:44.835Z</published>
    <updated>2020-08-15T02:59:53.762Z</updated>
    
    <content type="html"><![CDATA[<p>全文共<code>1785</code>字，推荐阅读时间<code>15~20</code>分钟。</p><a id="more"></a><h2 id="项目"><a href="#项目" class="headerlink" title="项目"></a>项目</h2><ul><li><p>创建项目就是自动生成Django项目的基本代码</p><ul><li>数据库配置</li><li>Django配置</li><li>应用配置</li></ul></li><li><p>操作</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">django-admin startproject mysite</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">project/</span><br><span class="line">    manage.py</span><br><span class="line">    mysite/</span><br><span class="line">        __init__.py</span><br><span class="line">        settings.py</span><br><span class="line">        urls.py</span><br><span class="line">        asgi.py</span><br><span class="line">        wsgi.py</span><br></pre></td></tr></table></figure><ul><li><code>manage.py</code>：命令行交互工具</li><li><code>__init__.py</code>：<strong>空文件</strong>，表示这个目录是一个python包</li><li><code>settings.py</code>：Django项目的设置</li><li><code>urls.py</code>：声明Django项目的链接</li><li><code>asgi.py</code>：ASGI兼容的服务器配置</li><li><code>wsgi.py</code>：WSGI兼容的服务器配置</li></ul></li></ul><h3 id="开发服务器"><a href="#开发服务器" class="headerlink" title="开发服务器"></a>开发服务器</h3><ul><li><p>运行命令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py runserver</span><br></pre></td></tr></table></figure><ul><li><p>指定端口</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py runserver 8080</span><br></pre></td></tr></table></figure></li><li><p>指定IP（必须同时指定端口）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py runserver 0:8080</span><br></pre></td></tr></table></figure><blockquote><p><code>0</code>是<code>0.0.0.0</code>的<strong>缩写</strong></p></blockquote></li></ul></li></ul><h3 id="创建应用"><a href="#创建应用" class="headerlink" title="创建应用"></a>创建应用</h3><ul><li><p>操作</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py startapp polls</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">polls/</span><br><span class="line">    __init__.py</span><br><span class="line">    admin.py</span><br><span class="line">    apps.py</span><br><span class="line">    migrations/</span><br><span class="line">        __init__.py</span><br><span class="line">    models.py</span><br><span class="line">    tests.py</span><br><span class="line">    views.py</span><br></pre></td></tr></table></figure></li></ul><h3 id="创建视图"><a href="#创建视图" class="headerlink" title="创建视图"></a>创建视图</h3><ul><li><p><code>appname/views.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">"Hello, world. You're at the polls index."</span>)</span><br></pre></td></tr></table></figure></li><li><p><code>appname/urls.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">''</span>, views.index, name=<span class="string">'index'</span>),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><ul><li><code>path</code>的第一个参数<code>route</code>指定链接（开头<strong>不需要</strong>加<code>/</code>，可以在末尾加）</li><li><code>name</code>命名是为了方便在Django项目中操作链接</li></ul></li><li><p><code>projectname/urls.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> include, path</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">'polls/'</span>, include(<span class="string">'polls.urls'</span>)),</span><br><span class="line">    path(<span class="string">'admin/'</span>, admin.site.urls),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><ul><li>将应用的链接加入到顶层项目</li></ul></li></ul><h2 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h2><ul><li><p>在使用应用之前，需要创建对应的数据库表。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py migrate</span><br></pre></td></tr></table></figure><ul><li>为<code>INSTALLED_APPS</code>创建必要的数据库表</li></ul></li></ul><h3 id="创建模型"><a href="#创建模型" class="headerlink" title="创建模型"></a>创建模型</h3><ul><li><p>模型就是数据库布局和额外的<code>metadata</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Question</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    question_text = models.CharField(max_length=<span class="number">200</span>)</span><br><span class="line">    pub_date = models.DateTimeField(<span class="string">'date published'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Choice</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    question = models.ForeignKey(Question, on_delete=models.CASCADE)</span><br><span class="line">    choice_text = models.CharField(max_length=<span class="number">200</span>)</span><br><span class="line">    votes = models.IntegerField(default=<span class="number">0</span>)</span><br></pre></td></tr></table></figure><ul><li>数据库列名默认为类的<strong>域名</strong>，但是在<code>xxxField</code>的第一个参数可以设置数据库中使用的名字。（Django中依然使用<strong>域名</strong>。</li><li><code>ForeignKey</code>指定外键关系</li></ul></li></ul><h3 id="激活模型"><a href="#激活模型" class="headerlink" title="激活模型"></a>激活模型</h3><ul><li><p>安装应用：在<code>INSTALLED_APPS</code>中增加应用的<code>configuration</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = [</span><br><span class="line">    <span class="string">'django.contrib.admin'</span>,</span><br><span class="line">    <span class="string">'django.contrib.auth'</span>,</span><br><span class="line">    <span class="string">'django.contrib.contenttypes'</span>,</span><br><span class="line">    <span class="string">'django.contrib.sessions'</span>,</span><br><span class="line">    <span class="string">'django.contrib.messages'</span>,</span><br><span class="line">    <span class="string">'django.contrib.staticfiles'</span>,</span><br><span class="line">    <span class="string">'polls.apps.PollsConfig'</span>,</span><br><span class="line">]</span><br></pre></td></tr></table></figure></li><li><p>创建数据库模型（<strong>不是</strong>迁移数据库）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py makemigrations polls</span><br></pre></td></tr></table></figure><ul><li>使用<code>python manage.py sqlmigrate polls 0001</code>可以查看SQL语句</li></ul></li><li><p>迁移数据库</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py migrate</span><br></pre></td></tr></table></figure></li></ul><h3 id="数据库API"><a href="#数据库API" class="headerlink" title="数据库API"></a>数据库API</h3><ul><li><p>获取一个模型中的所有记录（一个类的所有实例）</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Question.objects.all() <span class="comment"># &lt;QuerySet []&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>创建记录</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.utils <span class="keyword">import</span> timezone</span><br><span class="line">q = Question(question_text=<span class="string">"What's new?"</span>, pub_date=timezone.now())</span><br></pre></td></tr></table></figure></li><li><p>保存记录</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">q.save()</span><br></pre></td></tr></table></figure></li><li><p>属性查询</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">q.id</span><br><span class="line">q.question_text</span><br><span class="line">q.pub_date</span><br></pre></td></tr></table></figure></li><li><p>更改属性后保存</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">q.question_text = <span class="string">"What's up?"</span></span><br><span class="line">q.save()</span><br><span class="line">Question.objects.all() <span class="comment"># &lt;QuerySet [&lt;Question: Question object (1)&gt;]&gt;</span></span><br></pre></td></tr></table></figure><ul><li><p>为模型增加<code>__str__()</code>方法可以更改QuerySet的显示效果</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;QuerySet [&lt;Question: What&#39;s up?&gt;]&gt;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>数据查询</p><ul><li><p>条件过滤：返回QuerySet</p>  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Question.objects.filter(id=<span class="number">1</span>) <span class="comment"># &lt;QuerySet [&lt;Question: What's up?&gt;]&gt;</span></span><br><span class="line">Question.objects.filter(question_text__startswith=<span class="string">'What'</span>)</span><br></pre></td></tr></table></figure></li><li><p>元素获取：返回元素</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.utils <span class="keyword">import</span> timezone</span><br><span class="line">current_year = timezone.now().year</span><br><span class="line">Question.objects.get(pub_date__year=current_year) <span class="comment"># &lt;Question: What's up?&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>相关元素</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'''Question -&gt; Choice'''</span></span><br><span class="line">q = Question.objects.get(pk=<span class="number">1</span>)</span><br><span class="line">q.choice_set.all() <span class="comment"># default set to none so far &lt;QuerySet []&gt;</span></span><br><span class="line">q.choice_set.create(choice_text=<span class="string">'Not much'</span>, votes=<span class="number">0</span>)</span><br><span class="line">q.choice_set.create(choice_text=<span class="string">'The sky'</span>, votes=<span class="number">0</span>)</span><br><span class="line"><span class="string">'''Choice -&gt; Question'''</span></span><br><span class="line">c = q.choice_set.create(choice_text=<span class="string">'Just hacking again'</span>, votes=<span class="number">0</span>)</span><br><span class="line">c.question <span class="comment"># Choice objects have API access to their related Question objects.</span></span><br><span class="line"></span><br><span class="line">q.choice_set.all() <span class="comment"># &lt;QuerySet [&lt;Choice: Not much&gt;, &lt;Choice: The sky&gt;, &lt;Choice: Just hacking again&gt;]&gt;</span></span><br><span class="line">q.choice_set.count() <span class="comment"># 3</span></span><br><span class="line"></span><br><span class="line">Choice.objects.filter(question__pub_date__year=current_year) <span class="comment"># &lt;QuerySet [&lt;Choice: Not much&gt;, &lt;Choice: The sky&gt;, &lt;Choice: Just hacking again&gt;]&gt;</span></span><br></pre></td></tr></table></figure><ul><li>外键声明处(<code>Choice</code>)直接使用域名<code>question</code>访问相关问题，<code>Question</code>则使用<code>choice_set</code>.</li></ul></li></ul></li><li><p>数据删除</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">c = q.choice_set.filter(choice_text__startswith=<span class="string">'Just hacking'</span>)</span><br><span class="line">c.delete()</span><br></pre></td></tr></table></figure></li><li><p>相关链接</p><ul><li>相关性查询：<a href="https://docs.djangoproject.com/en/dev/ref/models/relations/" target="_blank" rel="noopener">https://docs.djangoproject.com/en/dev/ref/models/relations/</a></li><li>下划线查询：<a href="https://docs.djangoproject.com/en/dev/topics/db/queries/#field-lookups-intro" target="_blank" rel="noopener">https://docs.djangoproject.com/en/dev/topics/db/queries/#field-lookups-intro</a></li></ul></li></ul><h3 id="超级用户"><a href="#超级用户" class="headerlink" title="超级用户"></a>超级用户</h3><ul><li><p>创建</p>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py createsuperuser</span><br></pre></td></tr></table></figure></li><li><p>访问</p><p>  <code>http://127.0.0.1:8000/admin/</code></p></li><li><p>注册模型：修改<code>appname/admin.py</code></p>  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Question</span><br><span class="line"></span><br><span class="line">admin.site.register(Question)</span><br></pre></td></tr></table></figure></li></ul><h2 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h2><ul><li>在Django中，页面和其他内容都是通过视图传递的，每个视图都是通过一个Python函数或者类方法展示的。</li><li>Django通过请求的URL来选择视图</li><li><code>URLconf</code>将URL模式映射为视图</li></ul><h3 id="添加视图"><a href="#添加视图" class="headerlink" title="添加视图"></a>添加视图</h3><ul><li><p>增加视图函数</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">detail</span><span class="params">(request, question_id)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">"You are looking at question %s."</span> % question_id)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">results</span><span class="params">(request, question_id)</span>:</span></span><br><span class="line">    response = <span class="string">"You're looking at the results of question %s."</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(response % question_id)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">vote</span><span class="params">(request, question_id)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">"You're voting on question %s."</span> % question_id)</span><br></pre></td></tr></table></figure></li><li><p>将视图和URL连接</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">path(<span class="string">'&lt;int:question_id&gt;/'</span>, views.detail, name=<span class="string">'detail'</span>),</span><br><span class="line">path(<span class="string">'&lt;int:question_id&gt;/results/'</span>, views.results, name=<span class="string">'results'</span>),</span><br><span class="line">path(<span class="string">'&lt;int:question_id&gt;/vote/'</span>, views.vote, name=<span class="string">'vote'</span>),</span><br></pre></td></tr></table></figure><blockquote><p>视图访问过程，以<code>.../polls/34/</code>为例</p><ul><li>加载项目文件的<code>urls.py</code>文件(<code>ROOT_URLCONF</code>)，在<code>urlpatterns</code>中<strong>按序</strong>匹配找到<code>polls/</code>之后，将<code>34/</code>发送给应用的<code>urls.py</code>文件</li><li>在应用的<code>urls.py</code>文件中进行按序匹配，并且使用尖括号捕捉<code>int</code>值，命名为<code>question_id</code>，并作为参数进行传递。（捕捉命名需要和参数名<strong>相同</strong>）</li><li>调用<code>views.detail</code></li></ul></blockquote></li></ul><h3 id="视图的作用"><a href="#视图的作用" class="headerlink" title="视图的作用"></a>视图的作用</h3><ul><li>返回一个<code>HttpResponse</code>对象</li><li>抛出异常，例如<code>404</code>错误。</li></ul><h3 id="模板"><a href="#模板" class="headerlink" title="模板"></a>模板</h3><p>页面的布局默认是硬编码的，因此可以通过模板系统创建自定义的布局。</p><ul><li><p>在app内创建<code>templates</code>文件夹</p></li><li><p>在<code>templates</code>文件夹中再创建一个和<code>app</code>同名的文件夹</p></li><li><p>设置html</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;% if latest_question_list %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    &#123;% for question in latest_question_list %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/polls/&#123;&#123; question.id &#125;&#125;/"</span>&gt;</span>&#123;&#123; question.question_text &#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">&#123;% else %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>No polls are available.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">&#123;% endif %&#125;</span><br></pre></td></tr></table></figure></li><li><p>更新索引视图</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request)</span>:</span></span><br><span class="line">    latest_question_list = Question.objects.order_by(<span class="string">'-pub_date'</span>)[:<span class="number">5</span>]</span><br><span class="line">    template = loader.get_template(<span class="string">'polls/index.html'</span>)</span><br><span class="line">    context = &#123;</span><br><span class="line">        <span class="string">'latest_question_list'</span>: latest_question_list,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(template.render(context, request))</span><br></pre></td></tr></table></figure><ul><li><p><code>loader</code>模块指定模板</p></li><li><p><code>context</code>负责同步html和python中的变量</p></li><li><p>使用<code>render</code>简化</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request)</span>:</span></span><br><span class="line">    latest_question_list = Question.objects.order_by(<span class="string">'-pub_date'</span>)[:<span class="number">5</span>]</span><br><span class="line">    context = &#123;<span class="string">'latest_question_list'</span>: latest_question_list&#125;</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'polls/index.html'</span>, context)</span><br></pre></td></tr></table></figure><ul><li>第一个参数是请求对象</li><li>第二个参数是模板名</li><li>第三个参数同步变量，是可选参数。</li><li><code>render</code>返回一个<code>HttpResponse</code>对象</li></ul></li></ul></li></ul><h3 id="404错误"><a href="#404错误" class="headerlink" title="404错误"></a>404错误</h3><ul><li><p>通过异常机制实现</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">detail</span><span class="params">(request, question_id)</span>:</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        question = Question.objects.get(pk=question_id)</span><br><span class="line">    <span class="keyword">except</span> Question.DoesNotExist:</span><br><span class="line">        <span class="keyword">raise</span> Http404(<span class="string">'Question does not exist'</span>)</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'polls/detail.html'</span>, &#123;<span class="string">'question'</span>: question&#125;)</span><br></pre></td></tr></table></figure></li><li><p>简化</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">detail</span><span class="params">(request, question_id)</span>:</span></span><br><span class="line">    question = get_object_or_404(Question, pk=question_id)</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'polls/detail.html'</span>, &#123;<span class="string">'question'</span>: question&#125;)</span><br></pre></td></tr></table></figure></li></ul><h3 id="模板系统"><a href="#模板系统" class="headerlink" title="模板系统"></a>模板系统</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;&#123; question.question_text &#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">&#123;% for choice in question.choice_set.all %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;&#123; choice.choice_text &#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="硬编码URL"><a href="#硬编码URL" class="headerlink" title="硬编码URL"></a>硬编码URL</h3><ul><li><p>减少模板中出现链接的情况</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/polls/&#123;&#123; question.id &#125;&#125;/"</span>&gt;</span>&#123;&#123; question.question_text &#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;% url 'detail' question.id %&#125;"</span>&gt;</span>&#123;&#123; question.question_text &#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>使用命名空间（增加<code>app_name</code>域）</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">app_name = <span class="string">'polls'</span></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">''</span>, views.index, name=<span class="string">'index'</span>),</span><br><span class="line">    path(<span class="string">'&lt;int:question_id&gt;/'</span>, views.detail, name=<span class="string">'detail'</span>),</span><br><span class="line">    path(<span class="string">'&lt;int:question_id&gt;/results/'</span>, views.results, name=<span class="string">'results'</span>),</span><br><span class="line">    path(<span class="string">'&lt;int:question_id&gt;/vote/'</span>, views.vote, name=<span class="string">'vote'</span>),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>相应的模板链接修改</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;% url 'polls:detail' question.id %&#125;"</span>&gt;</span>&#123;&#123; question.question_text &#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="表单"><a href="#表单" class="headerlink" title="表单"></a>表单</h2><ul><li><p>实例</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;&#123; question.question_text &#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line">&#123;% if error_message %&#125;<span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">strong</span>&gt;</span>&#123;&#123; error_message &#125;&#125;<span class="tag">&lt;/<span class="name">strong</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span>&#123;% endif %&#125;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"&#123;% url 'polls:vote' question.id %&#125;"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">&#123;% csrf_token %&#125;</span><br><span class="line">&#123;% for choice in question.choice_set.all %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">name</span>=<span class="string">"choice"</span> <span class="attr">id</span>=<span class="string">"choice&#123;&#123; forloop.counter &#125;&#125;"</span> <span class="attr">value</span>=<span class="string">"&#123;&#123; choice.id &#125;&#125;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"choice&#123;&#123; forloop.counter &#125;&#125;"</span>&gt;</span>&#123;&#123; choice.choice_text &#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"Vote"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>所有指向内置URL的<code>POST</code>表单都必须使用<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% csrf_token %&#125;</span><br></pre></td></tr></table></figure>模板标志</li></ul></li></ul><h3 id="内置视图"><a href="#内置视图" class="headerlink" title="内置视图"></a>内置视图</h3><ul><li><p>更新URL</p>  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">app_name = <span class="string">'polls'</span></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">''</span>, views.IndexView.as_view(), name=<span class="string">'index'</span>),</span><br><span class="line">    path(<span class="string">'&lt;int:pk&gt;/'</span>, views.DetailView.as_view(), name=<span class="string">'detail'</span>),</span><br><span class="line">    path(<span class="string">'&lt;int:pk&gt;/results/'</span>, views.ResultsView.as_view(), name=<span class="string">'results'</span>),</span><br><span class="line">    path(<span class="string">'&lt;int:question_id&gt;/vote/'</span>, views.vote, name=<span class="string">'vote'</span>),</span><br><span class="line">]</span><br></pre></td></tr></table></figure></li><li><p>更新视图</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponseRedirect</span><br><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> get_object_or_404, render</span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> reverse</span><br><span class="line"><span class="keyword">from</span> django.views <span class="keyword">import</span> generic</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Choice, Question</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IndexView</span><span class="params">(generic.ListView)</span>:</span></span><br><span class="line">    template_name = <span class="string">'polls/index.html'</span></span><br><span class="line">    context_object_name = <span class="string">'latest_question_list'</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_queryset</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""Return the last five published questions."""</span></span><br><span class="line">        <span class="keyword">return</span> Question.objects.order_by(<span class="string">'-pub_date'</span>)[:<span class="number">5</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DetailView</span><span class="params">(generic.DetailView)</span>:</span></span><br><span class="line">    model = Question</span><br><span class="line">    template_name = <span class="string">'polls/detail.html'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ResultsView</span><span class="params">(generic.DetailView)</span>:</span></span><br><span class="line">    model = Question</span><br><span class="line">    template_name = <span class="string">'polls/results.html'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">vote</span><span class="params">(request, question_id)</span>:</span></span><br><span class="line">    ... <span class="comment"># same as above, no changes needed.</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://docs.djangoproject.com/en/dev/" target="_blank" rel="noopener">https://docs.djangoproject.com/en/dev/</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;全文共&lt;code&gt;1785&lt;/code&gt;字，推荐阅读时间&lt;code&gt;15~20&lt;/code&gt;分钟。&lt;/p&gt;
    
    </summary>
    
    
      <category term="Web" scheme="http://yoursite.com/categories/Web/"/>
    
      <category term="Django" scheme="http://yoursite.com/categories/Django/"/>
    
    
  </entry>
  
  <entry>
    <title>Django-Chapter1-Models</title>
    <link href="http://yoursite.com/2020/08/15/Django-Chapter1-Models/"/>
    <id>http://yoursite.com/2020/08/15/Django-Chapter1-Models/</id>
    <published>2020-08-15T02:51:44.835Z</published>
    <updated>2020-08-15T02:53:01.439Z</updated>
    
    <content type="html"><![CDATA[<p>全文共<code>1795</code>字，推荐阅读时间<code>15~20</code>分钟。</p><a id="more"></a><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><ul><li>一个Model通常映射为数据库中的一张表</li><li>所有的Model都继承自<code>django.db.models.Model</code></li><li>Model的每个属性对应数据库中的一个域</li></ul><h2 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    first_name = models.CharField(max_length=<span class="number">30</span>)</span><br><span class="line">    last_name = models.CharField(max_length=<span class="number">30</span>)</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> myapp_person (</span><br><span class="line">    <span class="string">"id"</span> <span class="built_in">serial</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> PRIMARY <span class="keyword">KEY</span>,</span><br><span class="line">    <span class="string">"first_name"</span> <span class="built_in">varchar</span>(<span class="number">30</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">    <span class="string">"last_name"</span> <span class="built_in">varchar</span>(<span class="number">30</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure><h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><ul><li><p>激活app：在settings.py中<code>INSTALLED_APPS</code>增加模型所在的app</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = [</span><br><span class="line">    <span class="comment">#...</span></span><br><span class="line">    <span class="string">'myapp'</span>,</span><br><span class="line">    <span class="comment">#...</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure></li><li><p><strong>创建</strong>数据库结构</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py migrate</span><br></pre></td></tr></table></figure></li><li><p><strong>修改</strong>数据库结构</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py makemigrations</span><br></pre></td></tr></table></figure></li></ul><h2 id="域"><a href="#域" class="headerlink" title="域"></a>域</h2><h3 id="命名"><a href="#命名" class="headerlink" title="命名"></a>命名</h3><ul><li><strong>不能</strong>是Python保留字</li><li><strong>不能</strong>有连续的<strong>两个以上</strong>下划线</li><li><strong>不能</strong>以下划线结尾</li></ul><h3 id="类型"><a href="#类型" class="headerlink" title="类型"></a>类型</h3><ul><li><p>内置</p><ul><li><p><code>AutoField</code>：会<strong>自增</strong>的整型域</p></li><li><p><code>BigAutoField</code></p></li><li><p><code>IntegerField</code></p></li><li><p><code>BigIntegerField</code></p></li><li><p><code>BooleanField</code></p></li><li><p><code>NullBooleanField</code></p></li><li><p><code>CharField</code></p></li><li><p><code>DateField</code></p></li><li><p><code>DateTimeField</code></p></li><li><p><code>DecimalField</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">models.DecimalField(..., max_digits=<span class="number">5</span>, decimal_places=<span class="number">2</span>)</span><br></pre></td></tr></table></figure><ul><li>可以存储0~999之间的所有两位小数</li></ul></li><li><p><code>EmailField</code></p></li></ul></li></ul><h3 id="关键词参数"><a href="#关键词参数" class="headerlink" title="关键词参数"></a>关键词参数</h3><ul><li><p><code>null</code>：为<code>True</code>表示数据库允许<strong>null值</strong>，默认为<code>False</code>.</p></li><li><p><code>blank</code>：为<code>True</code>表示数据库允许<strong>空白值</strong>，即创建记录时可以不指定该域的值，默认为<code>False</code>.</p></li><li><p><code>choices</code>：使用元组限制该域的取值</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">YEAR_IN_SCHOOL_CHOICES = [</span><br><span class="line">    (<span class="string">'FR'</span>, <span class="string">'Freshman'</span>),</span><br><span class="line">    (<span class="string">'SO'</span>, <span class="string">'Sophomore'</span>),</span><br><span class="line">    (<span class="string">'JR'</span>, <span class="string">'Junior'</span>),</span><br><span class="line">    (<span class="string">'SR'</span>, <span class="string">'Senior'</span>),</span><br><span class="line">    (<span class="string">'GR'</span>, <span class="string">'Graduate'</span>),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><ul><li><p>元组的第一个值是<strong>数据库</strong>中存储的值</p></li><li><p>元组的第二个值是<strong>域表单</strong>显示的值</p></li><li><p>例子</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    SHIRT_SIZES = (</span><br><span class="line">        (<span class="string">'S'</span>, <span class="string">'Small'</span>),</span><br><span class="line">        (<span class="string">'M'</span>, <span class="string">'Medium'</span>),</span><br><span class="line">        (<span class="string">'L'</span>, <span class="string">'Large'</span>),</span><br><span class="line">    )</span><br><span class="line">    name = models.CharField(max_length=<span class="number">60</span>)</span><br><span class="line">    shirt_size = models.CharField(max_length=<span class="number">1</span>, choices=SHIRT_SIZES)</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; p = Person(name=<span class="string">"Fred Flintstone"</span>, shirt_size=<span class="string">"L"</span>)</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; p.save()</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; p.shirt_size</span></span><br><span class="line">'L'</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; p.get_shirt_size_display()</span></span><br><span class="line">'Large'</span><br></pre></td></tr></table></figure><ul><li><p><code>get_FOO_display()</code>是Model的内置方法，用于获取<code>choices</code>域。</p></li><li><p>对于<strong>不允许</strong><code>null</code>的域来说</p><ul><li><code>get_next_by_FOO()</code></li><li><code>get_previous_by_FOO()</code></li></ul><blockquote><p>返回下一个/上一个<strong>按该域排序</strong>的字段</p></blockquote></li></ul></li></ul></li><li><p><code>default</code>：域默认值</p></li><li><p><code>help_text</code></p></li><li><p><code>primary_key</code>：手动设置主键</p></li><li><p><code>unique</code>：为<code>True</code>保证该域<strong>不能</strong>出现重复记录</p></li></ul><h3 id="主键"><a href="#主键" class="headerlink" title="主键"></a>主键</h3><ul><li><p>默认创建<code>id</code>域</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id = models.AutoField(primary_key=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure></li></ul><h3 id="冗长域名"><a href="#冗长域名" class="headerlink" title="冗长域名"></a>冗长域名</h3><ul><li><p>除外键关系外，<code>verbose_name</code>是域的<strong>第一个位置参数</strong>，用于起<strong>展示时</strong>别名。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">first_name = models.CharField(<span class="string">"person's first name"</span>, max_length=<span class="number">30</span>)</span><br></pre></td></tr></table></figure></li><li><p>默认为属性名</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">first_name = models.CharField(max_length=<span class="number">30</span>)</span><br></pre></td></tr></table></figure></li><li><p>在<strong>外键</strong>关系中，是<strong>关键词参数</strong>。</p></li></ul><h2 id="关系"><a href="#关系" class="headerlink" title="关系"></a>关系</h2><h3 id="多对一-ForeignKey"><a href="#多对一-ForeignKey" class="headerlink" title="多对一(ForeignKey)"></a>多对一(<code>ForeignKey</code>)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Manufacturer</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Car</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    manufacturer = models.ForeignKey(Manufacturer, on_delete=models.CASCADE)</span><br><span class="line">    <span class="comment"># ...</span></span><br></pre></td></tr></table></figure><ul><li><p>多个<code>Car</code>对应一个<code>Manufacturer</code></p></li><li><p><code>related_name</code>：用于回溯索引的名称，置为<code>+</code>表示<strong>不建立</strong>回溯关系</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">user = models.ForeignKey(</span><br><span class="line">    User,</span><br><span class="line">    on_delete=models.CASCADE,</span><br><span class="line">    related_name=<span class="string">'+'</span>,</span><br><span class="line">)</span><br></pre></td></tr></table></figure></li><li><p><code>related_query_name</code>：用于<strong>回溯查询</strong>的名称</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Declare the ForeignKey with related_query_name</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tag</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    article = models.ForeignKey(</span><br><span class="line">        Article,</span><br><span class="line">        on_delete=models.CASCADE,</span><br><span class="line">        related_name=<span class="string">"tags"</span>,</span><br><span class="line">        related_query_name=<span class="string">"tag"</span>,</span><br><span class="line">    )</span><br><span class="line">    name = models.CharField(max_length=<span class="number">255</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># That's now the name of the reverse filter</span></span><br><span class="line">Article.objects.filter(tag__name=<span class="string">"important"</span>)</span><br></pre></td></tr></table></figure></li></ul><h3 id="多对多-ManyToManyField"><a href="#多对多-ManyToManyField" class="headerlink" title="多对多(ManyToManyField)"></a>多对多(<code>ManyToManyField</code>)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Topping</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pizza</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line">    toppings = models.ManyToManyField(Topping)</span><br></pre></td></tr></table></figure><ul><li>多对多关系只用在其中一个Model中声明即可</li></ul><h4 id="中介-intermediary"><a href="#中介-intermediary" class="headerlink" title="中介(intermediary)"></a>中介(intermediary)</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">128</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.name</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Group</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">128</span>)</span><br><span class="line">    members = models.ManyToManyField(Person, through=<span class="string">'Membership'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.name</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Membership</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    person = models.ForeignKey(Person, on_delete=models.CASCADE)</span><br><span class="line">    group = models.ForeignKey(Group, on_delete=models.CASCADE)</span><br><span class="line">    date_joined = models.DateField()</span><br><span class="line">    invite_reason = models.CharField(max_length=<span class="number">64</span>)</span><br></pre></td></tr></table></figure><ul><li><p><code>Person</code>和<code>Group</code>之间是<strong>多对多</strong>关系，通过<code>Membership</code><strong>扩展</strong><code>through</code>关系，可以在<code>Membership</code>中存储相关信息。</p></li><li><p>在<code>Person</code>和<code>Group</code>中<strong>有且只有一个</strong>声明含<code>Membership</code>的<strong>多对多关系</strong></p></li><li><p>创建实例</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; ringo = Person.objects.create(name=<span class="string">"Ringo Starr"</span>)</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; paul = Person.objects.create(name=<span class="string">"Paul McCartney"</span>)</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; beatles = Group.objects.create(name=<span class="string">"The Beatles"</span>)</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; m1 = Membership(person=ringo, group=beatles,</span></span><br><span class="line">...     date_joined=date(1962, 8, 16),</span><br><span class="line">...     invite_reason="Needed a new drummer.")</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; m1.save()</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; beatles.members.all()</span></span><br><span class="line">&lt;QuerySet [&lt;Person: Ringo Starr&gt;]&gt;</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; ringo.group_set.all()</span></span><br><span class="line">&lt;QuerySet [&lt;Group: The Beatles&gt;]&gt;</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; m2 = Membership.objects.create(person=paul, group=beatles,</span></span><br><span class="line">...     date_joined=date(1960, 8, 1),</span><br><span class="line">...     invite_reason="Wanted to form a band.")</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; beatles.members.all()</span></span><br><span class="line">&lt;QuerySet [&lt;Person: Ringo Starr&gt;, &lt;Person: Paul McCartney&gt;]&gt;</span><br></pre></td></tr></table></figure></li><li><p><strong>创建</strong>关系</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; beatles.members.add(john, through_defaults=&#123;<span class="string">'date_joined'</span>: date(1960, 8, 1)&#125;)</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; beatles.members.create(name=<span class="string">"George Harrison"</span>, through_defaults=&#123;<span class="string">'date_joined'</span>: date(1960, 8, 1)&#125;)</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; beatles.members.set([john, paul, ringo, george], through_defaults=&#123;<span class="string">'date_joined'</span>: date(1960, 8, 1)&#125;)</span></span><br></pre></td></tr></table></figure></li><li><p><strong>删除</strong>关系</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>Membership.objects.create(person=ringo, group=beatles,</span><br><span class="line"><span class="meta">... </span>    date_joined=date(<span class="number">1968</span>, <span class="number">9</span>, <span class="number">4</span>),</span><br><span class="line"><span class="meta">... </span>    invite_reason=<span class="string">"You've been gone for a month and we miss you."</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>beatles.members.all()</span><br><span class="line">&lt;QuerySet [&lt;Person: Ringo Starr&gt;, &lt;Person: Paul McCartney&gt;, &lt;Person: Ringo Starr&gt;]&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># This deletes both of the intermediate model instances for Ringo Starr</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>beatles.members.remove(ringo)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>beatles.members.all()</span><br><span class="line">&lt;QuerySet [&lt;Person: Paul McCartney&gt;]&gt;</span><br></pre></td></tr></table></figure><blockquote><p><code>remove</code>删除关系<strong>本身</strong></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># Beatles have broken up</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>beatles.members.clear()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># Note that this deletes the intermediate model instances</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Membership.objects.all()</span><br><span class="line">&lt;QuerySet []&gt;</span><br></pre></td></tr></table></figure><blockquote><p><code>clear</code>删除关系和相关的对象</p></blockquote></li><li><p>使用中介进行筛选</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Find all the members of the Beatles that joined after 1 Jan 1961</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; Person.objects.filter(</span></span><br><span class="line">...     group__name='The Beatles',</span><br><span class="line">...     membership__date_joined__gt=date(1961,1,1))</span><br><span class="line">&lt;QuerySet [&lt;Person: Ringo Starr]&gt;</span><br></pre></td></tr></table></figure></li><li><p>获取中介</p><ul><li><p>直接获取关系</p>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; ringos_membership = Membership.objects.get(group=beatles, person=ringo)</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; ringos_membership.date_joined</span></span><br><span class="line">datetime.date(1962, 8, 16)</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; ringos_membership.invite_reason</span></span><br><span class="line">'Needed a new drummer.'</span><br></pre></td></tr></table></figure></li><li><p>通过关系对象获取</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; ringos_membership = ringo.membership_set.get(group=beatles)</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; ringos_membership.date_joined</span></span><br><span class="line">datetime.date(1962, 8, 16)</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; ringos_membership.invite_reason</span></span><br><span class="line">'Needed a new drummer.'</span><br></pre></td></tr></table></figure></li></ul></li></ul><h3 id="一对一-OneToOneField"><a href="#一对一-OneToOneField" class="headerlink" title="一对一(OneToOneField)"></a>一对一(<code>OneToOneField</code>)</h3><ul><li><code>parent_link</code></li></ul><h2 id="Meta-options"><a href="#Meta-options" class="headerlink" title="Meta options"></a>Meta options</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Ox</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    horn_length = models.IntegerField()</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        ordering = [<span class="string">"horn_length"</span>]</span><br><span class="line">        verbose_name_plural = <span class="string">"oxen"</span></span><br></pre></td></tr></table></figure><ul><li><p><code>abstract</code>：如果该域为<code>True</code>，则该类可以作为模板类。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CommonInfo</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">100</span>)</span><br><span class="line">    age = models.PositiveIntegerField()</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        abstract = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span><span class="params">(CommonInfo)</span>:</span></span><br><span class="line">    home_group = models.CharField(max_length=<span class="number">5</span>)</span><br></pre></td></tr></table></figure></li><li><p><code>app_label</code>：如果Model定义在app<strong>之外</strong>，则需要指定<code>app_label</code>.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app_label = <span class="string">'myapp'</span></span><br></pre></td></tr></table></figure></li><li><p><code>db_table</code>：指定数据库中的<strong>表名称</strong></p></li><li><p><code>ordering</code>：指定获取对象时的顺序</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ordering = [<span class="string">'-order_date'</span>]</span><br></pre></td></tr></table></figure><ul><li><p>多要素排序</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ordering = [<span class="string">'-pub_date'</span>, <span class="string">'author'</span>]</span><br></pre></td></tr></table></figure></li></ul></li><li><p><code>permissions</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">permissions = [(<span class="string">'can_deliver_pizzas'</span>, <span class="string">'Can deliver pizzas'</span>)]</span><br></pre></td></tr></table></figure><ul><li>每个元组中，第一个元素是<code>permission_code</code>，第二个是供阅读的权限名。</li></ul></li></ul><h2 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h2><ul><li><code>Manager</code>（最重要的管理属性）默认名为<code>objects</code></li></ul><h2 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h2><p>通常需要重写的内置方法</p><ul><li><p><code>__str()__</code></p></li><li><p><code>get_absolute_url()</code>：获取对象唯一的链接</p></li><li><p><code>save()</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Blog</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">100</span>)</span><br><span class="line">    tagline = models.TextField()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">save</span><span class="params">(self, *args, **kwargs)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self.name == <span class="string">"Yoko Ono's blog"</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="comment"># Yoko shall never have her own blog!</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            super().save(*args, **kwargs)  <span class="comment"># Call the "real" save() method.</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h2><h3 id="抽象基类"><a href="#抽象基类" class="headerlink" title="抽象基类"></a>抽象基类</h3><ul><li><p><strong>不会</strong>单独创建数据库表</p></li><li><p>Meta需要被单独继承</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CommonInfo</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        abstract = <span class="literal">True</span></span><br><span class="line">        ordering = [<span class="string">'name'</span>]</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span><span class="params">(CommonInfo)</span>:</span></span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span><span class="params">(CommonInfo.Meta)</span>:</span></span><br><span class="line">        db_table = <span class="string">'student_info'</span></span><br></pre></td></tr></table></figure><ul><li><code>Student</code>的<code>abstract</code>默认为<code>False</code>，需要手动开启。</li><li>如果子类的<code>Meta</code>中<strong>不</strong>指定<code>db_table</code>，则会将子类和父类存在一起。</li></ul></li></ul><h3 id="跨表格继承"><a href="#跨表格继承" class="headerlink" title="跨表格继承"></a>跨表格继承</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Place</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">50</span>)</span><br><span class="line">    address = models.CharField(max_length=<span class="number">80</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Restaurant</span><span class="params">(Place)</span>:</span></span><br><span class="line">    serves_hot_dogs = models.BooleanField(default=<span class="literal">False</span>)</span><br><span class="line">    serves_pizza = models.BooleanField(default=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure><ul><li><p><code>Place</code>和<code>Restaurant</code>的数据存储在不同的数据表中，但是Django默认创建了<strong>一对一</strong>关系，所以<code>Restaurant</code>可以直接使用<code>Place</code>的属性。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; Place.objects.filter(name=<span class="string">"Bob's Cafe"</span>)</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; Restaurant.objects.filter(name=<span class="string">"Bob's Cafe"</span>)</span></span><br></pre></td></tr></table></figure></li><li><p>在子类中关闭<code>Meta</code>继承</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ChildModel</span><span class="params">(ParentModel)</span>:</span></span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        <span class="comment"># Remove parent's ordering effect</span></span><br><span class="line">        ordering = []</span><br></pre></td></tr></table></figure></li></ul><h3 id="Proxy-Model"><a href="#Proxy-Model" class="headerlink" title="Proxy Model"></a>Proxy Model</h3><ul><li><p>对<code>Proxy Model</code>的脏操作会直接作用在原模型上，但是例如排序等操作则只体现在Proxy中。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    first_name = models.CharField(max_length=<span class="number">30</span>)</span><br><span class="line">    last_name = models.CharField(max_length=<span class="number">30</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyPerson</span><span class="params">(Person)</span>:</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        ordering = [<span class="string">"last_name"</span>]</span><br><span class="line">        proxy = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">do_something</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># ...</span></span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure></li><li><p><code>Proxy Model</code>相当于创建了一个<strong>内容相同</strong>，<strong>组织方式自定义</strong>的新类。</p><blockquote><p><strong>没有</strong>像跨表格继承一样创建一张新表存储信息</p></blockquote></li></ul><h3 id="多重继承"><a href="#多重继承" class="headerlink" title="多重继承"></a>多重继承</h3><ul><li>子类仅仅继承<strong>第一个</strong>父类的Meta</li><li>除了抽象基类，子类<strong>不能够</strong>覆盖父类的属性。</li></ul><h2 id="包"><a href="#包" class="headerlink" title="包"></a>包</h2><ul><li><p>将<code>models.py</code>替换为<code>myapp/models</code>，在其中创建<code>__init__.py</code>和需要的Model类。</p></li><li><p>在<code>__init__.py</code>中逐个引入Model类</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> .organic <span class="keyword">import</span> Person</span><br><span class="line"><span class="keyword">from</span> .synthetic <span class="keyword">import</span> Robot</span><br></pre></td></tr></table></figure></li></ul><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://docs.djangoproject.com/en/dev/topics/db/models" target="_blank" rel="noopener">https://docs.djangoproject.com/en/dev/topics/db/models</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;全文共&lt;code&gt;1795&lt;/code&gt;字，推荐阅读时间&lt;code&gt;15~20&lt;/code&gt;分钟。&lt;/p&gt;
    
    </summary>
    
    
      <category term="Web" scheme="http://yoursite.com/categories/Web/"/>
    
      <category term="Django" scheme="http://yoursite.com/categories/Django/"/>
    
    
  </entry>
  
  <entry>
    <title>Protocol-Chapter0-网络编程</title>
    <link href="http://yoursite.com/2020/07/29/Protocol-Chapter0-%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/"/>
    <id>http://yoursite.com/2020/07/29/Protocol-Chapter0-%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/</id>
    <published>2020-07-29T12:27:15.312Z</published>
    <updated>2020-07-29T12:31:41.778Z</updated>
    
    <content type="html"><![CDATA[<p>全文共<code>1275</code>字，推荐阅读时间<code>10~15</code>分钟。</p><a id="more"></a><h2 id="TCP-IP"><a href="#TCP-IP" class="headerlink" title="TCP/IP"></a>TCP/IP</h2><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><h4 id="IP"><a href="#IP" class="headerlink" title="IP"></a>IP</h4><ul><li><p>互联网上每个计算机的<strong>唯一标识</strong>就是IP地址，类似<code>123.123.123.123</code>.</p></li><li><p>当一台计算机同时接到<strong>多个</strong>网络时，就会有多个IP地址。</p><blockquote><p>IP地址对应的实际上是计算机的网络接口，通常是网卡。</p></blockquote></li><li><p>IP协议负责把数据从一台计算机通过网络发送到另一台计算机</p><ul><li>将数据分成块，通过IP包发送。</li><li>IP包<strong>不保证</strong>能到达，也<strong>不保证</strong>顺序到达。</li></ul></li><li><p>IP地址实际上是一个<strong>32</strong>位整数（称为IPv4）</p><ul><li><code>192.168.0.1</code>实际上是把32位整数<strong>按8位</strong>分组后的数字表示</li><li>IPv6是一个<strong>128</strong>位整数，<strong>按16位</strong>分组，例如<code>2001:0db8:85a3:0042:1000:8a2e:0370:7334</code>.</li></ul></li></ul><h4 id="TCP"><a href="#TCP" class="headerlink" title="TCP"></a>TCP</h4><ul><li>TCP是建立在IP协议之上，负责在两台计算机之间<strong>建立可靠连接</strong>，并且保证数据包<strong>按顺序</strong>到达的协议。</li><li>TCP传输过程中如果出现丢包则<strong>自动重发</strong></li><li>TCP协议是许多高级协议的基础，<strong>例如HTTP协议、发送邮件的SMTP协议。</strong></li><li>TCP报文=数据+源IP地址+目标IP地址+源端口+目标端口</li><li>一个进程可能同时和多个计算机建立链接，因此可能会申请很多端口。</li></ul><h2 id="TCP编程"><a href="#TCP编程" class="headerlink" title="TCP编程"></a>TCP编程</h2><h3 id="概述-1"><a href="#概述-1" class="headerlink" title="概述"></a>概述</h3><ul><li><p>Socket表示“打开了一个网络链接”</p><blockquote><p>需要知道目标计算机的IP地址和端口号，并指定<strong>协议类型</strong>。</p></blockquote></li></ul><h3 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h3><ul><li><p>创建TCP链接时，主动发起链接的叫<strong>客户端</strong>，被动响应链接的叫<strong>服务器</strong>。</p></li><li><p>创建基于TCP的Socket</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">s.connect((<span class="string">'www.sina.com.cn'</span>, <span class="number">80</span>))</span><br></pre></td></tr></table></figure><ul><li><p><code>AF_INET</code>指定使用IPv4，<code>AF_INET6</code>指定<code>IPv6</code>.</p></li><li><p><code>SOCK_STREAM</code>指定使用面向流的TCP协议</p></li><li><p><code>connect</code>负责主动发起TCP连接，需要指定IP地址和端口号。</p><ul><li><p>新浪网址可以自动转换为IP地址</p></li><li><p><code>80</code>端口是<strong>网页服务</strong>的标准端口</p><blockquote><ul><li><code>SMTP</code>是<code>25</code>端口，<code>FTP</code>是<code>21</code>端口。</li><li>端口号小于1024是标准服务的端口（固定），大于1024的<strong>可以任意</strong>使用。</li></ul></blockquote></li><li><p>参数是一个<code>tuple</code></p></li></ul></li></ul></li><li><p>发送请求</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s.send(<span class="string">b'GET / HTTP/1.1\r\nHost: www.sina.com.cn\r\nConnection: close\r\n\r\n'</span>)</span><br></pre></td></tr></table></figure><ul><li>要求返回首页的内容</li><li>TCP建立的是<strong>双向</strong>通道，发送数据的顺序由具体的协议确定。例如HTTP规定客户端必须<strong>先</strong>向服务器发送请求，<strong>之后</strong>服务器才能发送数据给客户端。</li></ul></li><li><p>接收数据</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">buffer = []</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    d = s.recv(<span class="number">1024</span>)</span><br><span class="line">    <span class="keyword">if</span> d:</span><br><span class="line">        buffer.append(d)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">data = <span class="string">b''</span>.join(buffer)</span><br></pre></td></tr></table></figure><ul><li><code>recv(max)</code>指定一次<strong>最多</strong>接收的<strong>字节数</strong></li></ul></li><li><p>关闭Socket</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s.close()</span><br></pre></td></tr></table></figure></li><li><p>处理数据</p><p>接收到的数据包括<strong>HTTP头和网页本身</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">header, html = data.split(<span class="string">b'\r\n\r\n'</span>, <span class="number">1</span>)</span><br><span class="line">print(header.decode(<span class="string">'utf-8'</span>))</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'sina.html'</span>, <span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(html)</span><br></pre></td></tr></table></figure><ul><li>在浏览器打开<code>sina.html</code>就可以看到新浪的首页</li></ul></li></ul><h3 id="服务器"><a href="#服务器" class="headerlink" title="服务器"></a>服务器</h3><ul><li><p>服务器会打开固定的端口（例如80）监听客户端的请求，为了区分不同客户端的请求，<strong>服务器</strong>创建的Socket需要<strong>服务器地址、服务器端口、客户端地址、客户端端口</strong>来进行辨别。</p></li><li><p>为了同时响应多个客户端的需求，每个连接都需要一个进程/线程来处理。</p></li><li><p>创建一个Socket</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br></pre></td></tr></table></figure></li><li><p>绑定<strong>监听的</strong>地址和端口</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s.bind((<span class="string">'127.0.0.1'</span>, <span class="number">9999</span>))</span><br></pre></td></tr></table></figure><ul><li><p><code>0.0.0.0</code>表示<strong>所有的</strong>网络地址</p></li><li><p><code>127.0.0.1</code>表示<strong>本机地址</strong></p><blockquote><p>当绑定到本机地址时，客户端必须在<strong>本地</strong>运行。</p></blockquote></li></ul></li><li><p>开始监听</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">s.listen(<span class="number">5</span>)</span><br><span class="line">print(<span class="string">"Waiting for connection..."</span>)</span><br></pre></td></tr></table></figure><ul><li><code>listen(max)</code>：指定等待连接的<strong>最大</strong>数量</li></ul></li><li><p>建立连接</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    sock, addr = s.accept()</span><br><span class="line">    t = threading.Thread(target=tcplink, args=(sock, addr))</span><br><span class="line">    t.start()</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tcplink</span><span class="params">(sock, addr)</span>:</span></span><br><span class="line">    print(<span class="string">"Accept new connection from %s:%s..."</span> % addr)</span><br><span class="line">    sock.send(<span class="string">b"Welcome!"</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        data = sock.recv(<span class="number">1024</span>)</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> data <span class="keyword">or</span> data.decode(<span class="string">'utf-8'</span>) == <span class="string">'exit'</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        sock.send((<span class="string">"Hello, %s|"</span> % data.decode(<span class="string">'utf-8'</span>)).encode(<span class="string">'utf-8'</span>))</span><br><span class="line">    sock.close()</span><br><span class="line">    print(<span class="string">"Connection form %s:%s closed."</span> % addr)</span><br></pre></td></tr></table></figure><ul><li><code>addr</code>是一个元组，例如<code>(&#39;127.0.0.1&#39;, 62456)</code>.</li></ul></li></ul><ul><li><p>服务器测试程序</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">s.connect((<span class="string">'127.0.0.1'</span>, <span class="number">9999</span>))</span><br><span class="line">print(s.recv(<span class="number">1024</span>).decode(<span class="string">'utf-8'</span>))</span><br><span class="line"><span class="keyword">for</span> data <span class="keyword">in</span> [<span class="string">b'Michael'</span>, <span class="string">b'Tracy'</span>, <span class="string">b'Sarah'</span>]:</span><br><span class="line">    s.send(data)</span><br><span class="line">    print(s.recv(<span class="number">1024</span>).decode(<span class="string">'utf-8'</span>))</span><br><span class="line">s.send(<span class="string">b'exit'</span>)</span><br><span class="line">s.close()</span><br></pre></td></tr></table></figure></li></ul><h2 id="UDP编程"><a href="#UDP编程" class="headerlink" title="UDP编程"></a>UDP编程</h2><h3 id="概述-2"><a href="#概述-2" class="headerlink" title="概述"></a>概述</h3><ul><li>相对于TCP，UDP是面向<strong>无连接</strong>的协议。</li><li>使用UDP时，<strong>不需要建立连接</strong>，只需要知道<strong>IP地址和端口号</strong>就可以直接发送数据包。（不保证能到达）</li><li>相比于TCP，UDP的数据传输速度<strong>更快</strong>。</li></ul><h3 id="客户端-1"><a href="#客户端-1" class="headerlink" title="客户端"></a>客户端</h3><ul><li><p>创建socket</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)</span><br></pre></td></tr></table></figure></li><li><p>发送数据<strong>（不需要connect）</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> data <span class="keyword">in</span> [<span class="string">b'Michael'</span>, <span class="string">b'Tracy'</span>, <span class="string">b'Sarah'</span>]:</span><br><span class="line">    s.sendto(data, (<span class="string">'127.0.0.1'</span>, <span class="number">9999</span>))</span><br><span class="line">    print(s.recv(<span class="number">1024</span>).decode(<span class="string">'utf-8'</span>))</span><br><span class="line">s.close()</span><br></pre></td></tr></table></figure></li></ul><h3 id="服务器-1"><a href="#服务器-1" class="headerlink" title="服务器"></a>服务器</h3><ul><li><p>绑定端口</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)</span><br><span class="line">s.bind((<span class="string">'127.0.0.1'</span>, <span class="number">9999</span>))</span><br></pre></td></tr></table></figure><ul><li><code>SOCK_DGRAM</code>指定了Socket类型是UDP</li><li>UDP和TCP的端口<strong>不冲突</strong>，即9999在两种连接中可以重复使用，但是<strong>相互独立</strong>。</li></ul></li><li><p>接收数据</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="string">'Bind UDP on 9999...'</span>)</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    data, addr = s.recvfrom(<span class="number">1024</span>)</span><br><span class="line">    print(<span class="string">'Received from %s:%s.'</span> % addr)</span><br><span class="line">    s.sendto(<span class="string">b'Hello, %s!'</span> % data, addr)</span><br></pre></td></tr></table></figure><ul><li><code>recvfrom()</code>返回客户端的地址和端口</li></ul></li></ul><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://www.liaoxuefeng.com/" target="_blank" rel="noopener">https://www.liaoxuefeng.com/</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;全文共&lt;code&gt;1275&lt;/code&gt;字，推荐阅读时间&lt;code&gt;10~15&lt;/code&gt;分钟。&lt;/p&gt;
    
    </summary>
    
    
      <category term="Web" scheme="http://yoursite.com/categories/Web/"/>
    
      <category term="Protocol" scheme="http://yoursite.com/categories/Protocol/"/>
    
    
  </entry>
  
  <entry>
    <title>JavaScript-Chapter7-underscore</title>
    <link href="http://yoursite.com/2020/07/14/JavaScript-Chapter7-underscore/"/>
    <id>http://yoursite.com/2020/07/14/JavaScript-Chapter7-underscore/</id>
    <published>2020-07-14T14:47:42.411Z</published>
    <updated>2020-07-14T14:48:46.086Z</updated>
    
    <content type="html"><![CDATA[<p>全文共<code>1858</code>字，推荐阅读时间<code>10~15</code>分钟。</p><a id="more"></a><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>在<code>Object</code>上使用数组才有的<code>map()</code>/<code>filter()</code>等操作</p><ul><li>在<code>Object.prototype</code>中加上<code>mapObject()</code>等类似的方法</li><li>找一个成熟的第三方开源库，统一使用的函数。<ul><li>underscore就是这样一个库</li></ul></li></ul><p>与jQuery类似</p><ul><li><p>underscore把自己绑定在<code>_</code>上</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">_.map([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], (x) =&gt; x * x); <span class="comment">// Array</span></span><br><span class="line">_.map(&#123;<span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">2</span>, <span class="attr">c</span>: <span class="number">3</span>&#125;, (value, key) =&gt; key + <span class="string">'='</span> + value); <span class="comment">// object</span></span><br></pre></td></tr></table></figure><ul><li>注意箭头函数传入对象参数时，第一个参数是<code>value</code>，<strong>不是<code>key</code></strong>.</li></ul></li></ul><h2 id="Collections"><a href="#Collections" class="headerlink" title="Collections"></a>Collections</h2><p>underscore支持集合类（Array/Object），不支持Map和Set.</p><h3 id="map-filter"><a href="#map-filter" class="headerlink" title="map/filter"></a>map/filter</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> upperArr = _.map(obj, <span class="function"><span class="keyword">function</span> (<span class="params">value, key</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> value.toUpperCase();</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">var</span> upperObj = _.mapObject(obj, <span class="function"><span class="keyword">function</span> (<span class="params">value, key</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> value.toUpperCase();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">upperArr; <span class="comment">// ["BOB","NO.1 MIDDLE SCHOOL","XUEYUAN ROAD"]</span></span><br><span class="line">upperObj; <span class="comment">// &#123;"name":"BOB","school":"NO.1 MIDDLE SCHOOL","address":"XUEYUAN ROAD"&#125;</span></span><br></pre></td></tr></table></figure><blockquote><p>注意两种<code>map</code>操作的返回值类型<strong>不同</strong></p></blockquote><h3 id="every-some"><a href="#every-some" class="headerlink" title="every/some"></a>every/some</h3><ul><li><p>当集合的<strong>所有元素</strong>都满足条件时，<code>_.every()</code>返回<code>true</code>；当集合<strong>至少一个元素</strong>满足条件时，<code>_.some()</code>函数返回<code>true</code>.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">_.every([<span class="number">-3</span>, <span class="number">-2</span>, <span class="number">-1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], (x) =&gt; x &gt; <span class="number">0</span>); <span class="comment">// false</span></span><br><span class="line">_.some([<span class="number">-3</span>, <span class="number">-2</span>, <span class="number">-1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], (x) =&gt; x &lt; <span class="number">0</span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure></li><li><p>函数参数获取对象的<code>value</code>和<code>key</code>的顺序和<code>map</code>一致</p></li><li><p>例子：判断对象中键值对的小写情况</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> r1 = _.every(obj, <span class="function"><span class="keyword">function</span> (<span class="params">value, key</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> cmp1 = key.toLowerCase() === key;</span><br><span class="line">    <span class="keyword">var</span> cmp2 = value.toLowerCase() === value;</span><br><span class="line">    <span class="keyword">return</span> cmp1 &amp;&amp; cmp2;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">var</span> r2 = _.some(obj, <span class="function"><span class="keyword">function</span> (<span class="params">value, key</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> cmp1 = key.toLowerCase() === key;</span><br><span class="line">    <span class="keyword">var</span> cmp2 = value.toLowerCase() === value;</span><br><span class="line">    <span class="comment">// console.log(key + ' ' +cmp1 + ' ' + cmp2);</span></span><br><span class="line">    <span class="keyword">return</span> cmp1 || cmp2;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ul><li>字符串之间的比较<strong>不能</strong>使用<code>-</code>，但是可以使用<code>&gt;</code>/<code>&lt;</code>.</li><li>字符串之间相等<strong>可以</strong>直接用<code>===</code>（和Java的引用相等不同）</li></ul></li></ul><h3 id="max-min"><a href="#max-min" class="headerlink" title="max/min"></a>max/min</h3><p>返回集合中最大/最小的数</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>];</span><br><span class="line">_.max(arr); <span class="comment">// 5</span></span><br><span class="line">_.min(arr); <span class="comment">// 1</span></span><br></pre></td></tr></table></figure><ul><li><p>空集合的返回结果是无穷，因此在使用<code>max</code>/<code>min</code>之前要判断集合是否为空。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">_.max([]); <span class="comment">// -Infinity</span></span><br><span class="line">_.min([]); <span class="comment">// Infinity</span></span><br></pre></td></tr></table></figure><ul><li>注意<code>max</code>返回的是<strong><code>-Infinity</code></strong></li></ul></li><li><p>当集合是对象时，<code>max()</code>和<code>min()</code><strong>只作用</strong>于<code>value</code>，忽略<code>key</code>.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_.max(&#123; <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">2</span>, <span class="attr">c</span>: <span class="number">3</span>&#125;); <span class="comment">// 3</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="groupBy"><a href="#groupBy" class="headerlink" title="groupBy"></a>groupBy</h3><p>把集合的元素按照<code>key</code>归类并返回一个<strong>对象</strong>，其中<code>key</code>由函数参数指定。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> scores = [<span class="number">20</span>, <span class="number">81</span>, <span class="number">75</span>, <span class="number">40</span>, <span class="number">91</span>, <span class="number">59</span>, <span class="number">77</span>, <span class="number">66</span>, <span class="number">72</span>, <span class="number">88</span>, <span class="number">99</span>];</span><br><span class="line"><span class="keyword">var</span> groups = _.groupBy(scores, <span class="function"><span class="keyword">function</span> (<span class="params">x</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">60</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'C'</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (x &lt; <span class="number">80</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'B'</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'A'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 结果:</span></span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//   A: [81, 91, 88, 99],</span></span><br><span class="line"><span class="comment">//   B: [75, 77, 66, 72],</span></span><br><span class="line"><span class="comment">//   C: [20, 40, 59]</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br></pre></td></tr></table></figure><h3 id="shuffle-sample"><a href="#shuffle-sample" class="headerlink" title="shuffle/sample"></a>shuffle/sample</h3><ul><li><p><code>shuffle()</code>随机打乱一个集合</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_.shuffle([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]);</span><br></pre></td></tr></table></figure></li><li><p><code>sample()</code>随机选择<strong>一个或多个</strong>元素</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">_.sample([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]);</span><br><span class="line">_.sample([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>], <span class="number">3</span>); <span class="comment">// pick up three elements</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="Arrays"><a href="#Arrays" class="headerlink" title="Arrays"></a>Arrays</h2><h3 id="first-last"><a href="#first-last" class="headerlink" title="first/last"></a>first/last</h3><p>取第一个/最后一个元素</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>];</span><br><span class="line">_.first(arr); <span class="comment">// 2</span></span><br><span class="line">_.last(arr); <span class="comment">// 8</span></span><br></pre></td></tr></table></figure><h3 id="flatten"><a href="#flatten" class="headerlink" title="flatten"></a>flatten</h3><p>接收一个<code>Array</code>，无论<code>Array</code>中嵌套了多少层，都全部拆开提取元素成为一维数组。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_.flatten([<span class="number">1</span>, [<span class="number">2</span>], [<span class="number">3</span>, [[<span class="number">4</span>], [<span class="number">5</span>]]]]); <span class="comment">// [1, 2, 3, 4, 5]</span></span><br></pre></td></tr></table></figure><h3 id="zip-unzip"><a href="#zip-unzip" class="headerlink" title="zip/unzip"></a>zip/unzip</h3><ul><li><p><code>zip</code>把两个/多个数组的所有元素<strong>按索引</strong>合并成<strong>新数组</strong>，然后多个新数组一起组成<strong>大数组</strong>。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> names = [<span class="string">'Adam'</span>, <span class="string">'Lisa'</span>, <span class="string">'Bart'</span>];</span><br><span class="line"><span class="keyword">var</span> scores = [<span class="number">85</span>, <span class="number">92</span>, <span class="number">59</span>];</span><br><span class="line">_.zip(names, scores);</span><br><span class="line"><span class="comment">// [['Adam', 85], ['Lisa', 92], ['Bart', 59]]</span></span><br></pre></td></tr></table></figure></li><li><p><code>unzip</code>是<code>zip</code>的逆过程</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> nameAndScores = [[<span class="string">'Adam'</span>, <span class="number">85</span>], [<span class="string">'Lisa'</span>, <span class="number">92</span>], [<span class="string">'Bart'</span>, <span class="number">59</span>]];</span><br><span class="line">_.unzip(nameAndScores);</span><br><span class="line"><span class="comment">// [['Adam', 'Lisa', 'Bart'], [85, 92, 59]]</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="object"><a href="#object" class="headerlink" title="object"></a>object</h3><p>和<code>zip</code>类似，但是是直接转换成对象。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> names = [<span class="string">'Adam'</span>, <span class="string">'Lisa'</span>, <span class="string">'Bart'</span>];</span><br><span class="line"><span class="keyword">var</span> scores = [<span class="number">85</span>, <span class="number">92</span>, <span class="number">59</span>];</span><br><span class="line">_.object(names, scores);</span><br><span class="line"><span class="comment">// &#123;Adam: 85, Lisa: 92, Bart: 59&#125;</span></span><br></pre></td></tr></table></figure><h3 id="range"><a href="#range" class="headerlink" title="range"></a>range</h3><p>快速生成一个序列</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 从0开始小于10:</span></span><br><span class="line">_.range(<span class="number">10</span>); <span class="comment">// [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 从1开始小于11：</span></span><br><span class="line">_.range(<span class="number">1</span>, <span class="number">11</span>); <span class="comment">// [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 从0开始小于30，步长5:</span></span><br><span class="line">_.range(<span class="number">0</span>, <span class="number">30</span>, <span class="number">5</span>); <span class="comment">// [0, 5, 10, 15, 20, 25]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 从0开始大于-10，步长-1:</span></span><br><span class="line">_.range(<span class="number">0</span>, <span class="number">-10</span>, <span class="number">-1</span>); <span class="comment">// [0, -1, -2, -3, -4, -5, -6, -7, -8, -9]</span></span><br></pre></td></tr></table></figure><h3 id="uniq"><a href="#uniq" class="headerlink" title="uniq"></a>uniq</h3><p>对数组元素去重</p><ul><li><p><code>_.uniq(array, [isSorted], [iteratee])</code></p><ul><li>如果数组已经排序，第二个参数传<code>true</code>可以进行加速。</li><li>如果想要<strong>自定义</strong>去重判断属性，传入<code>iteratee</code>.</li></ul></li><li><p>例子：对数组元素进行不区分大小写去重</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> result = _.uniq(arr, (x) =&gt; x.toLowerCase());</span><br></pre></td></tr></table></figure><ul><li><code>uniq</code><strong>不会</strong>改变原数组，而是返回一个没有重复元素的副本。</li></ul></li></ul><h2 id="Functions"><a href="#Functions" class="headerlink" title="Functions"></a>Functions</h2><h3 id="bind"><a href="#bind" class="headerlink" title="bind"></a>bind</h3><p>当使用一个变量<code>fn</code>指向一个对象的方法时，直接调用<code>fn()</code>因为<code>this</code>没有意义会失败，所以使用<code>bind</code>修复这个问题。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> s = <span class="string">' Hello '</span>;</span><br><span class="line"><span class="keyword">var</span> fn = _.bind(s.trim, s);</span><br><span class="line">fn(); <span class="comment">// Hello;</span></span><br></pre></td></tr></table></figure><ul><li><code>trim</code><strong>不会</strong>直接修改字符串</li></ul><h3 id="partial"><a href="#partial" class="headerlink" title="partial"></a>partial</h3><p>为一个函数创建<strong>偏函数</strong>，将原函数的某些参数固定住，方便调用常用的参数搭配。</p><ul><li><p>使用<code>pow</code>固定底数（第一个参数）为2来创建<code>pow2N</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> pow2N = _.partial(<span class="built_in">Math</span>.pow, <span class="number">2</span>);</span><br><span class="line">pow2N(<span class="number">3</span>);</span><br><span class="line">pow2N(<span class="number">5</span>);</span><br><span class="line">pow2N(<span class="number">10</span>);</span><br></pre></td></tr></table></figure></li><li><p>固定第二个参数：使用<code>_</code>占位</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> cube = _.partial(<span class="built_in">Math</span>.pow, _, <span class="number">3</span>);</span><br></pre></td></tr></table></figure><ul><li>多个参数时也用<code>_</code>占位</li></ul></li></ul><h3 id="memoize"><a href="#memoize" class="headerlink" title="memoize"></a>memoize</h3><ul><li><p><strong>不是</strong><code>memorize</code></p></li><li><p>用于缓存结果，可以在后续调用时直接获得。</p></li><li><p>例子：阶乘加速</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> factorial = _.memoize(<span class="function"><span class="keyword">function</span>(<span class="params">n</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'start calculate '</span> + n + <span class="string">'!...'</span>);</span><br><span class="line">    <span class="keyword">var</span> s = <span class="number">1</span>, i = n;</span><br><span class="line">    <span class="keyword">while</span> (i &gt; <span class="number">1</span>) &#123;</span><br><span class="line">        s = s * i;</span><br><span class="line">        i --;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.log(n + <span class="string">'! = '</span> + s);</span><br><span class="line">    <span class="keyword">return</span> s;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第一次调用:</span></span><br><span class="line">factorial(<span class="number">10</span>); <span class="comment">// 3628800</span></span><br><span class="line"><span class="comment">// 注意控制台输出:</span></span><br><span class="line"><span class="comment">// start calculate 10!...</span></span><br><span class="line"><span class="comment">// 10! = 3628800</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 第二次调用:</span></span><br><span class="line">factorial(<span class="number">10</span>); <span class="comment">// 3628800</span></span><br><span class="line"><span class="comment">// 控制台没有输出</span></span><br></pre></td></tr></table></figure><ul><li><p>如果计算9的阶乘还是会重新计算，所以进行改进——变为递归调用，就可以记录下每一次的路径。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> factorial = _.memoize(<span class="function"><span class="keyword">function</span> (<span class="params">n</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'start'</span>);</span><br><span class="line">    <span class="keyword">if</span> (n &lt; <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> n * factorial(n - <span class="number">1</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li></ul></li></ul><h3 id="once"><a href="#once" class="headerlink" title="once"></a>once</h3><p>保证某个函数仅执行一次，用于解决一个函数有多个按键都可以索引到的情况。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> register = _.once(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    alert(<span class="string">'ok'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="delay"><a href="#delay" class="headerlink" title="delay"></a>delay</h3><p>让一个函数延迟执行，效果和<code>setTimeOut</code>是一样的。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_.delay(alert, <span class="number">2000</span>);</span><br></pre></td></tr></table></figure><ul><li><p>函数有参数时，在时间参数后<strong>依次</strong>传入。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> log = _.bind(<span class="built_in">console</span>.log, <span class="built_in">console</span>);</span><br><span class="line">_.delay(log, <span class="number">2000</span>, <span class="string">'Hello, '</span>, <span class="string">'World!'</span>); <span class="comment">// 2秒后打印'Hello, World!'</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="Objects"><a href="#Objects" class="headerlink" title="Objects"></a>Objects</h2><h3 id="keys-allKeys"><a href="#keys-allKeys" class="headerlink" title="keys/allKeys"></a>keys/allKeys</h3><ul><li><p><code>keys()</code>返回一个object自身所有的key，但不包含从原型继承下来的。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Student</span>(<span class="params">name, age</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">    <span class="keyword">this</span>.age = age;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> xiaoming = <span class="keyword">new</span> Student(<span class="string">'xiaoming'</span>, <span class="number">20</span>);</span><br><span class="line">_.keys(xiaoming); <span class="comment">// ['name', 'age']</span></span><br></pre></td></tr></table></figure></li><li><p><code>allKeys()</code>除了自身属性之外，还包含继承得到的。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Student</span>(<span class="params">name, age</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">    <span class="keyword">this</span>.age = age;</span><br><span class="line">&#125;</span><br><span class="line">Student.prototype.school = <span class="string">'No.1 Middle School'</span>;</span><br><span class="line"><span class="keyword">var</span> xiaoming = <span class="keyword">new</span> Student(<span class="string">'xiaoming'</span>, <span class="number">20</span>);</span><br><span class="line">_.allKeys(xiaoming); <span class="comment">// ['name', 'age', 'school']</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="values"><a href="#values" class="headerlink" title="values"></a>values</h3><p>与<code>keys()</code>对应，返回object自身的属性值。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">    name: <span class="string">'xiaoming'</span>,</span><br><span class="line">    age: <span class="number">20</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">_.values(obj); <span class="comment">// ['xiaoming', 20]</span></span><br></pre></td></tr></table></figure><h3 id="mapObject"><a href="#mapObject" class="headerlink" title="mapObject"></a>mapObject</h3><p>object的<code>map()</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">    a: <span class="number">1</span>,</span><br><span class="line">    b: <span class="number">2</span>,</span><br><span class="line">    c: <span class="number">3</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">_.mapObject(obj, (v, k) =&gt; <span class="number">100</span> + v); <span class="comment">// &#123; a: 101, b: 102, c: 103 &#125;</span></span><br></pre></td></tr></table></figure><h3 id="invert"><a href="#invert" class="headerlink" title="invert"></a>invert</h3><p>将key和value进行交换</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">    Adam: <span class="number">90</span>,</span><br><span class="line">    Lisa: <span class="number">85</span>,</span><br><span class="line">    Bart: <span class="number">59</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">_.invert(obj); <span class="comment">// &#123; '59': 'Bart', '85': 'Lisa', '90': 'Adam' &#125;</span></span><br></pre></td></tr></table></figure><h3 id="extend-extendOwn"><a href="#extend-extendOwn" class="headerlink" title="extend/extendOwn"></a>extend/extendOwn</h3><ul><li><p><code>extend</code>把多个对象合并到第一个对象参数中，返回合并后的对象，<strong>同时修改原对象</strong>。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = &#123;</span><br><span class="line">    name: <span class="string">'Bob'</span>,</span><br><span class="line">    age: <span class="number">20</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">_.extend(a, &#123;<span class="attr">age</span>: <span class="number">15</span>&#125;, &#123;<span class="attr">age</span>: <span class="number">88</span>, <span class="attr">city</span>: <span class="string">'Beijing'</span>&#125;); <span class="comment">// &#123;name: 'Bob', age: 88, city: 'Beijing'&#125;</span></span><br></pre></td></tr></table></figure></li><li><p><code>extendOwn()</code>在获取每个对象参数的属性时，<strong>忽略</strong>继承得到的属性。</p></li></ul><h3 id="clone"><a href="#clone" class="headerlink" title="clone"></a>clone</h3><p>实现对象<strong>浅复制</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> source = &#123;</span><br><span class="line">    name: <span class="string">'小明'</span>,</span><br><span class="line">    age: <span class="number">20</span>,</span><br><span class="line">    skills: [<span class="string">'JavaScript'</span>, <span class="string">'CSS'</span>, <span class="string">'HTML'</span>]</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> copied = _.clone(source);</span><br></pre></td></tr></table></figure><h3 id="isEqual"><a href="#isEqual" class="headerlink" title="isEqual"></a>isEqual</h3><p>对两个对象进行深度比较，如果<strong>内容完全相同</strong>就返回<code>true</code>.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> o1 = &#123; <span class="attr">name</span>: <span class="string">'Bob'</span>, <span class="attr">skills</span>: &#123; <span class="attr">Java</span>: <span class="number">90</span>, <span class="attr">JavaScript</span>: <span class="number">99</span> &#125;&#125;;</span><br><span class="line"><span class="keyword">var</span> o2 = &#123; <span class="attr">name</span>: <span class="string">'Bob'</span>, <span class="attr">skills</span>: &#123; <span class="attr">JavaScript</span>: <span class="number">99</span>, <span class="attr">Java</span>: <span class="number">90</span> &#125;&#125;;</span><br><span class="line"></span><br><span class="line">o1 === o2; <span class="comment">// false</span></span><br><span class="line">_.isEqual(o1, o2); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><ul><li><p><code>Array</code>也可以使用</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> o1 = [<span class="string">'Bob'</span>, &#123; <span class="attr">skills</span>: [<span class="string">'Java'</span>, <span class="string">'JavaScript'</span>] &#125;];</span><br><span class="line"><span class="keyword">var</span> o2 = [<span class="string">'Bob'</span>, &#123; <span class="attr">skills</span>: [<span class="string">'Java'</span>, <span class="string">'JavaScript'</span>] &#125;];</span><br><span class="line"></span><br><span class="line">o1 === o2; <span class="comment">// false</span></span><br><span class="line">_.isEqual(o1, o2); <span class="comment">// true</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="Chaining"><a href="#Chaining" class="headerlink" title="Chaining"></a>Chaining</h2><p>通过<code>chain()</code>函数实现underscore函数的链式调用</p><ul><li><p>例子</p><p>非链式调用</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_.filter(_.map([<span class="number">1</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">16</span>, <span class="number">25</span>], <span class="built_in">Math</span>.sqrt), (x) =&gt; x % <span class="number">2</span> === <span class="number">1</span>); <span class="comment">// [1, 3, 5]</span></span><br></pre></td></tr></table></figure><p>链式调用</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> r = _.chain([<span class="number">1</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">16</span>, <span class="number">25</span>])</span><br><span class="line"> .map(<span class="built_in">Math</span>.sqrt)</span><br><span class="line"> .filter(<span class="function"><span class="params">x</span> =&gt;</span> x &amp; <span class="number">2</span> === <span class="number">1</span>)</span><br><span class="line"> .value();</span><br><span class="line">r; <span class="comment">// [1, 3, 5]</span></span><br></pre></td></tr></table></figure><ul><li>使用<code>chain</code>函数后每一步都是<strong>包装对象</strong>，所以最后一步的结果需要使用<code>value</code>获取值。</li></ul></li></ul><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://www.liaoxuefeng.com/" target="_blank" rel="noopener">https://www.liaoxuefeng.com/</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;全文共&lt;code&gt;1858&lt;/code&gt;字，推荐阅读时间&lt;code&gt;10~15&lt;/code&gt;分钟。&lt;/p&gt;
    
    </summary>
    
    
      <category term="Web" scheme="http://yoursite.com/categories/Web/"/>
    
      <category term="JavaScript" scheme="http://yoursite.com/categories/JavaScript/"/>
    
    
  </entry>
  
  <entry>
    <title>MySQL-Chapter4-MySQL操作</title>
    <link href="http://yoursite.com/2020/07/11/MySQL-Chapter4-MySQL%E6%93%8D%E4%BD%9C/"/>
    <id>http://yoursite.com/2020/07/11/MySQL-Chapter4-MySQL%E6%93%8D%E4%BD%9C/</id>
    <published>2020-07-11T07:32:26.255Z</published>
    <updated>2020-07-11T07:33:22.124Z</updated>
    
    <content type="html"><![CDATA[<p>全文共<code>664</code>字，推荐阅读时间<code>7~10</code>分钟。</p><a id="more"></a><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><ul><li><p><code>MySQL Client</code>是一个<strong>命令行</strong>客户端，对应的可执行程序是mysql.</p></li><li><p><code>MySQL Server</code>是真正的MySQL<strong>服务器</strong>，对应的可执行程序是mysqld.</p></li><li><p>Client通过TCP连接发送到Server，默认端口是3306，如果发送到本机的服务器，地址为<code>127.0.0.1:3306</code>.</p></li><li><p>连接到远程Server</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -h IP_addr_of_distant_server -u root -p</span><br></pre></td></tr></table></figure></li></ul><h2 id="管理MySQL"><a href="#管理MySQL" class="headerlink" title="管理MySQL"></a>管理MySQL</h2><h3 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h3><ul><li>显示：<code>SHOW DATABASES;</code></li><li><code>information_schema</code>/<code>mysql</code>/<code>performance_schema</code>/<code>sys</code>是系统库，不能改动，</li><li>创建：<code>CREATE DATABASE test;</code></li><li>删除：<code>DROP DATABASE test;</code></li><li>切换：<code>USE test;</code></li></ul><h3 id="表"><a href="#表" class="headerlink" title="表"></a>表</h3><ul><li><p>创建：<code>CREATE TABLE students(...);</code></p><ul><li>至少有一列，并且需要使用<code>PRIMARY KEY (xxx)</code>指定为主键列。</li></ul></li><li><p>删除：<code>DROP TABLE students;</code></p></li><li><p>显示：<code>SHOW TABLES;</code></p></li><li><p>查看结构：<code>DESC students;</code>/<code>SHOW CREATE TABLE students;</code></p></li><li><p>修改</p><ul><li><p>新增列<code>birth</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE students ADD COLUMN birth VARCHAR(10) NOT NULL;</span><br></pre></td></tr></table></figure></li><li><p>修改列名为<code>birthday</code>，并修改数据类型。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE students CHANGE COLUMN birth birthday VARCHAR(20) NOT NULL;</span><br></pre></td></tr></table></figure><ul><li><code>VARCHAR(xx) NOT NULL</code>：数据类型以及约束<strong>不能</strong>被省略</li></ul></li><li><p>删除列</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE students DROP COLUMN birthday;</span><br></pre></td></tr></table></figure></li></ul></li></ul><h2 id="实用语句"><a href="#实用语句" class="headerlink" title="实用语句"></a>实用语句</h2><h3 id="插入或替换"><a href="#插入或替换" class="headerlink" title="插入或替换"></a>插入或替换</h3><p>插入记录时，<strong>如果</strong>需要对重复元素进行替换，直接使用<code>REPLACE</code>语句可以省略手动查询的过程。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">REPLACE INTO students (id, class_id, name, gender, score) VALUES (1, 1, &#39;C&#39;, &#39;F&#39;, 99);</span><br></pre></td></tr></table></figure><ul><li>当<code>id=1</code>的记录不存在时会直接插入，如果存在则会删除后再插入。</li></ul><h3 id="插入或更新"><a href="#插入或更新" class="headerlink" title="插入或更新"></a>插入或更新</h3><p>插入记录时，<strong>如果</strong>记录已经存在，则对记录进行<strong>选择性</strong>更新，否则直接插入。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO students (id, class_id, name, gender, score) VALUES (1, 1, &#39;小明&#39;, &#39;F&#39;, 99) ON DUPLICATE KEY UPDATE name&#x3D;&#39;小明&#39;, gender&#x3D;&#39;F&#39;, score&#x3D;99;</span><br></pre></td></tr></table></figure><h3 id="插入或忽略"><a href="#插入或忽略" class="headerlink" title="插入或忽略"></a>插入或忽略</h3><p>插入记录时，<strong>如果</strong>记录已经存在，则不进行任何操作，否则直接插入。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSERT IGNORE INTO students (id, class_id, name, gender, score) VALUES (1, 1, &#39;小明&#39;, &#39;F&#39;, 99);</span><br></pre></td></tr></table></figure><h3 id="快照"><a href="#快照" class="headerlink" title="快照"></a>快照</h3><p>进行数据复制并创建新表</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE students_of_class1 SELECT * FROM students WHERE class_id&#x3D;1;</span><br></pre></td></tr></table></figure><ul><li>新表的结构和原表<strong>一致</strong></li></ul><h3 id="写入查询结果集"><a href="#写入查询结果集" class="headerlink" title="写入查询结果集"></a>写入查询结果集</h3><p>建立成绩统计表</p><ul><li><p>创建存储结果集的表</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE statistics (</span><br><span class="line">id BIGINT NOT NULL AUTO_INCREMENT,</span><br><span class="line">    class_id BIGINT NOT NULL,</span><br><span class="line">    average DOUBLE NOT NULL,</span><br><span class="line">    PRIMARY KEY (id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure></li><li><p>写入各班平均成绩</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO statistics (class_id, average) SELECT class_id, AVG(acore) FROM students GROUP BY class_id;</span><br></pre></td></tr></table></figure></li></ul><h3 id="强制使用指定索引"><a href="#强制使用指定索引" class="headerlink" title="强制使用指定索引"></a>强制使用指定索引</h3><p>解决数据库查询的索引<strong>不是</strong>最优解的情况</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM students FORCE INDEX (idx_class_id) WHERE class_id&#x3D;1 ORDER BY id DESC;</span><br></pre></td></tr></table></figure><ul><li><code>idx_class_id</code>必须存在<strong>才能够</strong>使用强制索引</li></ul><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://www.liaoxuefeng.com/" target="_blank" rel="noopener">https://www.liaoxuefeng.com/</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;全文共&lt;code&gt;664&lt;/code&gt;字，推荐阅读时间&lt;code&gt;7~10&lt;/code&gt;分钟。&lt;/p&gt;
    
    </summary>
    
    
      <category term="Web" scheme="http://yoursite.com/categories/Web/"/>
    
      <category term="MySQL" scheme="http://yoursite.com/categories/MySQL/"/>
    
    
  </entry>
  
  <entry>
    <title>MySQL-Chapter3-修改数据</title>
    <link href="http://yoursite.com/2020/07/11/MySQL-Chapter3-%E4%BF%AE%E6%94%B9%E6%95%B0%E6%8D%AE/"/>
    <id>http://yoursite.com/2020/07/11/MySQL-Chapter3-%E4%BF%AE%E6%94%B9%E6%95%B0%E6%8D%AE/</id>
    <published>2020-07-11T07:32:26.252Z</published>
    <updated>2020-07-11T07:33:11.057Z</updated>
    
    <content type="html"><![CDATA[<p>全文共<code>298</code>字，推荐阅读时间<code>3~5</code>分钟。</p><a id="more"></a><ul><li>关系数据库的基本操作：增删查改（CRUD）<ul><li>C：Create</li><li>R：Retrieve</li><li>U：Update</li><li>D：Delete</li></ul></li></ul><h2 id="INSERT"><a href="#INSERT" class="headerlink" title="INSERT"></a>INSERT</h2><ul><li><p>基本语法</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-- INSERT INTO &lt;表名&gt; (字段1, 字段2, ...) VALUES (值1, 值2, ...);</span><br><span class="line">INSERT INTO students (class_id, name, gender, score) VALUES (2, &#39;xxx&#39;, &#39;M&#39;, 80);</span><br></pre></td></tr></table></figure><ul><li><p><strong>不需要</strong>列出<code>id</code>字段，这是一个由MySQL自己维护的自增字段。</p></li><li><p>语句中的字段顺序和表格中<strong>可以</strong>不一样，但是对应的值一定要按照<strong>语句中</strong>的顺序。</p></li><li><p>一次性添加多个记录</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO students (class_id, name, gender, score) VALUES</span><br><span class="line">(1, &#39;A&#39;, &#39;M&#39;, 97),</span><br><span class="line">(2, &#39;B&#39;, &#39;M&#39;, 81);</span><br></pre></td></tr></table></figure></li></ul></li></ul><h2 id="UPDATE"><a href="#UPDATE" class="headerlink" title="UPDATE"></a>UPDATE</h2><ul><li><p>基本语法</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-- UPDATE &lt;表名&gt; SET 字段1&#x3D;值1, 字段2&#x3D;值2, ... WHERE ...;</span><br><span class="line">UPDATE students SET name &#x3D; &#39;new_xxx&#39;, score&#x3D;66 WHERE id&#x3D;1;</span><br></pre></td></tr></table></figure><ul><li><p><code>WHERE</code>行为与<code>SELECT</code>中一致</p></li><li><p>更新多条记录（更改<code>WHERE</code>的判断条件）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UPDATE students SET name&#x3D;&#39;new_x&#39;, score&#x3D;77 WHERE id&gt;&#x3D;5 AND id&lt;&#x3D;7;</span><br></pre></td></tr></table></figure><ul><li>当没有匹配到记录时，<strong>不会</strong>报错。</li></ul></li><li><p>更新整个表（省略<code>WHERE</code>）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UPDATE students SET score&#x3D;60;</span><br></pre></td></tr></table></figure></li></ul></li></ul><h2 id="DELETE"><a href="#DELETE" class="headerlink" title="DELETE"></a>DELETE</h2><ul><li><p>基本语法</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-- DELETE FROM &lt;表名&gt; WHERE ...;</span><br><span class="line">DELETE FROM students WHERE id&#x3D;1;</span><br></pre></td></tr></table></figure><ul><li><p><code>id=2</code>的记录<code>id</code><strong>不会</strong>变化</p></li><li><p>删除整个表</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DELETE FROM students;</span><br></pre></td></tr></table></figure></li></ul></li></ul><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://www.liaoxuefeng.com/" target="_blank" rel="noopener">https://www.liaoxuefeng.com/</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;全文共&lt;code&gt;298&lt;/code&gt;字，推荐阅读时间&lt;code&gt;3~5&lt;/code&gt;分钟。&lt;/p&gt;
    
    </summary>
    
    
      <category term="Web" scheme="http://yoursite.com/categories/Web/"/>
    
      <category term="MySQL" scheme="http://yoursite.com/categories/MySQL/"/>
    
    
  </entry>
  
  <entry>
    <title>JavaScript-Chapter6-错误处理</title>
    <link href="http://yoursite.com/2020/07/11/JavaScript-Chapter6-%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86/"/>
    <id>http://yoursite.com/2020/07/11/JavaScript-Chapter6-%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86/</id>
    <published>2020-07-11T01:48:07.588Z</published>
    <updated>2020-07-11T01:49:01.890Z</updated>
    
    <content type="html"><![CDATA[<p>全文共<code>633</code>字，推荐阅读时间<code>7~10</code>分钟。</p><a id="more"></a><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><ul><li><p>错误类型</p><ul><li><p>程序逻辑</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> s = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">var</span> len = s.length;</span><br></pre></td></tr></table></figure><ul><li><code>null</code>对象访问<code>length</code>对象会出错</li></ul></li><li><p>无法预测</p><ul><li>网络中断</li><li>文件不存在</li><li>权限问题</li></ul></li></ul></li><li><p>处理机制</p><p>和Java类似，采用<code>try...catch...finally</code>机制</p><ul><li><code>catch</code>和<code>finally</code>都可以省略</li></ul></li><li><p>错误类型</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line"></span><br><span class="line">Error--&gt;TypeError</span><br><span class="line">Error--&gt;ReferenceError</span><br><span class="line">Error--&gt;...</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="keyword">if</span>(e <span class="keyword">instanceof</span> <span class="built_in">TypeError</span>) &#123;</span><br><span class="line">        alert(<span class="string">'Type error!'</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> <span class="built_in">Error</span>) &#123;</span><br><span class="line">        alert(e.message);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        alert(<span class="string">'Error: '</span> + e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>不同于Java，在JavaScript中只<code>catch</code><strong>一次</strong>，各个错误的分类处理通过<code>if</code>实现。</li></ul></li><li><p>抛出错误</p><p>和Java类似，使用<code>throw</code>语句。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> r, n, s;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    s = prompt(<span class="string">'Please input a number:'</span>);</span><br><span class="line">    n = <span class="built_in">parseInt</span>(s);</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">isNaN</span>(n)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Not a Number!'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125; <span class="keyword">catch</span>(e) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(e);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// output</span></span><br><span class="line"><span class="comment">// Error: Not a Number!</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="错误传播"><a href="#错误传播" class="headerlink" title="错误传播"></a>错误传播</h2><ul><li>和Java类似，JavaScript的错误会逐层向上抛出，直到<strong>第一个</strong><code>try...catch</code>语句。</li><li>抛出错误的方法<strong>不需要</strong>特殊声明<code>throws ...</code></li></ul><h2 id="异步错误处理"><a href="#异步错误处理" class="headerlink" title="异步错误处理"></a>异步错误处理</h2><p>异步代码无法确保在调用时捕获错误，因为在捕获有效时，回调函数可能并未执行。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">printTime</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    setTimeout(printTime, <span class="number">1000</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'done'</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'error'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>执行时<strong>不会</strong>触发<code>catch</code>语句</p></li><li><p>同理，对于事件处理，在<strong>绑定事件的代码处</strong>处理错误是没有效果的。</p><ul><li><p>以下js代码在输入错误时按键<strong>不会</strong>报错</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    $btn.click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span></span><br><span class="line">            x = <span class="built_in">parseFloat</span>($(<span class="string">'#x'</span>).val()),</span><br><span class="line">            y = <span class="built_in">parseFloat</span>($(<span class="string">'#y'</span>).val()),</span><br><span class="line">            r;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">isNaN</span>(x) || <span class="built_in">isNaN</span>(y)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'输入有误'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        r = x + y;</span><br><span class="line">        alert(<span class="string">'计算结果：'</span> + r);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    alert(<span class="string">'输入有误！'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>问题在于<code>try...catch</code>在按下按钮前已经执行完了，因此输入错误不能够找到对应的错误处理函数。</li></ul></li><li><p>修改后</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">cal</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span></span><br><span class="line">        x = <span class="built_in">parseFloat</span>($(<span class="string">'#x'</span>).val()),</span><br><span class="line">        y = <span class="built_in">parseFloat</span>($(<span class="string">'#y'</span>).val()),</span><br><span class="line">        r;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">isNaN</span>(x) || <span class="built_in">isNaN</span>(y)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'输入有误'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    r = x + y;</span><br><span class="line">    alert(<span class="string">'计算结果：'</span> + r);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">callCal</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        cal();  </span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        alert(<span class="string">'输入有误！'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$btn.click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        cal();  </span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        alert(<span class="string">'输入有误！'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ul><li><p>修改的要点：<code>click</code>绑定的函数在每次<code>click</code>时<strong>都会执行</strong>，所以错误处理逻辑需要封装进<code>click</code>绑定的函数。</p></li><li><p><code>click</code>的参数列表是<code>[ [ data ,]  handler ]</code></p><p>因此如果传入的参数是<strong>匿名函数</strong>即<code>function(xxx){...}</code>，此时<code>click</code>把参数解析为<code>handler</code>.但是如果传入的是一个封装好的函数，就会被识别成<code>data</code>.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$btn.click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        cal();  </span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        alert(<span class="string">'输入有误！'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// equals</span></span><br><span class="line">$btn.click(callCal, callCal);</span><br></pre></td></tr></table></figure><ul><li>第一个<code>callCal</code>是用来<strong>占位</strong>的</li></ul></li></ul></li></ul></li></ul><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://www.liaoxuefeng.com/" target="_blank" rel="noopener">https://www.liaoxuefeng.com/</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;全文共&lt;code&gt;633&lt;/code&gt;字，推荐阅读时间&lt;code&gt;7~10&lt;/code&gt;分钟。&lt;/p&gt;
    
    </summary>
    
    
      <category term="Web" scheme="http://yoursite.com/categories/Web/"/>
    
      <category term="JavaScript" scheme="http://yoursite.com/categories/JavaScript/"/>
    
    
  </entry>
  
  <entry>
    <title>JavaScript-Chapter5-jQuery</title>
    <link href="http://yoursite.com/2020/07/10/JavaScript-Chapter5-jQuery/"/>
    <id>http://yoursite.com/2020/07/10/JavaScript-Chapter5-jQuery/</id>
    <published>2020-07-10T12:46:08.201Z</published>
    <updated>2020-07-10T12:52:43.531Z</updated>
    
    <content type="html"><![CDATA[<p>全文共<code>5160</code>字，推荐阅读时间<code>30~45</code>分钟。</p><a id="more"></a><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><ul><li>消除浏览器差异</li><li>简化DOM操作</li><li>轻松实现动画、修改CSS等各种操作</li></ul><h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><ul><li><p>在页面的<code>&lt;head&gt;</code>引入jQuery文件即可</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"//code.jquery.com/jquery-1.11.3.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">...</span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p><code>$</code>符号</p><p>jQuery把所有的功能都封装在一个全局变量<code>jQuery</code>中，而<code>$</code>就是它的别名。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.jQuery; <span class="comment">// jQuery(selector, context)</span></span><br><span class="line"><span class="built_in">window</span>.$;</span><br><span class="line">$ === jQuery; <span class="comment">// true</span></span><br><span class="line"><span class="keyword">typeof</span>($); <span class="comment">// 'function'</span></span><br></pre></td></tr></table></figure><ul><li><p><code>$</code>本质上就是一个对象，可以是函数，<strong>也有</strong>其他属性。</p></li><li><p>当原有代码<strong>已经</strong>使用了<script type="math/tex">`这个变量时，需要让`jQuery`放弃`</script>，并且之后仅能使用<code>jQuery</code>变量。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$; <span class="comment">// jQuery(selector, context)</span></span><br><span class="line">jQuery.noConflict();</span><br><span class="line">$; <span class="comment">// undefined or old value</span></span><br><span class="line">jQuery; <span class="comment">// jQuery(selector, context)</span></span><br></pre></td></tr></table></figure><blockquote><p>原理是<code>jQuery</code>在占用<script type="math/tex">`之前会保存原有`</script>，当放弃<code>$</code>时会将原来保存的变量还原。</p></blockquote></li></ul></li></ul><h2 id="选择器"><a href="#选择器" class="headerlink" title="选择器"></a>选择器</h2><h3 id="概述-1"><a href="#概述-1" class="headerlink" title="概述"></a>概述</h3><p>选择器是jQuery的核心</p><ul><li><p>按<code>id</code>查找</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 查找&lt;div id="abc"&gt;:</span></span><br><span class="line"><span class="keyword">var</span> div = $(<span class="string">'#abc'</span>);</span><br></pre></td></tr></table></figure><ul><li><p>返回对象是jQuery对象，<strong>类似数组</strong>（但不是数组），每个元素都是一个DOM对象的引用。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"abc"</span>&gt;</span>...<span class="tag">&lt;/<span class="name">div</span>&gt;</span>]</span><br></pre></td></tr></table></figure><blockquote><p>选择器<strong>不会返回</strong><code>undefined</code>或者<code>null</code></p></blockquote></li><li><p>jQuery和DOM对象转化</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> div = $(<span class="string">'#abc'</span>); <span class="comment">// jQuery object</span></span><br><span class="line"><span class="keyword">var</span> divDom = div.get(<span class="number">0</span>); <span class="comment">// first DOM object</span></span><br><span class="line"><span class="keyword">var</span> another = $(divDom); <span class="comment">// DOM object -&gt; jQuery object</span></span><br></pre></td></tr></table></figure><ul><li>获取元素的value<ul><li>DOM:<code>xxx.value</code></li><li>jQuery:<code>xxx.get(xxx).value</code>/<code>xxx.val()</code></li></ul></li></ul><blockquote><p>通常<strong>直接使用</strong>jQuery对象更方便</p></blockquote></li></ul></li><li><p>按<code>tag</code>查找</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ps = $(<span class="string">'p'</span>); <span class="comment">// all &lt;p&gt; nodes</span></span><br><span class="line">ps.length; <span class="comment">// count of &lt;p&gt; nodes</span></span><br></pre></td></tr></table></figure></li><li><p>按<code>class</code>查找</p><ul><li>在<code>class</code>名称<strong>前</strong>加一个<code>.</code></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = $(<span class="string">'.red'</span>);</span><br></pre></td></tr></table></figure><ul><li>查找有<strong>多个</strong><code>class</code>的节点</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = $(<span class="string">'.red.green'</span>); <span class="comment">// no space between classnames</span></span><br></pre></td></tr></table></figure></li><li><p>按属性查找</p><ul><li>当属性的值包含<strong>空格</strong>等特殊字符时，需要使用双引号括起来。</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> email = $(<span class="string">'[name=email]'</span>); <span class="comment">// find &lt;??? name="email"&gt;</span></span><br><span class="line"><span class="keyword">var</span> passwordInput = $(<span class="string">'[type=password]'</span>); <span class="comment">// 找出&lt;??? type="password"&gt;</span></span><br><span class="line"><span class="keyword">var</span> a = $(<span class="string">'[items="A B"]'</span>); <span class="comment">// 找出&lt;??? items="A B"&gt;</span></span><br></pre></td></tr></table></figure><ul><li>可以使用前缀查找和后缀查找</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> icons = $(<span class="string">'[name^=icon]'</span>); <span class="comment">// 找出所有name属性值以icon开头的DOM</span></span><br><span class="line"><span class="comment">// 例如: name="icon-1", name="icon-2"</span></span><br><span class="line"><span class="keyword">var</span> names = $(<span class="string">'[name$=with]'</span>); <span class="comment">// 找出所有name属性值以with结尾的DOM</span></span><br><span class="line"><span class="comment">// 例如: name="startswith", name="endswith"</span></span><br></pre></td></tr></table></figure><ul><li>前后缀查找法<strong>不受</strong><code>class</code>个数的影响</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> icons = $(<span class="string">'[class^="icon-"]'</span>);</span><br><span class="line"><span class="comment">// 例如: class="icon-clock", class="abc icon-home"</span></span><br></pre></td></tr></table></figure></li><li><p>组合查找</p><p>解决查找结果混入表单外元素的情况，例如<code>$(&#39;[name=email]&#39;)</code>可能返回表单外的<code>&lt;div name=&quot;email&quot;&gt;</code>.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> emailInput = $(<span class="string">'input[name=email]'</span>); <span class="comment">// mix input and name</span></span><br><span class="line"><span class="keyword">var</span> tr = $(<span class="string">'tr.red'</span>); <span class="comment">// mix tag and class to find &lt;tr class = "red..."&gt;&lt;/tr&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>多项选择器</p><p>使用<code>,</code>组合多个选择器，结果取<strong>并集</strong>。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">'p,div'</span>); <span class="comment">// select all &lt;p&gt; and &lt;div&gt;</span></span><br><span class="line">$(<span class="string">'p.red,p.green'</span>); <span class="comment">// select all &lt;p class="red"&gt; and &lt;p class="green"&gt;</span></span><br></pre></td></tr></table></figure><ul><li>数组中的元素是按照他们在HTML中出现的顺序排列的，而且<strong>不会有重复</strong>元素。</li></ul></li></ul><h3 id="层级选择器"><a href="#层级选择器" class="headerlink" title="层级选择器"></a>层级选择器</h3><p>如果两个DOM元素具有层级关系，就可以用<code>$(&#39;ancestor descendant&#39;)</code>进行选择，层级之间使用<strong>空格</strong>隔开。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- HTML结构 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"testing"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"lang"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"lang-javascript"</span>&gt;</span>JavaScript<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"lang-python"</span>&gt;</span>Python<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"lang-lua"</span>&gt;</span>Lua<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>使用层级选择器选出JavaScript</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">'div.testing li.lang-javascript'</span>); <span class="comment">// &lt;li class="lang-javascript"&gt;javascript&lt;/li&gt;</span></span><br><span class="line">$(<span class="string">'ul.lang li.lang-javascript'</span>);</span><br></pre></td></tr></table></figure><ul><li><p>只要是<strong>祖先</strong>节点，<strong>都</strong>可以查找到对应的DOM子节点。</p></li><li><p>选择所有的<code>&lt;li&gt;</code>节点</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">'ul.lang li'</span>);</span><br></pre></td></tr></table></figure></li><li><p><strong>多层</strong>选择</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">'form.test p input'</span>); <span class="comment">// 在form表单选择被&lt;p&gt;包含的&lt;input&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h4 id="子选择器"><a href="#子选择器" class="headerlink" title="子选择器"></a>子选择器</h4><p><code>$(&#39;parent&gt;child&#39;)</code>类层级选择器，但是限定了两个元素必须是<strong>父子</strong>。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">'ul.lang&gt;li.lang-javascript'</span>); <span class="comment">// 可以选出[&lt;li class="lang-javascript"&gt;JavaScript&lt;/li&gt;]</span></span><br></pre></td></tr></table></figure><blockquote><p>使用<code>&lt;div.testing&gt;</code>当父节点则<strong>无法</strong>选出</p></blockquote><h4 id="过滤器"><a href="#过滤器" class="headerlink" title="过滤器"></a>过滤器</h4><p>通常使用<code>:</code>附加在选择器上</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">'ul.lang li'</span>); <span class="comment">// 选出JavaScript、Python和Lua 3个节点</span></span><br><span class="line"></span><br><span class="line">$(<span class="string">'ul.lang li:first-child'</span>); <span class="comment">// 仅选出JavaScript</span></span><br><span class="line">$(<span class="string">'ul.lang li:last-child'</span>); <span class="comment">// 仅选出Lua</span></span><br><span class="line">$(<span class="string">'ul.lang li:nth-child(2)'</span>); <span class="comment">// 选出第N个元素，N从1开始</span></span><br><span class="line">$(<span class="string">'ul.lang li:nth-child(even)'</span>); <span class="comment">// 选出序号为偶数的元素</span></span><br><span class="line">$(<span class="string">'ul.lang li:nth-child(odd)'</span>); <span class="comment">// 选出序号为奇数的元素</span></span><br></pre></td></tr></table></figure><h4 id="表单相关"><a href="#表单相关" class="headerlink" title="表单相关"></a>表单相关</h4><p>使用格式：<code>$(&#39;:input&#39;)</code>/<code>$(&#39;form :input&#39;)</code></p><ul><li><p><code>:input</code>：可以选择<code>&lt;input&gt;</code>/<code>&lt;textarea&gt;</code>/<code>&lt;select&gt;</code>/<code>&lt;button&gt;</code></p></li><li><p><code>:file</code>：可以选择<code>&lt;input type=&quot;file&quot;&gt;</code>，等价于<code>input[type=file]</code>.</p></li><li><p><code>:checkbox</code>：选择复选框，等价于<code>input[type=checkbox]</code>.</p></li><li><p><code>:radio</code>：选择单选框</p></li><li><p><code>:focus</code>：选择当前输入焦点的元素，即当前光标所在的<code>&lt;input&gt;</code></p></li><li><p><code>:checked</code>：选择<strong>当前勾上</strong>的单选框和复选框，等价于<code>$(&#39;input[type=radio]:checked&#39;)</code>.</p><blockquote><p>复选框<code>&lt;checkbox&gt;</code>同理，但是有时候复选框内是<code>&lt;option&gt;</code>，则需要使用</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">'option:checked'</span>).val();</span><br></pre></td></tr></table></figure></blockquote></li><li><p><code>:enabled</code>：正常的<code>&lt;input&gt;</code>/<code>&lt;select&gt;</code></p></li><li><p><code>:disabled</code>：选择不能输入的</p></li></ul><h4 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h4><ul><li><code>$(&#39;div:visible&#39;);</code>：选择所有可见的<code>&lt;div&gt;</code></li><li><code>$(&#39;div:hidden&#39;);</code>：选择所有隐藏的<code>&lt;div&gt;</code></li></ul><h3 id="查找和过滤"><a href="#查找和过滤" class="headerlink" title="查找和过滤"></a>查找和过滤</h3><h4 id="查找"><a href="#查找" class="headerlink" title="查找"></a>查找</h4><p>除了直接定位对象，还可以在拿到一个jQuery对象之后以它为基准进行查找。</p><ul><li><p><code>find()</code>：本身接收一个<strong>任意的选择器</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- HTML结构 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"lang"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"js dy"</span>&gt;</span>JavaScript<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"dy"</span>&gt;</span>Python<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">id</span>=<span class="string">"swift"</span>&gt;</span>Swift<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"dy"</span>&gt;</span>Scheme<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">name</span>=<span class="string">"haskell"</span>&gt;</span>Haskell<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ul = $(<span class="string">'ul.lang'</span>); <span class="comment">// 获得&lt;ul&gt;</span></span><br><span class="line"><span class="keyword">var</span> dy = ul.find(<span class="string">'.dy'</span>); <span class="comment">// 获得JavaScript, Python, Scheme</span></span><br><span class="line"><span class="keyword">var</span> swf = ul.find(<span class="string">'#swift'</span>); <span class="comment">// 获得Swift</span></span><br><span class="line"><span class="keyword">var</span> hsk = ul.find(<span class="string">'[name=haskell]'</span>); <span class="comment">// 获得Haskell</span></span><br></pre></td></tr></table></figure></li><li><p><code>parent()</code>：从当前节点<strong>向上</strong>查找</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> swf = $(<span class="string">'#swift'</span>); <span class="comment">// 获得Swift</span></span><br><span class="line"><span class="keyword">var</span> parent = swf.parent(); <span class="comment">// 获得Swift的上层节点&lt;ul&gt;</span></span><br><span class="line"><span class="keyword">var</span> a = swf.parent(<span class="string">'.red'</span>); <span class="comment">// 获得Swift的上层节点&lt;ul&gt;，同时传入过滤条件。如果ul不符合条件，返回空jQuery对象</span></span><br></pre></td></tr></table></figure></li><li><p><code>next()</code>/<code>prev()</code>：查找同一层级的节点</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> swift = $(<span class="string">'#swift'</span>);</span><br><span class="line"></span><br><span class="line">swift.next(); <span class="comment">// Scheme</span></span><br><span class="line">swift.next(<span class="string">'[name=haskell]'</span>); <span class="comment">// 空的jQuery对象，因为Swift的下一个元素Scheme不符合条件[name=haskell]</span></span><br><span class="line"></span><br><span class="line">swift.prev(); <span class="comment">// Python</span></span><br><span class="line">swift.prev(<span class="string">'.dy'</span>); <span class="comment">// Python，因为Python同时符合过滤器条件.dy</span></span><br></pre></td></tr></table></figure></li></ul><h4 id="过滤"><a href="#过滤" class="headerlink" title="过滤"></a>过滤</h4><p><code>filter()</code>可以<strong>过滤掉不符合</strong>选择器条件的节点</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> langs = $(<span class="string">'ul.lang li'</span>); <span class="comment">// 拿到JavaScript, Python, Swift, Scheme和Haskell</span></span><br><span class="line"><span class="keyword">var</span> a = langs.filter(<span class="string">'.dy'</span>); <span class="comment">// 拿到JavaScript, Python, Scheme</span></span><br></pre></td></tr></table></figure><ul><li><p>传入函数参数</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> langs = $(<span class="string">'ul.lang li'</span>); <span class="comment">// 拿到JavaScript, Python, Swift, Scheme和Haskell</span></span><br><span class="line">langs.filter(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.innerHTML.indexOf(<span class="string">'S'</span>) === <span class="number">0</span>; <span class="comment">// 返回S开头的节点</span></span><br><span class="line">&#125;); <span class="comment">// 拿到Swift, Scheme</span></span><br></pre></td></tr></table></figure><ul><li><p><code>this</code>被绑定为<code>DOM</code>对象，而<strong>不是</strong>jQuery对象。</p></li><li><p>使用<code>map</code>将jQuery数组进行转化</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> langs = $(<span class="string">'ul.lang li'</span>); <span class="comment">// 拿到JavaScript, Python, Swift, Scheme和Haskell</span></span><br><span class="line"><span class="keyword">var</span> arr = langs.map(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.innerHTML;</span><br><span class="line">&#125;).get(); <span class="comment">// 用get()拿到包含string的Array：['JavaScript', 'Python', 'Swift', 'Scheme', 'Haskell']</span></span><br></pre></td></tr></table></figure><ul><li><strong>不带参数</strong>的<code>get()</code>可以得到jQuery类数组中<strong>所有的</strong>DOM元素组成的数组</li></ul></li></ul></li><li><p>其他操作</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> langs = $(<span class="string">'ul.lang li'</span>); <span class="comment">// 拿到JavaScript, Python, Swift, Scheme和Haskell</span></span><br><span class="line"><span class="keyword">var</span> js = langs.first(); <span class="comment">// JavaScript，相当于$('ul.lang li:first-child')</span></span><br><span class="line"><span class="keyword">var</span> haskell = langs.last(); <span class="comment">// Haskell, 相当于$('ul.lang li:last-child')</span></span><br><span class="line"><span class="keyword">var</span> sub = langs.slice(<span class="number">2</span>, <span class="number">4</span>); <span class="comment">// Swift, Scheme, 参数和数组的slice()方法一致</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="操作DOM"><a href="#操作DOM" class="headerlink" title="操作DOM"></a>操作DOM</h2><h3 id="修改DOM节点"><a href="#修改DOM节点" class="headerlink" title="修改DOM节点"></a>修改DOM节点</h3><ul><li><p>修改Text和HTML</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- HTML结构 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">"test-ul"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"js"</span>&gt;</span>JavaScript<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">name</span>=<span class="string">"book"</span>&gt;</span>Java <span class="symbol">&amp;amp;</span> JavaScript<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">'#test-ul li[name=book]'</span>).text(); <span class="comment">// 'Java &amp; JavaScript'</span></span><br><span class="line">$(<span class="string">'#test-ul li[name=book]'</span>).html(); <span class="comment">// 'Java &amp;amp; JavaScript'</span></span><br></pre></td></tr></table></figure><ul><li><p>无参数调用<code>text()</code>/<code>html()</code>是获取文本，传入参数就变成<strong>设置</strong>文本。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">j1.html(<span class="string">'&lt;span style="color: red"&gt;JavaScript&lt;/span&gt;'</span>);</span><br><span class="line">j2.text(<span class="string">'JavaScript &amp; ECMAScript'</span>);</span><br></pre></td></tr></table></figure></li><li><p>对jQuery对象的修改会影响其中的<strong>所有</strong>DOM元素</p></li><li><p>当jQuery对象是<strong>空</strong>时尝试修改也<strong>不会报错</strong>（省略<code>if</code>判断）</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">'not-exist'</span>).text(<span class="string">'Hello'</span>);</span><br></pre></td></tr></table></figure></li></ul></li><li><p>修改CSS</p><p>利用jQuery<strong>批量修改</strong>的特点实现高亮显示</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- HTML结构 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">"test-css"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"lang dy"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>JavaScript<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"lang"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>Java<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"lang dy"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>Python<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"lang"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>Swift<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"lang dy"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>Scheme<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">'#test-css li.dy&gt;span'</span>).css(<span class="string">'background-color'</span>, <span class="string">'#ffd351'</span>).css(<span class="string">'color'</span>, <span class="string">'red'</span>);</span><br></pre></td></tr></table></figure><ul><li><p><code>css(&#39;name&#39;, &#39;value&#39;)</code>：作用于DOM节点的<code>style</code>属性，修改CSS样式表中对应域的值。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> div = $(<span class="string">'#test-div'</span>);</span><br><span class="line">div.css(<span class="string">'color'</span>); <span class="comment">// '#000033', 获取CSS属性</span></span><br><span class="line">div.css(<span class="string">'color'</span>, <span class="string">'#336699'</span>); <span class="comment">// 设置CSS属性</span></span><br><span class="line">div.css(<span class="string">'color'</span>, <span class="string">''</span>); <span class="comment">// 清除CSS属性</span></span><br></pre></td></tr></table></figure></li><li><p><code>background-color</code>和<code>backgroundColor</code>等价</p></li><li><p>修改DOM节点的<code>class</code>属性</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> div = $(<span class="string">'#test-div'</span>);</span><br><span class="line">div.hasClass(<span class="string">'highlight'</span>); <span class="comment">// false， class是否包含highlight</span></span><br><span class="line">div.addClass(<span class="string">'highlight'</span>); <span class="comment">// 添加highlight这个class</span></span><br><span class="line">div.removeClass(<span class="string">'highlight'</span>); <span class="comment">// 删除highlight这个class</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p>显示和隐藏DOM</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = $(<span class="string">'a[target=_blank]'</span>);</span><br><span class="line">a.hide(); <span class="comment">// 隐藏</span></span><br><span class="line">a.show(); <span class="comment">// 显示</span></span><br></pre></td></tr></table></figure><blockquote><p>显示和隐藏<strong>不改变</strong>原有的DOM树结构</p></blockquote></li><li><p>获取DOM信息</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 浏览器可视窗口大小:</span></span><br><span class="line">$(<span class="built_in">window</span>).width(); <span class="comment">// 800</span></span><br><span class="line">$(<span class="built_in">window</span>).height(); <span class="comment">// 600</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// HTML文档大小:</span></span><br><span class="line">$(<span class="built_in">document</span>).width(); <span class="comment">// 800</span></span><br><span class="line">$(<span class="built_in">document</span>).height(); <span class="comment">// 3500</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 某个div的大小:</span></span><br><span class="line"><span class="keyword">var</span> div = $(<span class="string">'#test-div'</span>);</span><br><span class="line">div.width(); <span class="comment">// 600</span></span><br><span class="line">div.height(); <span class="comment">// 300</span></span><br><span class="line">div.width(<span class="number">400</span>); <span class="comment">// 设置CSS属性 width: 400px，是否生效要看CSS是否有效</span></span><br><span class="line">div.height(<span class="string">'200px'</span>); <span class="comment">// 设置CSS属性 height: 200px，是否生效要看CSS是否有效</span></span><br></pre></td></tr></table></figure><ul><li><p><code>attr()</code>/<code>removeAttr()</code>常用于操作DOM节点的属性</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// &lt;div id="test-div" name="Test" start="1"&gt;...&lt;/div&gt;</span></span><br><span class="line"><span class="keyword">var</span> div = $(<span class="string">'#test-div'</span>);</span><br><span class="line">div.attr(<span class="string">'data'</span>); <span class="comment">// undefined, 属性不存在</span></span><br><span class="line">div.attr(<span class="string">'name'</span>); <span class="comment">// 'Test'</span></span><br><span class="line">div.attr(<span class="string">'name'</span>, <span class="string">'Hello'</span>); <span class="comment">// div的name属性变为'Hello'</span></span><br><span class="line">div.removeAttr(<span class="string">'name'</span>); <span class="comment">// 删除name属性</span></span><br><span class="line">div.attr(<span class="string">'name'</span>); <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure><ul><li><p><code>prop()</code>方法和<code>attr()</code>类似，但是在<code>checked</code>的处理上不同。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"test-radio"</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">name</span>=<span class="string">"test"</span> <span class="attr">checked</span> <span class="attr">value</span>=<span class="string">"1"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"test-radio"</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">name</span>=<span class="string">"test"</span> <span class="attr">checked</span>=<span class="string">"checked"</span> <span class="attr">value</span>=<span class="string">"1"</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li><p>两种<code>checked</code>的表示都是合法的</p></li><li><p>两个方法的返回值<strong>不同</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> radio = $(<span class="string">'#test-radio'</span>);</span><br><span class="line">radio.attr(<span class="string">'checked'</span>); <span class="comment">// 'checked'</span></span><br><span class="line">radio.prop(<span class="string">'checked'</span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure></li><li><p><strong>推荐</strong>使用<code>is()</code>判断</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> radio = $(<span class="string">'#test-radio'</span>);</span><br><span class="line">radio.is(<span class="string">':checked'</span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><blockquote><p>类似的<code>selected</code>使用<code>is(&#39;:selected&#39;)</code>处理</p></blockquote></li></ul></li></ul></li></ul></li><li><p>操作表单</p><p>jQuery对象统一使用<code>val()</code>方法<strong>获取和设置</strong>对应的<code>value</code>属性</p></li></ul><h3 id="修改DOM结构"><a href="#修改DOM结构" class="headerlink" title="修改DOM结构"></a>修改DOM结构</h3><ul><li><p>添加DOM</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"test-div"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>JavaScript<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>Python<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>Swift<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li><p>拿到节点</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ul = $(<span class="string">'#test-div&gt;ul'</span>);</span><br></pre></td></tr></table></figure></li><li><p>调用<code>append</code>传入<code>HTML</code>片段</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ul.append(<span class="string">'&lt;li&gt;&lt;span&gt;Haskell&lt;/span&gt;&lt;/li&gt;'</span>);</span><br></pre></td></tr></table></figure><ul><li><p><code>append</code>还可以传入其他对象</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建DOM对象:</span></span><br><span class="line"><span class="keyword">var</span> ps = <span class="built_in">document</span>.createElement(<span class="string">'li'</span>);</span><br><span class="line">ps.innerHTML = <span class="string">'&lt;span&gt;Pascal&lt;/span&gt;'</span>;</span><br><span class="line"><span class="comment">// 添加DOM对象:</span></span><br><span class="line">ul.append(ps);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加jQuery对象:</span></span><br><span class="line">ul.append($(<span class="string">'#scheme'</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加函数对象:</span></span><br><span class="line">ul.append(<span class="function"><span class="keyword">function</span> (<span class="params">index, html</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'&lt;li&gt;&lt;span&gt;Language - '</span> + index + <span class="string">'&lt;/span&gt;&lt;/li&gt;'</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ul><li>在添加函数对象时，要求返回一个字符串/DOM对象/jQuery对象。</li></ul></li><li><p><code>prepend</code>和<code>append</code>相对</p></li><li><p><strong>同级节点</strong>的插入可以使用<code>before()</code>/<code>after()</code>方法</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> js = $(<span class="string">'#test-div&gt;ul&gt;li:first-child'</span>);</span><br><span class="line">js.after(<span class="string">'&lt;li&gt;&lt;span&gt;Lua&lt;/span&gt;&lt;/li&gt;'</span>);</span><br></pre></td></tr></table></figure></li></ul></li></ul></li><li><p>删除节点</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> li = $(<span class="string">'#test-div&gt;ul&gt;li'</span>);</span><br><span class="line">li.remove(); <span class="comment">// delete all li DOM nodes</span></span><br></pre></td></tr></table></figure></li><li><p><code>innerText</code>&amp;<code>innerHTML</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">"demo"</span>&gt;</span>   This element has extra spacing     and contains <span class="tag">&lt;<span class="name">span</span>&gt;</span>a span element<span class="tag">&lt;/<span class="name">span</span>&gt;</span>.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> p = $(<span class="string">'#demo'</span>).get(<span class="number">0</span>);</span><br></pre></td></tr></table></figure><ul><li><p><code>p.innerText</code>：<code>&quot;This element has extra spacing and contains a span element.&quot;</code></p><p>返回忽略<strong>所有的tag和多余空格</strong>的字符串</p></li><li><p><code>p.innerHTML</code>：<code>&quot;  This element has extra spacing   and contains &lt;span&gt;a span element&lt;/span&gt;.&quot;</code></p><p>返回<strong>原样</strong>字符串</p></li><li><p><code>p.textContent</code>：<code>&quot;  This element has extra spacing  and contains a span element.&quot;</code></p><p>返回<strong>含有多余空格</strong>的字符串</p></li></ul></li></ul><h3 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h3><p>除了列出的3种语言外，请再添加Pascal、Lua和Ruby，然后按字母顺序排序节点：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- HTML结构 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"test-div"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>JavaScript<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>Python<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>Swift<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> </span><br><span class="line">    arr,</span><br><span class="line">    li,</span><br><span class="line">    ul = $(<span class="string">'#test-div ul'</span>);</span><br><span class="line"></span><br><span class="line">ul.append(<span class="string">'&lt;li&gt;&lt;span&gt;Pascal&lt;/span&gt;&lt;/li&gt;'</span>).append(<span class="string">'&lt;li&gt;&lt;span&gt;Lua&lt;/span&gt;&lt;/li&gt;'</span>).append(<span class="string">'&lt;li&gt;&lt;span&gt;Ruby&lt;/span&gt;&lt;/li&gt;'</span>);</span><br><span class="line">li = ul.find(<span class="string">'li'</span>);</span><br><span class="line">span = li.find(<span class="string">'span'</span>);</span><br><span class="line"></span><br><span class="line">span.each(<span class="function">(<span class="params">x, elem</span>) =&gt;</span> &#123;</span><br><span class="line">    arr.push(elem);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">arr.sort(<span class="function">(<span class="params">a, b</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (a.innerText &gt; b.innerText) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span>(a.innerText &lt; b.innerText) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">ul.empty();</span><br><span class="line">arr.forEach(<span class="function">(<span class="params">x</span>) =&gt;</span> &#123;</span><br><span class="line">    ul.append(<span class="string">'&lt;li&gt;&lt;span&gt;'</span>+ x.innerHTML +<span class="string">'&lt;/span&gt;&lt;/li&gt;'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ul><li><p>jQuery元素的遍历：<code>each(index, elem)</code></p><blockquote><p>可以先转换为DOM后遍历</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xxx.get().forEach(elem, index, array);</span><br></pre></td></tr></table></figure></blockquote></li><li><p>数组的遍历<code>forEach(elem, index, array)</code>（和前者<strong>参数顺序</strong>区别）</p></li><li><p><code>sort</code>函数返回的<strong>不是</strong>布尔值，而是<code>-1 0 1</code>.</p></li><li><p>数据层次</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line"></span><br><span class="line">jQuery--&gt;DOM</span><br><span class="line">DOM--&gt;innerHTML&#x2F;innerText</span><br></pre></td></tr></table></figure></li></ul><h2 id="事件"><a href="#事件" class="headerlink" title="事件"></a>事件</h2><ul><li>页面加载后，一旦页面上默认执行的JS代码被执行完之后，就只能依赖触发事件来执行JS代码。</li></ul><h3 id="鼠标事件"><a href="#鼠标事件" class="headerlink" title="鼠标事件"></a>鼠标事件</h3><ul><li>click：单击触发</li><li>dblclick：双击触发</li><li>mouseenter：鼠标进入触发</li><li>mouseleave：鼠标离开触发</li><li>mousemove：鼠标在DOM内移动触发</li><li>hover：相当于mouseenter加上mouseleave</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* HTML:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;a id="test-link" href="#0"&gt;点我试试&lt;/a&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取超链接的jQuery对象:</span></span><br><span class="line"><span class="keyword">var</span> a = $(<span class="string">'#test-link'</span>);</span><br><span class="line">a.on(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    alert(<span class="string">'Hello!'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ul><li><p>事件捕捉可以简化<strong>（推荐）</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a.click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">   alert(<span class="string">'Hello!'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li></ul><h3 id="键盘事件"><a href="#键盘事件" class="headerlink" title="键盘事件"></a>键盘事件</h3><p><strong>仅作用</strong>在当前焦点的DOM上，通常是<code>&lt;input&gt;</code>和<code>&lt;textarea&gt;</code>.</p><ul><li>keydown：键盘按下时触发</li><li>keyup：键盘松开时触发</li><li>keypress：按一次键后触发</li></ul><h3 id="其他事件"><a href="#其他事件" class="headerlink" title="其他事件"></a>其他事件</h3><ul><li><p>focus：当DOM获得焦点时触发</p></li><li><p>blur：当DOM失去焦点时触发</p></li><li><p>change：当<code>&lt;input&gt;</code>/<code>&lt;select&gt;</code>/<code>&lt;textarea&gt;</code>的内容改变时触发</p></li><li><p>submit：当<code>&lt;form&gt;</code>提交时触发</p></li><li><p>ready：当页面被载入并且DOM树<strong>完成初始化</strong>后触发</p><ul><li><p>仅作用于<code>document</code>对象</p></li><li><p>常用来约束初始化的先后顺序</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript">        <span class="comment">// 代码有误:</span></span></span><br><span class="line"><span class="javascript">        $(<span class="string">'#testForm'</span>).on(<span class="string">'submit'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="actionscript">            alert(<span class="string">'submit!'</span>);</span></span><br><span class="line">        &#125;);</span><br><span class="line"><span class="actionscript"><span class="comment">// correct:</span></span></span><br><span class="line"><span class="javascript">$(<span class="built_in">document</span>).on(<span class="string">'ready'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            $(<span class="string">'#testForm'</span>).on(<span class="string">'submit'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="actionscript">                alert(<span class="string">'submit!'</span>);</span></span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">"testForm"</span>&gt;</span></span><br><span class="line">        ...</span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li><p>不使用<code>ready</code>约束时，<code>testForm</code>表单还没有初始化，<code>submit</code>事件就发起了绑定请求，此时绑定不会成功。</p></li><li><p>使用<code>ready</code>和<code>submit</code>简化</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    $(<span class="string">'#testForm'</span>).submit(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        alert(<span class="string">'submit!'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li><li><p><strong>直接省略<code>ready</code></strong>（常用且推荐）</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    $(<span class="string">'#testForm'</span>).submit(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        alert(<span class="string">'submit!'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li></ul></li></ul></li></ul><h3 id="事件参数"><a href="#事件参数" class="headerlink" title="事件参数"></a>事件参数</h3><p>所有的事件都会传入<code>Event</code>对象作为参数，可以从<code>Event</code>对象上获取更多信息。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    $(<span class="string">'#testMouseMoveDiv'</span>).mousemove(<span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">    $(<span class="string">'#testMouseMoveSpan'</span>).text(<span class="string">'pageX = '</span> + e.pageX + <span class="string">', pageY = '</span> + e.pageY);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><blockquote><p>此时<code>e</code>就是一个<code>Event</code>对象</p></blockquote><h4 id="解除绑定"><a href="#解除绑定" class="headerlink" title="解除绑定"></a>解除绑定</h4><p>一个被绑定的事件可以解除绑定</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hello</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    alert(<span class="string">'hello!'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">a.click(hello);</span><br><span class="line"></span><br><span class="line">setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">a.off(<span class="string">'click'</span>, hello);</span><br><span class="line">&#125;, <span class="number">10000</span>);</span><br></pre></td></tr></table></figure><ul><li><p><code>off</code>中的函数参数必须和绑定的函数<strong>完全一致</strong>，也就是说在<code>click</code>绑定时就<strong>不能使用</strong>匿名函数。</p></li><li><p>一次性移除<code>click</code>事件绑定的所有函数</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a.off(<span class="string">'click'</span>);</span><br></pre></td></tr></table></figure></li><li><p>移除DOM绑定的所有函数</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a.off();</span><br></pre></td></tr></table></figure></li></ul><h4 id="事件触发条件"><a href="#事件触发条件" class="headerlink" title="事件触发条件"></a>事件触发条件</h4><p>事件的触发<strong>总是</strong>由用户决定的</p><ul><li><p>监控文本框改动</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> input = $(<span class="string">'#test-input'</span>);</span><br><span class="line">input.change(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'changed...'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ul><li><p>这个函数只会被<strong>用户</strong>输入触发，使用JS修改不会触发。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> input = $(<span class="string">'#test-input'</span>);</span><br><span class="line">input.val(<span class="string">'change it!'</span>); <span class="comment">// 无法触发change事件</span></span><br></pre></td></tr></table></figure><ul><li><p>特殊情况下，JS中无参数<code>change()</code>会触发。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> input = $(<span class="string">'#test-input'</span>);</span><br><span class="line">input.val(<span class="string">'change it!'</span>);</span><br><span class="line">input.change(); <span class="comment">// input.trigger('change');</span></span><br></pre></td></tr></table></figure></li></ul></li></ul></li></ul><h3 id="浏览器安全限制"><a href="#浏览器安全限制" class="headerlink" title="浏览器安全限制"></a>浏览器安全限制</h3><p>部分JS代码只能在<strong>用户触发</strong>下才能执行，例如<code>window.open()</code>函数。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 无法弹出新窗口，将被浏览器屏蔽:</span></span><br><span class="line">$(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">window</span>.open(<span class="string">'/'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> button1 = $(<span class="string">'#testPopupButton1'</span>);</span><br><span class="line"><span class="keyword">var</span> button2 = $(<span class="string">'#testPopupButton2'</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">popupTestWindow</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">window</span>.open(<span class="string">'/'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">button1.click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    popupTestWindow();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">button2.click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 不立刻执行popupTestWindow()，3秒后执行:</span></span><br><span class="line">    setTimeout(popupTestWindow, <span class="number">3000</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ul><li>对于<code>button1</code>，因为函数在事件中<strong>立即</strong>执行，因此可以成功。</li><li>对于<code>button2</code>，因为函数被<strong>延迟执行</strong>，当开始执行时<code>click</code>事件已经结束，故<strong>不会执行</strong>。（不同的浏览器行为存在差异，safari可以屏蔽，但是chrome存在打开情况）</li></ul><h3 id="例子-1"><a href="#例子-1" class="headerlink" title="例子"></a>例子</h3><p>对如下的Form表单：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- HTML结构 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">"test-form"</span> <span class="attr">action</span>=<span class="string">"test"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">legend</span>&gt;</span>请选择想要学习的编程语言：<span class="tag">&lt;/<span class="name">legend</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fieldset</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"selectAll"</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span>&gt;</span> <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"selectAll"</span>&gt;</span>全选<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">class</span>=<span class="string">"deselectAll"</span>&gt;</span>全不选<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">label</span>&gt;</span> <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#0"</span> <span class="attr">class</span>=<span class="string">"invertSelect"</span>&gt;</span>反选<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">name</span>=<span class="string">"lang"</span> <span class="attr">value</span>=<span class="string">"javascript"</span>&gt;</span> JavaScript<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">name</span>=<span class="string">"lang"</span> <span class="attr">value</span>=<span class="string">"python"</span>&gt;</span> Python<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">name</span>=<span class="string">"lang"</span> <span class="attr">value</span>=<span class="string">"ruby"</span>&gt;</span> Ruby<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">name</span>=<span class="string">"lang"</span> <span class="attr">value</span>=<span class="string">"haskell"</span>&gt;</span> Haskell<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">name</span>=<span class="string">"lang"</span> <span class="attr">value</span>=<span class="string">"scheme"</span>&gt;</span> Scheme<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"submit"</span>&gt;</span>Submit<span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">fieldset</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><p>绑定合适的事件处理函数，实现以下逻辑：</p><ul><li>当用户勾上“全选”时，自动选中所有语言，并把“全选”变成“全不选”；</li><li>当用户去掉“全不选”时，自动不选中所有语言；</li><li>当用户点击“反选”时，自动把所有语言状态反转（选中的变为未选，未选的变为选中）；</li><li>当用户把所有语言都手动勾上时，“全选”被自动勾上，并变为“全不选”；</li><li>当用户手动去掉选中至少一种语言时，“全不选”自动被去掉选中，并变为“全选”。</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span></span><br><span class="line">    form = $(<span class="string">'#test-form'</span>),</span><br><span class="line">    langs = form.find(<span class="string">'[name=lang]'</span>),</span><br><span class="line">    selectAll = form.find(<span class="string">'label.selectAll :checkbox'</span>),</span><br><span class="line">    selectAllLabel = form.find(<span class="string">'label.selectAll span.selectAll'</span>),</span><br><span class="line">    deselectAllLabel = form.find(<span class="string">'label.selectAll span.deselectAll'</span>),</span><br><span class="line">    invertSelect = form.find(<span class="string">'a.invertSelect'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 重置初始化状态:</span></span><br><span class="line">form.find(<span class="string">'*'</span>).show().off();</span><br><span class="line">form.find(<span class="string">':checkbox'</span>).prop(<span class="string">'checked'</span>, <span class="literal">false</span>).off();</span><br><span class="line">deselectAllLabel.hide();</span><br><span class="line"><span class="comment">// 拦截form提交事件:</span></span><br><span class="line">form.off().submit(<span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">    e.preventDefault();</span><br><span class="line">    alert(form.serialize());</span><br><span class="line">&#125;);</span><br><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span></span><br><span class="line">    form = $(<span class="string">'#test-form'</span>),</span><br><span class="line">    langs = form.find(<span class="string">'[name=lang]'</span>),</span><br><span class="line">    selectAll = form.find(<span class="string">'label.selectAll :checkbox'</span>),</span><br><span class="line">    selectAllLabel = form.find(<span class="string">'label.selectAll span.selectAll'</span>),</span><br><span class="line">    deselectAllLabel = form.find(<span class="string">'label.selectAll span.deselectAll'</span>),</span><br><span class="line">    invertSelect = form.find(<span class="string">'a.invertSelect'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 重置初始化状态:</span></span><br><span class="line">form.find(<span class="string">'*'</span>).show().off();</span><br><span class="line">form.find(<span class="string">':checkbox'</span>).prop(<span class="string">'checked'</span>, <span class="literal">false</span>).off();</span><br><span class="line">deselectAllLabel.hide();</span><br><span class="line"><span class="comment">// 拦截form提交事件:</span></span><br><span class="line">form.off().submit(<span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">    e.preventDefault();</span><br><span class="line">    alert(form.serialize());</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setAll</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (selectAll.prop(<span class="string">'checked'</span>)) &#123;</span><br><span class="line">        selectAllLabel.hide();</span><br><span class="line">        deselectAllLabel.show();</span><br><span class="line">        langs.prop(<span class="string">'checked'</span>, <span class="literal">true</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        langs.prop(<span class="string">'checked'</span>, <span class="literal">false</span>);</span><br><span class="line">        deselectAllLabel.hide();</span><br><span class="line">        selectAllLabel.show();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">selectAll.change(setAll);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">invertSet</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    langs.get().forEach(<span class="function">(<span class="params">elem</span>) =&gt;</span> elem.checked = !elem.checked);</span><br><span class="line">    <span class="comment">// langs.each((i, elem) =&gt; &#123;elem.checked = !elem.checked&#125;);</span></span><br><span class="line">    checkAll();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">invertSelect.click(invertSet);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkAll</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> allLangs = langs.get().every(<span class="function">(<span class="params">x</span>) =&gt;</span> x.checked);</span><br><span class="line">    <span class="keyword">if</span> (allLangs) &#123;</span><br><span class="line">        selectAllLabel.hide();</span><br><span class="line">        deselectAllLabel.show();</span><br><span class="line">        selectAll.prop(<span class="string">'checked'</span>, <span class="literal">true</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        selectAllLabel.show();</span><br><span class="line">        deselectAllLabel.hide();</span><br><span class="line">        selectAll.prop(<span class="string">'checked'</span>, <span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">langs.change(checkAll);</span><br></pre></td></tr></table></figure><ul><li>在使用箭头函数时，就算<strong>只有一条语句</strong>也最好加上<code>{}</code>，否则<code>each</code>会有异常。</li></ul><h2 id="动画"><a href="#动画" class="headerlink" title="动画"></a>动画</h2><p>原理：以固定的时间间隔（如0.1s），每次把DOM元素的CSS样式修改一点，看起来就像动画了。</p><h3 id="show-hide"><a href="#show-hide" class="headerlink" title="show/hide"></a>show/hide</h3><p>调用<code>show()</code>和<code>hide()</code>时传进一个参数，就变成了动画。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> div = $(<span class="string">'#test-show-hide'</span>);</span><br><span class="line">div.hide(<span class="number">3000</span>); <span class="comment">// 3000ms</span></span><br><span class="line">div.show(<span class="string">'slow'</span>); <span class="comment">// 600ms</span></span><br></pre></td></tr></table></figure><ul><li><code>toggle</code>根据当前状态取反决定<code>show</code>还是<code>hide</code></li><li>动画都从<strong>左上角</strong>展开/收缩的</li></ul><h3 id="slideUp-slideDown"><a href="#slideUp-slideDown" class="headerlink" title="slideUp/slideDown"></a>slideUp/slideDown</h3><ul><li>动画像卷帘一样（上下）</li><li>一样有<code>slideToggle()</code>函数</li></ul><h3 id="fadeIn-fadeOut"><a href="#fadeIn-fadeOut" class="headerlink" title="fadeIn/fadeOut"></a>fadeIn/fadeOut</h3><ul><li>动画效果是<strong>原地淡入淡出</strong>（原理是设置<code>opacity</code>属性）</li><li>一样有<code>fadeToggle()</code>函数</li></ul><h3 id="自定义动画"><a href="#自定义动画" class="headerlink" title="自定义动画"></a>自定义动画</h3><ul><li><p>通过<code>animate()</code>实现</p><p>参数是DOM元素<strong>最终的</strong>CSS状态和时间</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> div = $(<span class="string">'#test-animate'</span>);</span><br><span class="line">div.animate(&#123;</span><br><span class="line">    opacity: <span class="number">0.25</span>,</span><br><span class="line">    width: <span class="string">'256px'</span>,</span><br><span class="line">    height: <span class="string">'256px'</span></span><br><span class="line">&#125;, <span class="number">3000</span>);</span><br></pre></td></tr></table></figure><ul><li><p>传入函数参数作为<strong>回调</strong>函数</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> div = $(<span class="string">'#test-animate'</span>);</span><br><span class="line">div.animate(&#123;</span><br><span class="line">    opacity: <span class="number">0.25</span>,</span><br><span class="line">    width: <span class="string">'256px'</span>,</span><br><span class="line">    height: <span class="string">'256px'</span></span><br><span class="line">&#125;, <span class="number">3000</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"end of cartoon."</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li></ul></li></ul><h3 id="串行动画"><a href="#串行动画" class="headerlink" title="串行动画"></a>串行动画</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> div = $(<span class="string">'#test-animates'</span>);</span><br><span class="line"><span class="comment">// 动画效果：slideDown - 暂停 - 放大 - 暂停 - 缩小</span></span><br><span class="line">div.slideDown(<span class="number">2000</span>)</span><br><span class="line">   .delay(<span class="number">1000</span>)</span><br><span class="line">   .animate(&#123;</span><br><span class="line">       width: <span class="string">'256px'</span>,</span><br><span class="line">       height: <span class="string">'256px'</span></span><br><span class="line">   &#125;, <span class="number">2000</span>)</span><br><span class="line">   .delay(<span class="number">1000</span>)</span><br><span class="line">   .animate(&#123;</span><br><span class="line">       width: <span class="string">'128px'</span>,</span><br><span class="line">       height: <span class="string">'128px'</span></span><br><span class="line">   &#125;, <span class="number">2000</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="AJAX"><a href="#AJAX" class="headerlink" title="AJAX"></a>AJAX</h2><ul><li><p>全局对象<code>jQuery</code>绑定了<code>ajax()</code>函数</p></li><li><p><code>ajax(url, settings)</code>接收一个URL和可选的<code>settings</code>对象</p><ul><li>async：异步执行AJAX，<strong>默认</strong>为<code>true</code>.（最好<strong>不要修改</strong>）</li><li>method：<strong>缺省</strong>为<code>&#39;GET&#39;</code>，可指定为<code>&#39;POST&#39;</code>/<code>&#39;PUT&#39;</code>.</li><li>contentType：发送POST请求所使用的格式</li><li>data：发送的数据，字符串/数组/object.</li><li>headers：发送额外的HTTP头，必须是一个object.</li><li>dataType：接收得数据格式，可以指定为html/xml/json/text.</li></ul></li><li><p>下例发送一个<code>GET</code>请求，并返回一个<code>JSON</code>格式的数据。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> jqxhr = $.ajax(<span class="string">'xxx'</span>, &#123;</span><br><span class="line">    dataType: <span class="string">'json'</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li><li><p>使用链式写法模拟回调函数</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ajaxLog</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> txt = $(<span class="string">'#test-response-text'</span>);</span><br><span class="line">    txt.val(txt.val() + <span class="string">'\n'</span> + s);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$(<span class="string">'#test-response-text'</span>).val(<span class="string">''</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> jqxhr = $.ajax(<span class="string">'/api/categories'</span>, &#123;</span><br><span class="line">    dataType: <span class="string">'json'</span></span><br><span class="line">&#125;).done(<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">    ajaxLog(<span class="string">'成功, 收到的数据: '</span> + <span class="built_in">JSON</span>.stringify(data));</span><br><span class="line">&#125;).fail(<span class="function"><span class="keyword">function</span> (<span class="params">xhr, status</span>) </span>&#123;</span><br><span class="line">    ajaxLog(<span class="string">'失败: '</span> + xhr.status + <span class="string">', 原因: '</span> + status);</span><br><span class="line">&#125;).always(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    ajaxLog(<span class="string">'请求完成: 无论成功或失败都会调用'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li></ul><h3 id="get"><a href="#get" class="headerlink" title="get"></a>get</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> jqxhr = $.<span class="keyword">get</span>('xxx', &#123;</span><br><span class="line">    name: <span class="string">'Bob Lee'</span>,</span><br><span class="line">    check: <span class="number">1</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ul><li>第二个参数是对象时，会自动变成query string追加到url后面，不需要手动编码。</li></ul><h3 id="post"><a href="#post" class="headerlink" title="post"></a>post</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> jqxhr = $.post(<span class="string">'xxx'</span>, &#123;</span><br><span class="line">    name: <span class="string">'Bob Lee'</span>,</span><br><span class="line">    check: <span class="number">1</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ul><li>和<code>get</code>类似，只是第二个参数（对象）序列化方式不同。</li></ul><h3 id="getJSON"><a href="#getJSON" class="headerlink" title="getJSON"></a>getJSON</h3><p>用于快速获取一个JSON对象</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> jqxhr = $.getJSON(<span class="string">'xxx'</span>, &#123;</span><br><span class="line">    name: <span class="string">'Bob Lee'</span>,</span><br><span class="line">    check: <span class="number">1</span></span><br><span class="line">&#125;).done(<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// data is already in JSON format</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="安全限制"><a href="#安全限制" class="headerlink" title="安全限制"></a>安全限制</h3><p>和AJAX的安全限制一致</p><h2 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h2><p>通过扩展jQuery来实现自定义方法</p><h3 id="编写jQuery插件"><a href="#编写jQuery插件" class="headerlink" title="编写jQuery插件"></a>编写jQuery插件</h3><h4 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h4><ul><li>通过向<code>$.fn</code>绑定新对象实现</li><li>插件函数最后要<code>return this;</code></li><li>插件函数要有默认值，绑定在<code>$.fn.&lt;pluginName&gt;.defaults</code>对象上。</li><li>用户在调用时可以传入自定义值覆盖调用值</li></ul><h4 id="例子-2"><a href="#例子-2" class="headerlink" title="例子"></a>例子</h4><ul><li><p>新增高亮插件</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$.fn.highlight1 = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.css(<span class="string">'backgroundColor'</span>, <span class="string">'#fffceb'</span>).css(<span class="string">'color'</span>, <span class="string">'#d85030'</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p><code>this</code>在调用时被绑定为<strong>jQuery对象</strong>，所有的jQuery对象都可以<strong>直接调用</strong>（不需要<code>,fn</code>）该方法。</p></li><li><p><code>return this;</code>是为了支持jQuery的链式操作特征</p></li><li><p>验证</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"test-highlight1"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>什么是<span class="tag">&lt;<span class="name">span</span>&gt;</span>jQuery<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>jQuery<span class="tag">&lt;/<span class="name">span</span>&gt;</span>是目前最流行的<span class="tag">&lt;<span class="name">span</span>&gt;</span>JavaScript<span class="tag">&lt;/<span class="name">span</span>&gt;</span>库。<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">'#test-highlight1 span'</span>).highlight1();</span><br></pre></td></tr></table></figure></li></ul></li><li><p>改进高亮插件，增加颜色自定义。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$.fn.highlight2 = <span class="function"><span class="keyword">function</span> (<span class="params">options</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> bgcolor = options &amp;&amp; options.backgroundColor || <span class="string">'#fffceb'</span>;</span><br><span class="line">    <span class="keyword">var</span> color = options &amp;&amp; options.color || <span class="string">'#d85030'</span>;</span><br><span class="line">    <span class="keyword">this</span>.css(<span class="string">'backgroundColor'</span>, bgcolor).css(<span class="string">'color'</span>, color);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>注意过滤options本身及其属性为<code>undefined</code>的情况</p></li><li><p>验证</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- HTML结构 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"test-highlight2"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>什么是<span class="tag">&lt;<span class="name">span</span>&gt;</span>jQuery<span class="tag">&lt;/<span class="name">span</span>&gt;</span> <span class="tag">&lt;<span class="name">span</span>&gt;</span>Plugin<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>编写<span class="tag">&lt;<span class="name">span</span>&gt;</span>jQuery<span class="tag">&lt;/<span class="name">span</span>&gt;</span> <span class="tag">&lt;<span class="name">span</span>&gt;</span>Plugin<span class="tag">&lt;/<span class="name">span</span>&gt;</span>可以用来扩展<span class="tag">&lt;<span class="name">span</span>&gt;</span>jQuery<span class="tag">&lt;/<span class="name">span</span>&gt;</span>的功能。<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">'#test-highlight2 span'</span>).highlight2(&#123;</span><br><span class="line">    backgroundColor: <span class="string">'#00a8e6'</span>,</span><br><span class="line">    color: <span class="string">'#ffffff'</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li></ul></li><li><p>升级高亮插件，增加<strong>自定义缺省值</strong>操作。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$.fn.highlight = <span class="function"><span class="keyword">function</span> (<span class="params">options</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> opts = $.extend(&#123;&#125;, $.fn.highlight.defaults, options);</span><br><span class="line">    <span class="keyword">this</span>.css(<span class="string">'backgroundColor'</span>, opts.backgroundColor).css(<span class="string">'color'</span>, opts.color);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$.fn.highlight.defaults = &#123;</span><br><span class="line">    color: <span class="string">'#d85030'</span>,</span><br><span class="line">    backgroundColor: <span class="string">'#fff8de'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p><code>$.extend(target, obj1, obj2, ...)</code>：<strong>高级短路操作</strong>，将<code>target</code>之后的对象拆开，将其属性求并集加入<code>target</code>中。对于同名属性，<strong>位置越靠后优先级越高</strong>。</p></li><li><p>验证</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- HTML结构 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"test-highlight"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>如何编写<span class="tag">&lt;<span class="name">span</span>&gt;</span>jQuery<span class="tag">&lt;/<span class="name">span</span>&gt;</span> <span class="tag">&lt;<span class="name">span</span>&gt;</span>Plugin<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>编写<span class="tag">&lt;<span class="name">span</span>&gt;</span>jQuery<span class="tag">&lt;/<span class="name">span</span>&gt;</span> <span class="tag">&lt;<span class="name">span</span>&gt;</span>Plugin<span class="tag">&lt;/<span class="name">span</span>&gt;</span>，要设置<span class="tag">&lt;<span class="name">span</span>&gt;</span>默认值<span class="tag">&lt;/<span class="name">span</span>&gt;</span>，并允许用户修改<span class="tag">&lt;<span class="name">span</span>&gt;</span>默认值<span class="tag">&lt;/<span class="name">span</span>&gt;</span>，或者运行时传入<span class="tag">&lt;<span class="name">span</span>&gt;</span>其他值<span class="tag">&lt;/<span class="name">span</span>&gt;</span>。<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$.fn.highlight.defaults.color = <span class="string">'#659f13'</span>;</span><br><span class="line">$.fn.highlight.defaults.backgroundColor = <span class="string">'#f2fae3'</span>;</span><br><span class="line"></span><br><span class="line">$(<span class="string">'#test-highlight p:first-child span'</span>).highlight();</span><br><span class="line"></span><br><span class="line">$(<span class="string">'#test-highlight p:last-child span'</span>).highlight(&#123;</span><br><span class="line">    color: <span class="string">'#dd1144'</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li></ul></li></ul><h3 id="针对特定元素扩展"><a href="#针对特定元素扩展" class="headerlink" title="针对特定元素扩展"></a>针对特定元素扩展</h3><p>让插件只能在特定的DOM元素上使用</p><h4 id="例子-3"><a href="#例子-3" class="headerlink" title="例子"></a>例子</h4><p>为所有指向外链的超链接加上跳转提示</p><ul><li><p>用户调用代码</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">'#main a'</span>).external();</span><br></pre></td></tr></table></figure></li><li><p>编写<code>external</code>扩展</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$.fn.external = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// return返回的each()返回结果，支持链式调用:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.filter(<span class="string">'a'</span>).each(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 注意: each()内部的回调函数的this绑定为DOM本身!</span></span><br><span class="line">        <span class="keyword">var</span> a = $(<span class="keyword">this</span>);</span><br><span class="line">        <span class="keyword">var</span> url = a.attr(<span class="string">'href'</span>);</span><br><span class="line">        <span class="keyword">if</span>(url &amp;&amp; (url.indexOf(<span class="string">'https://'</span>) === <span class="number">0</span>) || url.indexOf(<span class="string">'https://'</span>) === <span class="number">0</span>) &#123;</span><br><span class="line">            a.attr(<span class="string">'href'</span>, <span class="string">"#0"</span>)</span><br><span class="line">             .removeAttr(<span class="string">'target'</span>)</span><br><span class="line">             .append(<span class="string">' &lt;i class="uk-icon-external-link"&gt;&lt;/i&gt;'</span>)</span><br><span class="line">             .click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                 <span class="keyword">if</span>(confirm(<span class="string">'sure to go to '</span> + url + <span class="string">'?'</span>)) &#123;</span><br><span class="line">                     <span class="built_in">window</span>.open(url);</span><br><span class="line">                 &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://www.liaoxuefeng.com/" target="_blank" rel="noopener">https://www.liaoxuefeng.com/</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;全文共&lt;code&gt;5160&lt;/code&gt;字，推荐阅读时间&lt;code&gt;30~45&lt;/code&gt;分钟。&lt;/p&gt;
    
    </summary>
    
    
      <category term="Web" scheme="http://yoursite.com/categories/Web/"/>
    
      <category term="JavaScript" scheme="http://yoursite.com/categories/JavaScript/"/>
    
    
  </entry>
  
  <entry>
    <title>JavaScript-Chapter4-浏览器对象</title>
    <link href="http://yoursite.com/2020/07/09/JavaScript-Chapter4-%E6%B5%8F%E8%A7%88%E5%99%A8%E5%AF%B9%E8%B1%A1/"/>
    <id>http://yoursite.com/2020/07/09/JavaScript-Chapter4-%E6%B5%8F%E8%A7%88%E5%99%A8%E5%AF%B9%E8%B1%A1/</id>
    <published>2020-07-09T13:24:15.666Z</published>
    <updated>2020-07-09T13:25:13.446Z</updated>
    
    <content type="html"><![CDATA[<p>全文共<code>4625</code>字，推荐阅读时间<code>30~45</code>分钟。</p><a id="more"></a><h2 id="浏览器对象"><a href="#浏览器对象" class="headerlink" title="浏览器对象"></a>浏览器对象</h2><h3 id="window"><a href="#window" class="headerlink" title="window"></a>window</h3><ul><li><p><code>window</code>对象不但是全局作用域变量，而且表示<strong>浏览器窗口</strong>。</p></li><li><p><code>window</code>对象有<code>innerWidth</code>和<code>innderHeight</code>属性，分别表示浏览器窗口<strong>内部宽度和高度</strong>。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">'window inner size: '</span> + <span class="built_in">window</span>.innerWidth + <span class="string">'*'</span> + <span class="built_in">window</span>.innerHeight);</span><br></pre></td></tr></table></figure><ul><li><p>内部宽高需要去掉菜单栏、工具栏、边框等占位元素。</p></li><li><p>对应的，还有一个<code>outerWidth</code>和<code>outerHeight</code>属性，可以获取浏览器窗口的整个宽高。</p></li></ul></li></ul><h3 id="navigator"><a href="#navigator" class="headerlink" title="navigator"></a>navigator</h3><p><code>navigator</code>表示浏览器的信息</p><ul><li><code>navigator.appName</code>：浏览器名称</li><li><code>navigator.appVersion</code>：浏览器版本</li><li><code>navigator.language</code>：浏览器设置的语言</li><li><code>navigator.platform</code>：操作系统类型</li><li><code>navigator.userAgent</code>：浏览器设定的<code>User-Agent</code>字符串</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">'appName = '</span> + navigator.appName);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'appVersion = '</span> + navigator.appVersion);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'language = '</span> + navigator.language);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'platform = '</span> + navigator.platform);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'userAgent = '</span> + navigator.userAgent);</span><br></pre></td></tr></table></figure><blockquote><ul><li><p><code>navigator</code>的属性<strong>可以</strong>被用户修改，所以读到的值不一定是实际值。</p><p>例如判断浏览器版本</p><ul><li><p>使用if语句</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> width;</span><br><span class="line"><span class="keyword">if</span> (getIEVersion(navigator.userAgent) &lt; <span class="number">9</span>) &#123;</span><br><span class="line">    width = <span class="built_in">document</span>.body.clientWidth;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    width = <span class="built_in">window</span>.innerWidth;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>当IE版本低于9时window没有<code>innerwidth</code>属性</p></blockquote></li><li><p>使用<code>undefined</code>的短路特性<strong>（推荐）</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> width = width.innerWidth || <span class="built_in">document</span>.body.clientWidth;</span><br></pre></td></tr></table></figure></li></ul></li></ul></blockquote><h3 id="screen"><a href="#screen" class="headerlink" title="screen"></a>screen</h3><p><code>screen</code>表示屏幕的信息</p><ul><li><code>screen.width</code>：屏幕宽度，以像素为单位。</li><li><code>screen.height</code>：屏幕高度</li><li><code>screen.colorDepth</code>：返回屏幕颜色位数</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">'Screen size = '</span> + screen.width + <span class="string">' x '</span> + screen.height);</span><br><span class="line"><span class="built_in">console</span>.log(screen.colorDepth);</span><br></pre></td></tr></table></figure><h3 id="location"><a href="#location" class="headerlink" title="location"></a>location</h3><p><code>location</code>表示<strong>当前页面</strong>的<code>URL</code>信息</p><ul><li><code>location.href</code>：完整的<code>URL</code></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">location.href; <span class="comment">// 'http://www.example.com:8080/path/index.html?a=1&amp;b=2#TOP'</span></span><br><span class="line">location.protocol; <span class="comment">// 'http'</span></span><br><span class="line">location.host; <span class="comment">// 'www.example.com'</span></span><br><span class="line">location.port; <span class="comment">// '8080'</span></span><br><span class="line">location.pathname; <span class="comment">// '/path/index.html'</span></span><br><span class="line">location.search; <span class="comment">// '?a=1&amp;b=2'</span></span><br><span class="line">location.hash; <span class="comment">// 'TOP'</span></span><br></pre></td></tr></table></figure><ul><li><code>location.assign()</code>：接受<strong>新</strong><code>path</code>作为参数，加载一个页面。</li><li><code>location.reload()</code>：<strong>重新</strong>加载当前页面</li></ul><h3 id="document"><a href="#document" class="headerlink" title="document"></a>document</h3><p><code>document</code>表示当前页面，由于HTML以<strong>DOM(Document Object Model)</strong>形式表现为树结构，因此<code>document</code>对象就是整个DOM树的根节点。</p><ul><li><p><code>document.title</code>：当前页面的标题，<strong>可以被用户动态改变</strong>。</p>  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="built_in">document</span>.title);</span><br><span class="line"><span class="built_in">document</span>.title = <span class="string">'努力学习JavaScript!'</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">document</span>.title);</span><br></pre></td></tr></table></figure></li><li><p><code>document.getElementById()</code>/<code>document.getElementsByTagName()</code>按照HTML的<code>id</code>获得一个DOM节点以及按<code>Tag</code>名称获取一组DOM节点</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dl</span> <span class="attr">id</span>=<span class="string">"drink-menu"</span> <span class="attr">style</span>=<span class="string">"border:solid 1px #ccc;padding:6px;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dt</span>&gt;</span>摩卡<span class="tag">&lt;/<span class="name">dt</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dd</span>&gt;</span>热摩卡咖啡<span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dt</span>&gt;</span>酸奶<span class="tag">&lt;/<span class="name">dt</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dd</span>&gt;</span>北京老酸奶<span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dt</span>&gt;</span>果汁<span class="tag">&lt;/<span class="name">dt</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dd</span>&gt;</span>鲜榨苹果汁<span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dl</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> menu = <span class="built_in">document</span>.getElementById(<span class="string">'drink-menu'</span>);</span><br><span class="line"><span class="keyword">var</span> drinks = <span class="built_in">document</span>.getElementsByTagName(<span class="string">'dt'</span>);</span><br><span class="line"><span class="keyword">var</span> i, s;</span><br><span class="line"></span><br><span class="line">s = <span class="string">'提供的饮料有:'</span>;</span><br><span class="line"><span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;drinks.length; i++) &#123;</span><br><span class="line">    s = s + drinks[i].innerHTML + <span class="string">','</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(s);</span><br></pre></td></tr></table></figure></li><li><p><code>document.cookie</code>：获取当前页面的<code>cookie</code>属性</p><blockquote><p>cookie的用途</p><ul><li><p>因为HTTP协议是无状态的，因此服务器使用cookie区分是哪个用户发来的请求。</p><p>当一个用户成功登录后，服务器发送一个cookie给浏览器，例如<code>user=ABC123XYZ</code>（加密字符串）。之后浏览器访问该网站时都会在<strong>请求头</strong>附上这个cookie.</p></li><li><p>因为JavaScript可以读取cookie，当引入恶意第三方代码时，就会造成信息泄露。为此，服务器设置cookie会加上<code>httpOnly</code>选项，此时JavaScript不能够读取cookie.</p></li></ul></blockquote></li></ul><h3 id="history"><a href="#history" class="headerlink" title="history"></a>history</h3><p><code>history</code>保存了浏览器的历史记录，<strong>是一个不应该继续使用的对象</strong>。</p><ul><li><code>history.back()</code>：相当于点了浏览器的后退按钮</li><li><code>history.forward()</code>：相当于点了浏览器的前进按钮</li></ul><h2 id="操作DOM"><a href="#操作DOM" class="headerlink" title="操作DOM"></a>操作DOM</h2><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p>HTML文件解析后是一棵DOM树，因此JavaScript操作DOM就可以改变HTML的结构。</p><ul><li><p>获取节点（所有的操作都是针对某个节点）</p><ul><li><code>document.getElementById()</code>：可以直接获取<strong>唯一一个</strong>节点</li><li><code>document.getElementsByTagName()</code></li><li><code>document.getElementByClassName()</code></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 返回ID为'test'的节点：</span></span><br><span class="line"><span class="keyword">var</span> test = <span class="built_in">document</span>.getElementById(<span class="string">'test'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 先定位ID为'test-table'的节点，再返回其内部所有tr节点：</span></span><br><span class="line"><span class="keyword">var</span> trs = <span class="built_in">document</span>.getElementById(<span class="string">'test-table'</span>).getElementsByTagName(<span class="string">'tr'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 先定位ID为'test-div'的节点，再返回其内部所有class包含red的节点：</span></span><br><span class="line"><span class="keyword">var</span> reds = <span class="built_in">document</span>.getElementById(<span class="string">'test-div'</span>).getElementsByClassName(<span class="string">'red'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取节点test下的所有直属子节点:</span></span><br><span class="line"><span class="keyword">var</span> cs = test.children;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取节点test下第一个、最后一个子节点：</span></span><br><span class="line"><span class="keyword">var</span> first = test.firstElementChild;</span><br><span class="line"><span class="keyword">var</span> last = test.lastElementChild;</span><br></pre></td></tr></table></figure><ul><li><p><code>querySelector()</code>/<code>querySelectorAll()</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 通过querySelector获取ID为q1的节点：</span></span><br><span class="line"><span class="keyword">var</span> q1 = <span class="built_in">document</span>.querySelector(<span class="string">'#q1'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过querySelectorAll获取q1节点内的符合条件的所有节点：</span></span><br><span class="line"><span class="keyword">var</span> ps = q1.querySelectorAll(<span class="string">'div.highlighted &gt; p'</span>);</span><br></pre></td></tr></table></figure><blockquote><p>低版本IE不支持</p></blockquote></li></ul></li><li><p>更新：更新DOM节点的内容，相当于更新DOM节点表示的HTML的内容。</p></li><li><p>遍历：遍历该DOM节点下的子节点</p></li><li><p>添加：在该DOM节点下新增一个子节点，相当于动态增加了一个HTML节点。</p></li><li><p>删除：将该节点从HTML删除，同时会删除它的子节点。</p></li></ul><blockquote><p>严格说，这里的DOM节点仅指<code>Element</code>，而不是<code>Node</code>.</p></blockquote><h4 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- HTML结构 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"test-div"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"c-red"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">"test-p"</span>&gt;</span>JavaScript<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>Java<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"c-red c-green"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>Python<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>Ruby<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>Swift<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"c-green"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>Scheme<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>Haskell<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 选择&lt;p&gt;JavaScript&lt;/p&gt;:</span></span><br><span class="line"><span class="keyword">var</span> js = <span class="built_in">document</span>.getElementById(<span class="string">'test-p'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 选择&lt;p&gt;Python&lt;/p&gt;,&lt;p&gt;Ruby&lt;/p&gt;,&lt;p&gt;Swift&lt;/p&gt;:</span></span><br><span class="line"><span class="keyword">var</span> arr = <span class="built_in">document</span>.getElementsByClassName(<span class="string">'c-red c-green'</span>)[<span class="number">0</span>].getElementsByTagName(<span class="string">'p'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(arr[<span class="number">0</span>].innerText);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 选择&lt;p&gt;Haskell&lt;/p&gt;:</span></span><br><span class="line"><span class="keyword">var</span> haskell = <span class="built_in">document</span>.getElementsByClassName(<span class="string">'c-green'</span>)[<span class="number">1</span>].getElementsByTagName(<span class="string">'p'</span>)[<span class="number">1</span>];</span><br><span class="line"><span class="built_in">console</span>.log(haskell.innerText);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 选择&lt;p&gt;JavaScript&lt;/p&gt;:</span></span><br><span class="line"><span class="keyword">var</span> js =  <span class="built_in">document</span>.querySelector(<span class="string">'#test-p'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 选择&lt;p&gt;Python&lt;/p&gt;,&lt;p&gt;Ruby&lt;/p&gt;,&lt;p&gt;Swift&lt;/p&gt;:</span></span><br><span class="line"><span class="keyword">var</span> arr = <span class="built_in">document</span>.getElementsByClassName(<span class="string">'c-red c-green'</span>)[<span class="number">0</span>].children;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 选择&lt;p&gt;Haskell&lt;/p&gt;:</span></span><br><span class="line"><span class="keyword">var</span> haskell = <span class="built_in">document</span>.getElementsByClassName(<span class="string">'c-green'</span>)[<span class="number">1</span>].lastElementChild;</span><br></pre></td></tr></table></figure><ul><li><code>getElementsByClassName</code>是<strong>部分匹配查找</strong></li><li>查找到的DOM节点需要使用<code>innerText</code>获取内容</li></ul><h3 id="更新DOM"><a href="#更新DOM" class="headerlink" title="更新DOM"></a>更新DOM</h3><ul><li><p>直接修改<code>innerHTML</code>属性</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取&lt;p id="p-id"&gt;...&lt;/p&gt;</span></span><br><span class="line"><span class="keyword">var</span> p = <span class="built_in">document</span>.getElementById(<span class="string">'p-id'</span>);</span><br><span class="line"><span class="comment">// 设置文本为abc:</span></span><br><span class="line">p.innerHTML = <span class="string">'ABC'</span>; <span class="comment">// &lt;p id="p-id"&gt;ABC&lt;/p&gt;</span></span><br><span class="line"><span class="comment">// 设置HTML:</span></span><br><span class="line">p.innerHTML = <span class="string">'ABC &lt;span style="color:red"&gt;RED&lt;/span&gt; XYZ'</span>;</span><br><span class="line"><span class="comment">// &lt;p&gt;...&lt;/p&gt;的内部结构已修改</span></span><br></pre></td></tr></table></figure><blockquote><p>直接修改<code>HTML</code>要小心<code>XSS</code>攻击</p></blockquote></li><li><p>修改<code>innerText</code>或<code>innerContent</code>属性</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取&lt;p id="p-id"&gt;...&lt;/p&gt;</span></span><br><span class="line"><span class="keyword">var</span> p = <span class="built_in">document</span>.getElementById(<span class="string">'p-id'</span>);</span><br><span class="line"><span class="comment">// 设置文本:</span></span><br><span class="line">p.innerText = <span class="string">'&lt;script&gt;alert("Hi")&lt;/script&gt;'</span>;</span><br><span class="line"><span class="comment">// HTML被自动编码，无法设置一个&lt;script&gt;节点:</span></span><br><span class="line"><span class="comment">// &lt;p id="p-id"&gt;&amp;lt;script&amp;gt;alert("Hi")&amp;lt;/script&amp;gt;&lt;/p&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>此时HTML会被自动编码，不会修改原有HTML.</p></blockquote><ul><li><code>innerText</code><strong>不返回</strong>隐藏元素的文本</li><li><code>textContent</code>返回所有文本（IE9前不支持）</li></ul></li><li><p>修改节点对应的CSS</p><p>修改节点的<code>style</code>属性</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取&lt;p id="p-id"&gt;...&lt;/p&gt;</span></span><br><span class="line"><span class="keyword">var</span> p = <span class="built_in">document</span>.getElementById(<span class="string">'p-id'</span>);</span><br><span class="line"><span class="comment">// 设置CSS:</span></span><br><span class="line">p.style.color = <span class="string">'#ff0000'</span>;</span><br><span class="line">p.style.fontSize = <span class="string">'20px'</span>; <span class="comment">// font-size in CSS</span></span><br><span class="line">p.style.paddingTop = <span class="string">'2em'</span>;</span><br></pre></td></tr></table></figure><blockquote><p>CSS中<code>font-size</code>这样的名称在JavaScript中需要变化为<strong>驼峰命名</strong>法</p></blockquote></li></ul><h3 id="插入DOM"><a href="#插入DOM" class="headerlink" title="插入DOM"></a>插入DOM</h3><ul><li><p>直接修改<code>innerHTML</code></p><p>仅仅适用于原节点内部是空的情况，例如<code>&lt;div&gt;&lt;/div&gt;</code>，否则会替换掉<strong>所有</strong>的子节点。</p></li><li><p><code>appendChild</code>：把一个子节点添加到父节点的最后一个子节点</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- HTML结构 Before --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">"js"</span>&gt;</span>JavaScript<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"list"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">"java"</span>&gt;</span>Java<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">"python"</span>&gt;</span>Python<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">"scheme"</span>&gt;</span>Scheme<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- HTML结构 After --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"list"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">"java"</span>&gt;</span>Java<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">"python"</span>&gt;</span>Python<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">"scheme"</span>&gt;</span>Scheme<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">"js"</span>&gt;</span>JavaScript<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span></span><br><span class="line">    js = <span class="built_in">document</span>.getElementById(<span class="string">'js'</span>),</span><br><span class="line">    list = <span class="built_in">document</span>.getElementById(<span class="string">'list'</span>);</span><br><span class="line">list.appendChild(js);</span><br></pre></td></tr></table></figure><ul><li><p>这个操作会先把原来的语句<strong>删除</strong>，然后在新的节点进行追加。</p></li><li><p>新建节点后再插入</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// &lt;p&gt;</span></span><br><span class="line"><span class="keyword">var</span></span><br><span class="line">    list = <span class="built_in">document</span>.getElementById(<span class="string">'list'</span>),</span><br><span class="line">    haskell = <span class="built_in">document</span>.createElement(<span class="string">'p'</span>); <span class="comment">// choose type of DOM point</span></span><br><span class="line">haskell.id = <span class="string">'haskell'</span>;</span><br><span class="line">haskell.innerText = <span class="string">'Haskell'</span>;</span><br><span class="line">list.appendChild(haskell);</span><br><span class="line"></span><br><span class="line"><span class="comment">// &lt;style&gt;</span></span><br><span class="line"><span class="keyword">var</span> d = <span class="built_in">document</span>.createElement(<span class="string">'style'</span>);</span><br><span class="line">d.setAttribute(<span class="string">'type'</span>, <span class="string">'text/css'</span>);</span><br><span class="line">d.innerHTML = <span class="string">'p &#123; color: red &#125;'</span>;</span><br><span class="line"><span class="built_in">document</span>.getElementsByTagName(<span class="string">'head'</span>)[<span class="number">0</span>].appendChild(d);</span><br></pre></td></tr></table></figure></li></ul></li><li><p><code>insertBefore</code>：把元素插在<strong>指定位置之前</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- HTML结构 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"list"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">"java"</span>&gt;</span>Java<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">"python"</span>&gt;</span>Python<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">"scheme"</span>&gt;</span>Scheme<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在python之前插入：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span></span><br><span class="line">    list = <span class="built_in">document</span>.getElementById(<span class="string">'list'</span>),</span><br><span class="line">    ref = <span class="built_in">document</span>.getElementById(<span class="string">'python'</span>),</span><br><span class="line">    haskell = <span class="built_in">document</span>.createElement(<span class="string">'p'</span>);</span><br><span class="line">haskell.id = <span class="string">'haskell'</span>;</span><br><span class="line">haskell.innerText = <span class="string">'Haskell'</span>;</span><br><span class="line">list.insertBefore(haskell, ref);</span><br></pre></td></tr></table></figure><ul><li><p>当<code>ref</code>节点不能够直接得到时，可以通过遍历子节点实现。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span></span><br><span class="line">i, c,</span><br><span class="line">    list = <span class="built_in">document</span>.getElementById(<span class="string">'list'</span>);</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; list.children.length; i++) &#123;</span><br><span class="line">    c = list.children[i];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li></ul><h4 id="例子-1"><a href="#例子-1" class="headerlink" title="例子"></a>例子</h4><p>按字符串顺序重新排序DOM节点</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- HTML结构 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ol</span> <span class="attr">id</span>=<span class="string">"test-list"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"lang"</span>&gt;</span>Scheme<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"lang"</span>&gt;</span>JavaScript<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"lang"</span>&gt;</span>Python<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"lang"</span>&gt;</span>Ruby<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"lang"</span>&gt;</span>Haskell<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ol</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// sort list:</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> list = <span class="built_in">document</span>.getElementsByClassName(<span class="string">"lang"</span>);</span><br><span class="line"><span class="keyword">var</span> arrList = <span class="built_in">Array</span>.from(list); <span class="comment">// transform Collection into Array</span></span><br><span class="line"></span><br><span class="line">arrList.sort(<span class="function">(<span class="params">x, y</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>( x.innerText.toLowerCase() &gt; y.innerText.toLowerCase() ) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (x.innerText.toLowerCase() &lt; y.innerText.toLowerCase()) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> testList = <span class="built_in">document</span>.getElementById(<span class="string">"test-list"</span>);</span><br><span class="line">testList.innerHTML = <span class="string">""</span>;</span><br><span class="line">arrList.forEach(<span class="function">(<span class="params">x</span>) =&gt;</span> testList.appendChild(x)); <span class="comment">// no need to create new elements</span></span><br></pre></td></tr></table></figure><h3 id="删除DOM"><a href="#删除DOM" class="headerlink" title="删除DOM"></a>删除DOM</h3><ul><li><p>找到待删除节点</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> self = <span class="built_in">document</span>.getElementById(<span class="string">'xxx'</span>);</span><br></pre></td></tr></table></figure></li><li><p>找到其<strong>父节点</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> parent = self.parentElement;</span><br></pre></td></tr></table></figure></li><li><p>删除（返回被删除元素）</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> removed = parent.removeChild(self);</span><br><span class="line">removed === self <span class="comment">// true</span></span><br></pre></td></tr></table></figure><blockquote><p>删除多个节点时，注意索引可能在发生变化。（可以使用<strong>倒序</strong>删除）</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> parent = <span class="built_in">document</span>.getElementById(<span class="string">'parent'</span>);</span><br><span class="line">parent.removeChild(parent.children[<span class="number">0</span>]);</span><br><span class="line">parent.removeChild(parent.children[<span class="number">1</span>]); <span class="comment">// &lt;-- 浏览器报错</span></span><br></pre></td></tr></table></figure></blockquote></li></ul><h2 id="操作表单"><a href="#操作表单" class="headerlink" title="操作表单"></a>操作表单</h2><p>因为表单本身也是DOM树，所以操作表单和操作DOM是类似的。不同的是，表单可以接收用户输入。</p><h3 id="输入控件"><a href="#输入控件" class="headerlink" title="输入控件"></a>输入控件</h3><ul><li><p>文本框：用于输入文本</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type = <span class="string">"text"</span>&gt;</span><br></pre></td></tr></table></figure></li><li><p>口令框：用于输入口令</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type = <span class="string">"password"</span>&gt;</span><br></pre></td></tr></table></figure></li><li><p>单选框：用于选择一项</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type = <span class="string">"radio"</span>&gt;</span><br></pre></td></tr></table></figure></li><li><p>复选框：用于选择多项</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type = <span class="string">"checkbox"</span>&gt;</span><br></pre></td></tr></table></figure></li><li><p>下拉框：用于选择一项</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;select&gt;</span><br></pre></td></tr></table></figure></li><li><p>隐藏文本：用户不可见，会把隐藏文本发送到服务器。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type = <span class="string">"hidden"</span>&gt;</span><br></pre></td></tr></table></figure></li></ul><h3 id="获取值"><a href="#获取值" class="headerlink" title="获取值"></a>获取值</h3><ul><li><p>如果有一个<code>&lt;input&gt;</code>节点的引用，其<code>value</code>属性即对应<strong>输入值</strong>。<strong>（不是<code>innerText</code>）</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// &lt;input type = "text" id = "email"&gt;</span></span><br><span class="line"><span class="keyword">var</span> input = <span class="built_in">document</span>.getElementById(<span class="string">'email'</span>);</span><br><span class="line">input.value;</span><br></pre></td></tr></table></figure><blockquote><p>对<code>text</code>/<code>password</code>/<code>hidden</code>/<code>select</code>均适用</p></blockquote></li><li><p>对于<strong>单选框和复选框</strong>，<code>value</code>属性的值永远是<strong>默认值</strong>，含有<strong>有效信息</strong>的是<code>checked</code>.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// &lt;label&gt;&lt;input type="radio" name="weekday" id="monday" value="1"&gt; Monday&lt;/label&gt;</span></span><br><span class="line"><span class="comment">// &lt;label&gt;&lt;input type="radio" name="weekday" id="tuesday" value="2"&gt; Tuesday&lt;/label&gt;</span></span><br><span class="line"><span class="keyword">var</span> mon = <span class="built_in">document</span>.getElementById(<span class="string">'monday'</span>);</span><br><span class="line"><span class="keyword">var</span> tue = <span class="built_in">document</span>.getElementById(<span class="string">'tuesday'</span>);</span><br><span class="line">mon.value; <span class="comment">// '1'</span></span><br><span class="line">tue.value; <span class="comment">// '2'</span></span><br><span class="line">mon.checked; <span class="comment">// true或者false</span></span><br><span class="line">tue.checked; <span class="comment">// true或者false</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="设置值"><a href="#设置值" class="headerlink" title="设置值"></a>设置值</h3><ul><li><p>对于<code>text</code>/<code>password</code>/<code>hidden</code>/<code>select</code>，直接设置<code>value</code>即可。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// &lt;input type="text" id="email"&gt;</span></span><br><span class="line"><span class="keyword">var</span> input = <span class="built_in">document</span>.getElementById(<span class="string">'email'</span>);</span><br><span class="line">input.value = <span class="string">'test@example.com'</span>; <span class="comment">// 文本框的内容已更新</span></span><br></pre></td></tr></table></figure></li><li><p>对于单选框和复选框，设置<code>checked</code>的布尔值即可。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// &lt;label&gt;&lt;input type = "radio" name = "weekday" id = "monday" value = "1"&gt; Monday &lt;/label&gt;</span></span><br><span class="line"><span class="keyword">var</span> mon = <span class="built_in">document</span>.getElementById(<span class="string">'monday'</span>);</span><br><span class="line">mon.checked = <span class="literal">true</span>;</span><br></pre></td></tr></table></figure></li></ul><h3 id="HTML5控件"><a href="#HTML5控件" class="headerlink" title="HTML5控件"></a>HTML5控件</h3><ul><li><p><code>date</code>：输入年月日</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type = <span class="string">"date"</span> value = <span class="string">"2020-07-09"</span>&gt;</span><br></pre></td></tr></table></figure></li><li><p><code>datetime-local</code>：精确到秒的本地时间</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type = <span class="string">"datetime-local"</span> value = <span class="string">"2020-07-09T14:49:49"</span>;</span><br></pre></td></tr></table></figure></li><li><p><code>color</code>：显示一个色块供颜色选择</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input<span class="built_in"> type </span>= <span class="string">"color"</span> value = <span class="string">""</span>#ff0000<span class="string">"&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="提交表单"><a href="#提交表单" class="headerlink" title="提交表单"></a>提交表单</h3><ul><li><p>通过AJAX实现</p></li><li><p>通过<code>&lt;form&gt;</code>元素的<code>submit()</code>方法提交</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span> = <span class="string">"test-form"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span> = <span class="string">"text"</span> <span class="attr">name</span> = <span class="string">"test"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span> = <span class="string">"button"</span> <span class="attr">onclick</span> = <span class="string">"doSubmitForm()"</span>&gt;</span>Submit<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript"><span class="function"><span class="keyword">function</span> <span class="title">doSubmitForm</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> form = <span class="built_in">document</span>.getElementById(<span class="string">'test-form'</span>);</span></span><br><span class="line"><span class="actionscript"><span class="comment">// modify form here</span></span></span><br><span class="line">    form.submit();</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>这种方式和浏览器默认的<code>&lt;button type = &quot;submit&quot;&gt;</code>重复</p></blockquote></li><li><p>响应<code>&lt;form&gt;</code>本身的<code>onsubmit</code>事件</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span> = <span class="string">"test-form"</span> <span class="attr">onsubmit</span> = <span class="string">"return checkForm()"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span> = <span class="string">"text"</span> <span class="attr">name</span> = <span class="string">"test"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span> = <span class="string">"submit"</span>&gt;</span>Submit<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript"><span class="function"><span class="keyword">function</span> <span class="title">checkForm</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> form = <span class="built_in">document</span>.getElementById(<span class="string">'test-form'</span>);</span></span><br><span class="line"><span class="actionscript">    <span class="comment">// modify form here</span></span></span><br><span class="line"><span class="actionscript">    <span class="keyword">return</span> <span class="literal">true</span>;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>返回<code>true</code>提醒浏览器继续提交</p></blockquote></li><li><p><code>hidden</code>元素的处理</p><p>在普通的密码输入表单中，提交表单时不输入明文口令，而是口令的MD5.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- HTML --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">"login-form"</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">onsubmit</span>=<span class="string">"return checkForm()"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"username"</span> <span class="attr">name</span>=<span class="string">"username"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">id</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"password"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"submit"</span>&gt;</span>Submit<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript"><span class="function"><span class="keyword">function</span> <span class="title">checkForm</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> pwd = <span class="built_in">document</span>.getElementById(<span class="string">'password'</span>);</span></span><br><span class="line"><span class="actionscript">    <span class="comment">// 把用户输入的明文变为MD5:</span></span></span><br><span class="line">    pwd.value = toMD5(pwd.value);</span><br><span class="line"><span class="actionscript">    <span class="comment">// 继续下一步:</span></span></span><br><span class="line"><span class="actionscript">    <span class="keyword">return</span> <span class="literal">true</span>;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>当执行<code>toMD5</code>时，会出现密码框的几个<code>*</code>突然变成32个<code>*</code>的情况。</p></blockquote><p>使用<code>hidden</code>把存储<code>MD5</code>密码的输入端隐藏起来，就可以不改变用户本来输入的<code>*</code>的位数。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- HTML --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">"login-form"</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">onsubmit</span>=<span class="string">"return checkForm()"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"username"</span> <span class="attr">name</span>=<span class="string">"username"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">id</span>=<span class="string">"input-password"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">id</span>=<span class="string">"md5-password"</span> <span class="attr">name</span>=<span class="string">"password"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"submit"</span>&gt;</span>Submit<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript"><span class="function"><span class="keyword">function</span> <span class="title">checkForm</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> input_pwd = <span class="built_in">document</span>.getElementById(<span class="string">'input-password'</span>);</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> md5_pwd = <span class="built_in">document</span>.getElementById(<span class="string">'md5-password'</span>);</span></span><br><span class="line"><span class="actionscript">    <span class="comment">// 把用户输入的明文变为MD5:</span></span></span><br><span class="line">    md5_pwd.value = toMD5(input_pwd.value);</span><br><span class="line"><span class="actionscript">    <span class="comment">// 继续下一步:</span></span></span><br><span class="line"><span class="actionscript">    <span class="keyword">return</span> <span class="literal">true</span>;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li><p><code>password</code>控件没有<code>name</code>属性，<strong>不会被</strong>上传。</p><blockquote><p>没有<code>name</code>的属性都不会被上传</p></blockquote></li><li><p>相当于用户输入<code>password</code>控件中，但是我们把处理的结果放在了<strong>被隐藏</strong>的<code>md5-password</code>中，<strong>而不是</strong>原来的<code>password</code>中，所以能够不影响用户本来的输入。</p></li></ul></li></ul><h2 id="操作文件"><a href="#操作文件" class="headerlink" title="操作文件"></a>操作文件</h2><h3 id="概述-1"><a href="#概述-1" class="headerlink" title="概述"></a>概述</h3><ul><li><p>在HTML表单中，上传文件的唯一控件是<code>&lt;input type = &quot;file&quot;&gt;</code></p><blockquote><p>当一个表单中含有该控件时，表单的<strong><code>enctype</code></strong>必须指定为<strong><code>multipart/form-data</code></strong>，<strong><code>method</code></strong>必须指定为<strong><code>post</code></strong>.</p></blockquote></li><li><p>JavaScript对控件的<code>value</code>修改不会造成影响，并且<strong>无法知道</strong>真实路径。</p></li><li><p>JavaScript可以在提交表单时对<strong>文件扩展名</strong>进行检查，防止无效文件。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> f = <span class="built_in">document</span>.getElementById(<span class="string">'xxx'</span>);</span><br><span class="line"><span class="keyword">var</span> filename = f.value;</span><br><span class="line"><span class="keyword">if</span> (!filename || !(filename.endsWith(<span class="string">'.jpg'</span>)) || filename.endsWith(<span class="string">'.png'</span>)) &#123;</span><br><span class="line">    alert(<span class="string">'Can only upload image file.'</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="File-API"><a href="#File-API" class="headerlink" title="File API"></a>File API</h3><p>HTML提供了<code>File</code>和<code>FileReader</code>两个主要对象，可以获取文件信息并读取文件。</p><ul><li><p>上传图片并解析</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span></span><br><span class="line">    fileInput = <span class="built_in">document</span>.getElementById(<span class="string">'test-image-file'</span>),</span><br><span class="line">    info = <span class="built_in">document</span>.getElementById(<span class="string">'test-file-info'</span>),</span><br><span class="line">    preview = <span class="built_in">document</span>.getElementById(<span class="string">'test-image-preview'</span>);</span><br><span class="line"><span class="comment">// 监听change事件:</span></span><br><span class="line">fileInput.addEventListener(<span class="string">'change'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 清除背景图片:</span></span><br><span class="line">    preview.style.backgroundImage = <span class="string">''</span>;</span><br><span class="line">    <span class="comment">// 检查文件是否选择:</span></span><br><span class="line">    <span class="keyword">if</span> (!fileInput.value) &#123;</span><br><span class="line">        info.innerHTML = <span class="string">'没有选择文件'</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 获取File引用:</span></span><br><span class="line">    <span class="keyword">var</span> file = fileInput.files[<span class="number">0</span>];</span><br><span class="line">    <span class="comment">// 获取File信息:</span></span><br><span class="line">    info.innerHTML = <span class="string">'文件: '</span> + file.name + <span class="string">'&lt;br&gt;'</span> +</span><br><span class="line">                     <span class="string">'大小: '</span> + file.size + <span class="string">'&lt;br&gt;'</span> +</span><br><span class="line">                     <span class="string">'修改: '</span> + file.lastModifiedDate;</span><br><span class="line">    <span class="keyword">if</span> (file.type !== <span class="string">'image/jpeg'</span> &amp;&amp; file.type !== <span class="string">'image/png'</span> &amp;&amp; file.type !== <span class="string">'image/gif'</span>) &#123;</span><br><span class="line">        alert(<span class="string">'不是有效的图片文件!'</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 读取文件:</span></span><br><span class="line">    <span class="keyword">var</span> reader = <span class="keyword">new</span> FileReader();</span><br><span class="line">    reader.onload = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span></span><br><span class="line">            data = e.target.result; <span class="comment">// 'data:image/jpeg;base64,/9j/4AAQSk...(base64编码)...'            </span></span><br><span class="line">        preview.style.backgroundImage = <span class="string">'url('</span> + data + <span class="string">')'</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">// 以DataURL的形式读取文件:</span></span><br><span class="line">    reader.readAsDataURL(file);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li></ul><h3 id="回调"><a href="#回调" class="headerlink" title="回调"></a>回调</h3><ul><li><p>JavaScript永远是<strong>单线程</strong>模式执行的，因此JavaScript的多任务都是<strong>异步</strong>调用。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reader.readAsDataURL(file);</span><br></pre></td></tr></table></figure><ul><li><p>发起一个<strong>异步操作</strong>读取文件内容，即原有JS代码<strong>继续</strong>执行。</p></li><li><p>因为是异步操作，所以不能确定什么时候操作结束。</p></li><li><p>增加一个<strong>回调函数</strong>解决上述问题</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">reader.onload = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// After reading file, this function will be called automatically.</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>所谓回调函数就是在异步操作结束后会自动执行的程序片段</p></blockquote></li></ul></li></ul><h2 id="AJAX"><a href="#AJAX" class="headerlink" title="AJAX"></a>AJAX</h2><h3 id="概述-2"><a href="#概述-2" class="headerlink" title="概述"></a>概述</h3><ul><li><p>Asynchronized JavaScript and XML, 使用JavaScript执行<strong>异步网络请求</strong>。</p></li><li><p>Web运作原理：一次HTTP请求对应一个页面</p><p>如果要让用户留在当前页面中，同时发出新的HTTP请求，就必须用JavaScript发送这个新请求，接收到数据后，再用JavaScript更新页面，这样一来，用户就感觉自己仍然停留在当前页面，但是数据却可以不断地更新。</p></li><li><p>通过AJAX发送请求</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">success</span>(<span class="params">text</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> textarea = <span class="built_in">document</span>.getElementById(<span class="string">'test-response-text'</span>);</span><br><span class="line">    textarea.value = text;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fail</span>(<span class="params">code</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> textarea = <span class="built_in">document</span>.getElementById(<span class="string">'test-response-text'</span>);</span><br><span class="line">    textarea.value = <span class="string">'Error code: '</span> + code;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> request = <span class="keyword">new</span> XMLHttpRequest(); <span class="comment">// 新建XMLHttpRequest对象</span></span><br><span class="line"></span><br><span class="line">request.onreadystatechange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="comment">// 状态发生变化时，函数被回调</span></span><br><span class="line">    <span class="keyword">if</span> (request.readyState === <span class="number">4</span>) &#123; <span class="comment">// 成功完成</span></span><br><span class="line">        <span class="comment">// 判断响应结果:</span></span><br><span class="line">        <span class="keyword">if</span> (request.status === <span class="number">200</span>) &#123;</span><br><span class="line">            <span class="comment">// 成功，通过responseText拿到响应的文本:</span></span><br><span class="line">            <span class="keyword">return</span> success(request.responseText);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 失败，根据响应码判断失败原因:</span></span><br><span class="line">            <span class="keyword">return</span> fail(request.status);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// HTTP请求还在继续...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 发送请求:</span></span><br><span class="line">request.open(<span class="string">'GET'</span>, <span class="string">'/api/categories'</span>);</span><br><span class="line">request.send();</span><br><span class="line"></span><br><span class="line">alert(<span class="string">'请求已发送，请等待响应...'</span>);</span><br></pre></td></tr></table></figure><ul><li><p>创建<code>XMLHttpRequest</code>对象</p><p>通过检测<code>window</code>对象有没有<code>XMLHttpRequest</code>属性来确定浏览器是否支持，不要通过<code>navigator.userAgent</code>判断。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> request;</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">window</span>.XMLHttpRequest) &#123;</span><br><span class="line">    request = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    request = <span class="keyword">new</span> ActiveXObject(<span class="string">'Microsoft.XMLHTTP'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>设置<code>onreadystatechange</code>回调函数</p><ul><li>通过<code>readyState === 4</code>判断请求是否完成</li><li>通过<code>status === 200</code>判断相应是否成功</li></ul></li><li><p>设置<code>open</code>请求参数</p><ul><li><p><code>GET</code>/<code>POST</code></p></li><li><p>URL地址<strong>（相对路径）</strong></p><blockquote><p>默认情况下，JavaScript在发送AJAX请求时，URL<strong>域名</strong>必须和当前页面完全一致）</p><ul><li>域名要相同（<code>www.example.com</code>和<code>example.com</code>不同）</li><li>协议要相同（<code>http</code>和<code>https</code>不同）</li><li>端口号要相同（默认是<code>:80</code>）</li></ul></blockquote></li><li><p>操作是否异步，默认为<code>true</code>（异步）。</p></li></ul></li><li><p>使用<code>send</code>发送请求</p><ul><li><code>GET</code>请求不需要参数</li><li><code>POST</code>请求需要把body部分以字符串或者<code>FormDate</code>对象传进去</li></ul></li></ul></li></ul><h3 id="安全限制"><a href="#安全限制" class="headerlink" title="安全限制"></a>安全限制</h3><p>JavaScript访问外域网站</p><ul><li><p>通过Flash（不推荐）</p></li><li><p>通过在同源域名下架设一个代理服务器来转发，JavaScript可以把请求发送到代理服务器。</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">'<span class="string">/proxy</span>?url=http:<span class="string">//www.sina.com.cn</span>'</span><br></pre></td></tr></table></figure><ul><li>代理服务器把结果返回，这样就遵循了浏览器的同源策略。</li></ul></li><li><p>JSONP</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"http://example.com/abc.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">...</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>只能用<code>GET</code>请求，并且要求返回JavaScript</li></ul><p>获取股票指数</p><ul><li><p>创建回调函数</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">refreshPrice</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> p = <span class="built_in">document</span>.getElementById(<span class="string">'test-jsonp'</span>);</span><br><span class="line">    p.innerHTML = <span class="string">'当前价格：'</span> +</span><br><span class="line">        data[<span class="string">'0000001'</span>].name +<span class="string">': '</span> + </span><br><span class="line">        data[<span class="string">'0000001'</span>].price + <span class="string">'；'</span> +</span><br><span class="line">        data[<span class="string">'1399001'</span>].name + <span class="string">': '</span> +</span><br><span class="line">        data[<span class="string">'1399001'</span>].price;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>触发请求</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getPrice</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span></span><br><span class="line">        js = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>),</span><br><span class="line">        head = <span class="built_in">document</span>.getElementsByTagName(<span class="string">'head'</span>)[<span class="number">0</span>];</span><br><span class="line">    js.src = <span class="string">'http://api.money.126.net/data/feed/0000001,1399001?callback=refreshPrice'</span>;</span><br><span class="line">    head.appendChild(js);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>CORS(HTML5推荐)：Cross-Origin Resource Sharing</p><p>跨域是否成功取决于：对方服务器是否为当前域请求设置一个正确的<code>Access-Control-Allow-Origin</code>.</p></li></ul><h2 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h2><p>“承诺在将来会执行”的对象被称为<code>Promise</code>对象</p><h3 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h3><p>生成一个0-2之间的随机数，如果小于1，则等待一段时间后返回成功，否则返回失败。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> timeOut = <span class="built_in">Math</span>.random() * <span class="number">2</span>;</span><br><span class="line">    log(<span class="string">'set timeout to: '</span> + timeOut + <span class="string">' seconds.'</span>);</span><br><span class="line">    setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (timeOut &lt; <span class="number">1</span>) &#123;</span><br><span class="line">            log(<span class="string">'call resolve()...'</span>);</span><br><span class="line">            resolve(<span class="string">'200 OK'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            log(<span class="string">'call reject()...'</span>);</span><br><span class="line">            reject(<span class="string">'timeout in '</span> + timeOut + <span class="string">' seconds.'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, timeOut * <span class="number">1000</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p1 = <span class="keyword">new</span> <span class="built_in">Promise</span>(test);</span><br><span class="line"><span class="keyword">var</span> p2 = p1.then(<span class="function"><span class="keyword">function</span> (<span class="params">result</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'成功：'</span> + result);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">var</span> p3 = p2.catch(<span class="function"><span class="keyword">function</span> (<span class="params">reason</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'失败：'</span> + reason);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ul><li><p><code>p1</code>是一个<code>Promise</code>对象，它负责执行<code>test</code>函数。由于<code>test</code>函数在内部是异步执行的，当<code>test</code>函数执行成功时，执行</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">p1.then(<span class="function"><span class="keyword">function</span> (<span class="params">result</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'成功：'</span> + result);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>当执行失败时</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">p2.catch(<span class="function"><span class="keyword">function</span> (<span class="params">reason</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'失败：'</span> + reason);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li><li><p><code>Promise</code>对象可以串联起来进行代码简化</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(test).then(<span class="function"><span class="keyword">function</span> (<span class="params">result</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'成功：'</span> + result);</span><br><span class="line">&#125;).catch(<span class="function"><span class="keyword">function</span> (<span class="params">reason</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'失败：'</span> + reason);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p><code>Promise</code>可以按顺序执行若干个<strong>异步任务</strong>（都是<code>Promise</code>对象）</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">job1.then(job2).then(job3).catch(handleError);</span><br></pre></td></tr></table></figure><blockquote><p><code>job1</code>成功才会执行<code>job2</code>，以此类推。</p></blockquote></li><li><p><code>Promise</code>可以<strong>并行</strong>执行异步任务</p><ul><li><p>独立的并行任务（汇合）</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> p1 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">      setTimeout(resolve, <span class="number">500</span>, <span class="string">'P1'</span>);</span><br><span class="line">&#125;);</span><br><span class="line">  <span class="keyword">var</span> p2 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">      setTimeout(resolve, <span class="number">600</span>, <span class="string">'P2'</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">// 同时执行p1和p2，并在它们都完成后执行then:</span></span><br><span class="line">  <span class="built_in">Promise</span>.all([p1, p2]).then(<span class="function"><span class="keyword">function</span> (<span class="params">results</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(results); <span class="comment">// 获得一个Array: ['P1', 'P2']</span></span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure></li><li><p>为了容错时，例如向两个URL读取用户的个人信息，只需要获得先返回的结果即可。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> p1 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    setTimeout(resolve, <span class="number">500</span>, <span class="string">'P1'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">var</span> p2 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    setTimeout(resolve, <span class="number">600</span>, <span class="string">'P2'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">Promise</span>.race([p1, p2]).then(<span class="function"><span class="keyword">function</span> (<span class="params">result</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(result); <span class="comment">// 'P1'</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li></ul></li></ul><h2 id="Canvas"><a href="#Canvas" class="headerlink" title="Canvas"></a>Canvas</h2><h3 id="概述-3"><a href="#概述-3" class="headerlink" title="概述"></a>概述</h3><ul><li><p>HTML5提供的控件，用于替代Flash.</p></li><li><p>一个<code>Canvas</code>定义了一个指定尺寸的矩形框，在这个范围内可以随意绘制。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span> = <span class="string">"test-canvas"</span> <span class="attr">width</span> = <span class="string">"300"</span> <span class="attr">height</span> = <span class="string">"200"</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>浏览器如果<strong>支持</strong><code>Canvas</code>，则会<strong>忽略</strong><code>Canvas</code>内的HTML代码。</li></ul></li></ul><h3 id="应用-1"><a href="#应用-1" class="headerlink" title="应用"></a>应用</h3><ul><li><p>绘制2D图像</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ctx = canvas.getContext(<span class="string">'2d'</span>);</span><br></pre></td></tr></table></figure></li><li><p>绘制3D图像</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> gl = canvas.getContext(<span class="string">'webgl'</span>);</span><br></pre></td></tr></table></figure></li><li><p>绘制带阴影的文字</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span></span><br><span class="line">    canvas = <span class="built_in">document</span>.getElementById(<span class="string">'test-text-canvas'</span>),</span><br><span class="line">    ctx = canvas.getContext(<span class="string">'2d'</span>);</span><br><span class="line"></span><br><span class="line">ctx.clearRect(<span class="number">0</span>, <span class="number">0</span>, canvas.width, canvas.height); <span class="comment">// 擦除(0,0)位置大小为Canvas大小的矩形，擦除的意思是把该区域变为透明</span></span><br><span class="line">ctx.shadowOffsetX = <span class="number">2</span>;</span><br><span class="line">ctx.shadowOffsetY = <span class="number">2</span>;</span><br><span class="line">ctx.shadowBlur = <span class="number">2</span>;</span><br><span class="line">ctx.shadowColor = <span class="string">'#666666'</span>;</span><br><span class="line">ctx.font = <span class="string">'24px Arial'</span>;</span><br><span class="line">ctx.fillStyle = <span class="string">'#333333'</span>; <span class="comment">// 设置颜色</span></span><br><span class="line">ctx.fillText(<span class="string">'带阴影的文字'</span>, <span class="number">20</span>, <span class="number">40</span>);</span><br></pre></td></tr></table></figure></li></ul><h3 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h3><ul><li>创建一个不可见的Canvas来绘图，然后将最终绘制结果复制到页面的可见Canvas中。</li><li>尽量使用整数坐标而不是浮点数</li><li>创建多个重叠的Canvas绘制不同的层，而不是在一个Canvas中绘制非常复杂的图。</li><li>背景图片如果不变可以直接用<code>img</code>标签并放到<strong>最底层</strong></li></ul><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://www.liaoxuefeng.com/" target="_blank" rel="noopener">https://www.liaoxuefeng.com/</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;全文共&lt;code&gt;4625&lt;/code&gt;字，推荐阅读时间&lt;code&gt;30~45&lt;/code&gt;分钟。&lt;/p&gt;
    
    </summary>
    
    
      <category term="Web" scheme="http://yoursite.com/categories/Web/"/>
    
      <category term="JavaScript" scheme="http://yoursite.com/categories/JavaScript/"/>
    
    
  </entry>
  
  <entry>
    <title>MySQL-Chapter1-关系模型</title>
    <link href="http://yoursite.com/2020/07/08/MySQL-Chapter1-%E5%85%B3%E7%B3%BB%E6%A8%A1%E5%9E%8B/"/>
    <id>http://yoursite.com/2020/07/08/MySQL-Chapter1-%E5%85%B3%E7%B3%BB%E6%A8%A1%E5%9E%8B/</id>
    <published>2020-07-08T07:53:34.385Z</published>
    <updated>2020-07-08T07:56:03.505Z</updated>
    
    <content type="html"><![CDATA[<p>全文共<code>1315</code>字，推荐阅读时间<code>7~10</code>分钟。</p><a id="more"></a><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><ul><li>关系数据库是建立在关系模型上的</li><li>关系模型本质上就是<strong>若干个</strong>存储数据的<strong>二维表</strong>（看作很多Excel表）</li><li>表的<strong>每一行</strong>称为<strong>记录</strong>(Record)，记录是一个<strong>逻辑意义</strong>上的数据。</li><li>表的<strong>每一列</strong>称为<strong>字段</strong>(Column)，同一个表的<strong>每一行</strong>记录都拥有<strong>相同类型</strong>的若干<strong>字段（列）</strong>。<ul><li>字段定义数据类型</li><li>字段定义数据是否可以为<code>NULL</code>，<code>NULL</code>表示数据<strong>不存在</strong>，<strong>不是</strong>0/空串。</li></ul></li></ul><h2 id="主键"><a href="#主键" class="headerlink" title="主键"></a>主键</h2><h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><ul><li>记录需要一个<strong>唯一</strong>的标识来进行区分</li><li>所有的记录的<strong>主键</strong>一定是不同的</li></ul><h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><ul><li>主键是一个<strong>字段</strong></li><li>主键是用来区分记录的，各个记录的主键字段值<strong>不能相同</strong>。</li></ul><blockquote><p>主键在建立起字段后最后<strong>不要</strong>再进行修改</p></blockquote><h3 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h3><ul><li><p>不能用业务相关的字段作为主键</p><blockquote><p>业务相关：变更不可控，例如身份证号的位数可能会发生<strong>变更</strong>。</p></blockquote></li><li><p>不应该允许NULL</p></li><li><p>主键常命名为id</p><ul><li><p>自增整数类型(<code>BIGINT NOT_NULL AUTO_INCREMENT</code>)</p><p>数据库会在插入数据时<strong>自动</strong>为每一条记录分配一个自增整数</p></li><li><p>全局唯一GUID类型</p><p>使用一种全局唯一的字符串作为主键，类似<code>8f55d96b-8acc-4636-8cb8-76bf8abc2f57</code>。</p></li></ul></li></ul><h3 id="联合主键"><a href="#联合主键" class="headerlink" title="联合主键"></a>联合主键</h3><ul><li>关系数据库实际上还允许通过<strong>多个字段唯一标识记录</strong>，即<strong>两个或更多的字段</strong>都设置为主键，这种主键被称为联合主键。</li></ul><h2 id="外键"><a href="#外键" class="headerlink" title="外键"></a>外键</h2><h3 id="定义-1"><a href="#定义-1" class="headerlink" title="定义"></a>定义</h3><ul><li><p>在表1中增加表2的主键id，命名为<code>table2_id</code>，即可在<strong>表一</strong>中查找到记录在<strong>表二</strong>中相关字段的索引。</p><blockquote><p>通常用来实现实现<strong>一对多</strong>关系：例如一个班级（<strong>表2</strong>）对应多个学生（<strong>表1</strong>）。</p></blockquote></li></ul><h3 id="一对多"><a href="#一对多" class="headerlink" title="一对多"></a>一对多</h3><ul><li><p><strong>正规外键</strong>不是通过新增字段实现的，而是通过定义外键约束实现的。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE students</span><br><span class="line">ADD CONSTRAINT fk_class_id</span><br><span class="line">FOREIGN KEY (class_id)</span><br><span class="line">REFERENCES classes (id);</span><br></pre></td></tr></table></figure><ul><li><code>fk_class_id</code>：外键约束的名称，可以任意。</li><li><code>FOREIGN KEY (class_id)</code>：指定<code>class_id</code>是<strong>外键</strong></li><li><code>REFERENCES classes (id)</code>：指定将<code>class_id</code>这个外键关联到<code>classes</code>的<code>id</code><strong>主键</strong>上</li></ul></li><li><p>通过定义外键约束，关系数据库可以保证<strong>无法插入</strong>无效的数据。即如果<code>classes</code>表<strong>不存在</strong><code>id=99</code>的记录，<code>students</code>表就<strong>无法</strong>插入<code>class_id=99</code>的记录。</p></li><li><p>由于外键约束会<strong>降低</strong>数据库的性能，可以采用变种外键，即<code>class_id</code>仅仅是一个<strong>普通的列</strong>，只是它<strong>起到了</strong>外键的作用而已。</p></li><li><p>删除外键约束</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE students</span><br><span class="line">DROP FOREIGN KEY fk_class_id;</span><br></pre></td></tr></table></figure><blockquote><p>删除外键约束<strong>并没有</strong>删除外键这一列。<strong>删除列</strong>是通过<code>DROP COLUMN ...</code>实现的。</p></blockquote></li></ul><h3 id="多对多"><a href="#多对多" class="headerlink" title="多对多"></a>多对多</h3><ul><li><p>通过两个一对多关系实现</p><ul><li><p>通过一张中间表，关联两个一对多关系。</p><p>| id   | teacher_id | class_id |<br>| —— | ————— | ———— |<br>| 1    | 1          | 1        |<br>| 2    | 1          | 2        |<br>| 3    | 2          | 1        |<br>| 4    | 3          | 1        |</p></li></ul></li></ul><h3 id="一对一"><a href="#一对一" class="headerlink" title="一对一"></a>一对一</h3><ul><li>一个表的记录对应到另一个表的<strong>唯一一个</strong>记录</li></ul><blockquote><p>一对一表理论上可以合并为一个表，但是一些应用会把一个大表拆成两个一对一的表，目的是把经常读取和不经常读取的字段分开，以获得<strong>更高的性能</strong>。</p></blockquote><h2 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h2><h3 id="定义-2"><a href="#定义-2" class="headerlink" title="定义"></a>定义</h3><ul><li>为了在大数据库中取得较高的查找速度提出的方法</li><li>索引是关系数据库中对<strong>某一列</strong>或<strong>多个列</strong>的<strong>值</strong>进行<strong>预排序</strong>的数据结构（本质是为了缩小查找的范围）</li></ul><h3 id="创建"><a href="#创建" class="headerlink" title="创建"></a>创建</h3><p>情景：经常根据列表的<code>score</code>字段进行查询</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE students</span><br><span class="line">ADD INDEX idx_score (score);</span><br></pre></td></tr></table></figure><p>索引名称是任意的，索引如果有多列，可以在括号里依次写上</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE students</span><br><span class="line">ADD INDEX idx_name_score (name, score);</span><br></pre></td></tr></table></figure><blockquote><ul><li>如果记录的列存在大量<strong>相同</strong>的值，例如<code>gender</code>列，大约一半的记录值是<code>M</code>，另一半是<code>F</code>，此时对该列创建索引就<strong>没有意义</strong>。</li><li>索引越<strong>多</strong>，插入、更新和删除记录的速度就越<strong>慢</strong>。</li><li>对于<strong>主键</strong>，关系数据库会<strong>自动</strong>对其创建主键索引。使用主键索引的效率是<strong>最高</strong>的，因为主键会保证绝对唯一。</li></ul></blockquote><h3 id="唯一索引"><a href="#唯一索引" class="headerlink" title="唯一索引"></a>唯一索引</h3><ul><li><p>当记录的该字段不会发生重复时，就可以为该列增加唯一索引。</p><p>例如不重名时</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE students</span><br><span class="line">ADD UNIQUE INDEX uni_name (name);</span><br></pre></td></tr></table></figure></li><li><p>唯一索引<strong>不是</strong>主键，例如身份证号，就算位数变化，也不影响唯一性，但是会影响主键的查找。</p></li></ul><h3 id="意义"><a href="#意义" class="headerlink" title="意义"></a>意义</h3><p>当我们在数据库中查询时，如果有相应的索引可用，数据库系统就会<strong>自动使用索引</strong>来提高查询效率，如果没有索引，查询也能正常执行，只是速度会变慢。因此，索引可以在使用数据库的过程中<strong>逐步优化</strong>。</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://www.liaoxuefeng.com/" target="_blank" rel="noopener">https://www.liaoxuefeng.com/</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;全文共&lt;code&gt;1315&lt;/code&gt;字，推荐阅读时间&lt;code&gt;7~10&lt;/code&gt;分钟。&lt;/p&gt;
    
    </summary>
    
    
      <category term="Web" scheme="http://yoursite.com/categories/Web/"/>
    
      <category term="MySQL" scheme="http://yoursite.com/categories/MySQL/"/>
    
    
  </entry>
  
  <entry>
    <title>MySQL-Chapter0-数据库概述</title>
    <link href="http://yoursite.com/2020/07/08/MySQL-Chapter0-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%A6%82%E8%BF%B0/"/>
    <id>http://yoursite.com/2020/07/08/MySQL-Chapter0-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%A6%82%E8%BF%B0/</id>
    <published>2020-07-08T07:53:34.385Z</published>
    <updated>2020-07-08T07:56:10.842Z</updated>
    
    <content type="html"><![CDATA[<p>全文共<code>348</code>字，推荐阅读时间<code>3~5</code>分钟。</p><a id="more"></a><h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><ul><li>应用程序<strong>不需要</strong>自己管理数据，而是通过数据库软件提供的<strong>接口</strong>来读写数据。</li></ul><h2 id="数据模型"><a href="#数据模型" class="headerlink" title="数据模型"></a>数据模型</h2><h3 id="层次模型"><a href="#层次模型" class="headerlink" title="层次模型"></a>层次模型</h3><ul><li>树形结构</li></ul><p><img src="https://i.loli.net/2020/07/01/wScTtsDdWhjIzL4.png" alt="XR@5HT3{ZYUZH}~HSF~HTWE" style="zoom:50%;" /></p><h3 id="网状模型"><a href="#网状模型" class="headerlink" title="网状模型"></a>网状模型</h3><ul><li>图结构</li></ul><p><img src="https://i.loli.net/2020/07/01/lK8DtykOrIJS5eA.png" alt="two" style="zoom:50%;" /></p><h3 id="关系模型"><a href="#关系模型" class="headerlink" title="关系模型"></a>关系模型</h3><ul><li>二维表格</li><li>通过行号和列号定位</li><li><strong>占数据库的主导地位</strong></li></ul><p><img src="https://i.loli.net/2020/07/01/ricl1Rg87oAECqd.png" alt="three" style="zoom:50%;" /></p><h4 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h4><ul><li>关系表中，除了每一列的名称，还需要定义每一列的<strong>数据类型</strong>。</li></ul><div class="table-container"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>INT</td><td>整型</td><td>4字节</td></tr><tr><td>BIGINT</td><td>长整型</td><td>8字节</td></tr><tr><td>REAL</td><td>浮点型</td><td>4字节</td></tr><tr><td>DOUBLE</td><td>浮点型</td><td>8字节</td></tr><tr><td>DECIMAL(M,N)</td><td>高精度小数</td><td>M表示数字总共多少位，N表示小数有多少位，常用于财务计算。</td></tr><tr><td>CHAR(N)</td><td>定长字符串</td><td>N表示字符串长度</td></tr><tr><td>VARCHAR(N)</td><td>变长字符串</td><td>N表示长度上限</td></tr><tr><td>BOOLEAN</td><td>布尔类型</td><td>True/False</td></tr><tr><td>DATE</td><td>日期类型</td><td>2020-07-01</td></tr><tr><td>TIME</td><td>时间类型</td><td>12:20:25</td></tr><tr><td>DATETIME</td><td>日期和时间类型</td><td>2020-07-01 12:20:25</td></tr></tbody></table></div><blockquote><p><code>BIGINT</code>和<code>VARCHAR</code>是使用<strong>最广泛</strong>的两种类型</p></blockquote><h4 id="语法特点"><a href="#语法特点" class="headerlink" title="语法特点"></a>语法特点</h4><p>SQL关键字<strong>不区分</strong>大小写，但是规范如下：</p><ul><li>关键字统一使用<strong>大写</strong></li><li>表名和列名统一使用<strong>小写</strong></li></ul><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://www.liaoxuefeng.com/" target="_blank" rel="noopener">https://www.liaoxuefeng.com/</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;全文共&lt;code&gt;348&lt;/code&gt;字，推荐阅读时间&lt;code&gt;3~5&lt;/code&gt;分钟。&lt;/p&gt;
    
    </summary>
    
    
      <category term="Web" scheme="http://yoursite.com/categories/Web/"/>
    
      <category term="MySQL" scheme="http://yoursite.com/categories/MySQL/"/>
    
    
  </entry>
  
  <entry>
    <title>MySQL-Chapter2-数据查询</title>
    <link href="http://yoursite.com/2020/07/08/MySQL-Chapter2-%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2/"/>
    <id>http://yoursite.com/2020/07/08/MySQL-Chapter2-%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2/</id>
    <published>2020-07-08T07:53:34.385Z</published>
    <updated>2020-07-08T07:56:07.163Z</updated>
    
    <content type="html"><![CDATA[<p>全文共<code>1349</code>字，推荐阅读时间<code>7~10</code>分钟。</p><a id="more"></a><h2 id="基本查询"><a href="#基本查询" class="headerlink" title="基本查询"></a>基本查询</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM &lt;table_name&gt;;</span><br></pre></td></tr></table></figure><ul><li><code>SELECT</code>：表示要执行一个查询</li><li><code>*</code>：表示所有<strong>列</strong></li><li><code>FROM</code>：表示将要从哪个表查询、</li></ul><blockquote><ul><li><code>SELECT 1;</code>常用来测试数据库连接</li><li>查询结果是一个<strong>二维表</strong></li></ul></blockquote><h2 id="条件查询"><a href="#条件查询" class="headerlink" title="条件查询"></a>条件查询</h2><ul><li><p><code>WHERE</code>引出条件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM students WHERE score &gt;&#x3D; 80;</span><br></pre></td></tr></table></figure></li><li><p><code>AND</code>/<code>OR</code>/<code>NOT</code>进行逻辑运算</p></li><li><p><code>=</code>（<strong>一个</strong>等号）表示相等判断</p></li><li><p><code>&lt;&gt;</code>表示<strong>不等</strong>判断（等价于<code>NOT xxx = xxx;</code>）</p></li><li><p><code>()</code>进行条件分组</p></li></ul><h3 id="特殊操作"><a href="#特殊操作" class="headerlink" title="特殊操作"></a>特殊操作</h3><ul><li><p><code>BETWEEN...AND...</code>（<strong>闭</strong>区间）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">WHERE score &gt;&#x3D; 60 AND score &lt;&#x3D;90;</span><br><span class="line">WHERE score BETWEEN 60 AND 90;</span><br></pre></td></tr></table></figure></li><li><p><code>LIKE</code>判断相似</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">name LIKE &#39;ab%&#39;</span><br></pre></td></tr></table></figure><ul><li><code>%</code>表示<strong>任意字符</strong>，可以为<strong>空</strong>字符。</li></ul></li></ul><h2 id="投影查询"><a href="#投影查询" class="headerlink" title="投影查询"></a>投影查询</h2><p>只查询<strong>某些列</strong>的操作被称为<strong>投影查询</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT id, score, name FROM students;</span><br></pre></td></tr></table></figure><ul><li><p>为列增加别名</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT id, score points, name FROM students;</span><br></pre></td></tr></table></figure><blockquote><p><code>SELECT row1, row2 name2, row3 FROM ...</code></p></blockquote></li></ul><h2 id="排序"><a href="#排序" class="headerlink" title="排序"></a>排序</h2><ul><li><p>数据库的查询结果默认按照<code>id</code>（主键）排序</p></li><li><p>使用<code>ORDER BY</code>子句将记录根据字段值<strong>从低到高</strong>进行排序（默认升序<code>ASC</code>）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT id, name, gender, score FROM students ORDER BY score;</span><br></pre></td></tr></table></figure><blockquote><p>增加<code>DESC</code>表示<strong>倒序</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT id, name, gender, score FROM students ORDER BY score DESC;</span><br></pre></td></tr></table></figure></blockquote></li><li><p>多要素排序：将要素依次列出，逗号分隔即可。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT id, name, gender, score FROM students ORDER BY score DESC, gender;</span><br></pre></td></tr></table></figure></li><li><p>多行查询语句（关键词换行）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT id, name, gender, score</span><br><span class="line">FROM students</span><br><span class="line">WHERE class_id &#x3D; 1</span><br><span class="line">ORDER BY score DESC;</span><br></pre></td></tr></table></figure></li><li><p><code>ORDER BY</code>放在查询语句的<strong>最后</strong></p></li></ul><h2 id="分页查询"><a href="#分页查询" class="headerlink" title="分页查询"></a>分页查询</h2><p>当查询结果量很大时，进行分页显示。</p><ul><li><p>实质上就是从结果中<strong>截取</strong>一部分进行显示，进行多次查询即可得知所有结果。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT id, name, gender, score</span><br><span class="line">FROM students</span><br><span class="line">ORDER BY score DESC</span><br><span class="line">LIMIT 3 OFFSET 0;</span><br></pre></td></tr></table></figure><ul><li><code>LIMIT M OFFSET N</code>：从<code>N</code>开始的<strong>最多</strong><code>M</code>条记录（少于<code>M</code>条也不会报错）</li><li>可以简写为<code>LIMIT M, N</code></li><li><code>LIMIT M</code>默认<code>N</code>为0</li></ul></li></ul><h2 id="聚合查询"><a href="#聚合查询" class="headerlink" title="聚合查询"></a>聚合查询</h2><p>对于总数、平均数的计算，SQL内置了聚合函数，使用聚合函数进行查询就叫聚合查询。</p><ul><li><p>查询表中<strong>记录</strong>总数</p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT COUNT(*) FROM students;</span><br></pre></td></tr></table></figure><blockquote><p>为返回的表设置别名</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">SELECT COUNT(*) num FROM students;</span><br><span class="line"></span><br><span class="line">&#x2F;* output</span><br><span class="line">    +-----+</span><br><span class="line">    | num |</span><br><span class="line">    +-----+</span><br><span class="line">    |  10 |</span><br><span class="line">    +-----+</span><br><span class="line">*&#x2F;</span><br></pre></td></tr></table></figure></blockquote></li><li><p>查询特定记录总数</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT COUNT(id) boys FROM students WHERE gender &#x3D; &#39;M&#39;;</span><br></pre></td></tr></table></figure><ul><li><code>COUNT(*)</code>和<code>COUNT(id)</code>等价</li><li>没有匹配到行返回<code>0</code></li></ul></li></ul><h3 id="其他聚合函数"><a href="#其他聚合函数" class="headerlink" title="其他聚合函数"></a>其他聚合函数</h3><ul><li><p><code>SUM</code>：计算某一列的和</p><ul><li>没有匹配到行返回<code>NULL</code></li></ul></li><li><p><code>AVG</code>：计算某一列的平均值</p><ul><li>没有匹配到行返回<code>NULL</code></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT AVG(score) average FROM students WHERE gender &#x3D; &#39;M&#39;;</span><br></pre></td></tr></table></figure></li><li><p><code>MAX</code>：计算某一列的最大值</p><ul><li>没有匹配到行返回<code>NULL</code></li></ul></li><li><p><code>MIN</code>：计算某一列的最小值</p><ul><li>没有匹配到行返回<code>NULL</code></li></ul></li></ul><blockquote><p>后两个<strong>不限于</strong>数值类型</p></blockquote><ul><li><p><code>FLOOR</code>：向下取整函数</p></li><li><p><code>CEILING</code>：向上取整函数</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT CEILING(COUNT(*) &#x2F; 3) FROM students;</span><br></pre></td></tr></table></figure></li></ul><h3 id="分组"><a href="#分组" class="headerlink" title="分组"></a>分组</h3><ul><li><p>根据字段值自动分组计数（不用多次查询）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT COUNT(*) num FROM students GROUP BY class_id;</span><br></pre></td></tr></table></figure><ul><li><p>为了区分输出的结果是哪个班的，可以多<code>SELECT</code>一个字段。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT class_id, COUNT(*) num FROM students GROUP BY class_id;</span><br></pre></td></tr></table></figure><ul><li>注意只能<code>SELECT</code>用于分组的字段，加入其他字段可能会出现<strong>一个框内多个值</strong>的情况，MySQL会报错。</li></ul></li></ul></li><li><p>多字段分组</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT class_id, gender, COUNT(*) num </span><br><span class="line">FROM students </span><br><span class="line">GROUP BY class_id, gender;</span><br></pre></td></tr></table></figure></li><li><p>查询各个班级的平均分</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT class_id, AVG(score) avg</span><br><span class="line">FROM students</span><br><span class="line">GROUP BY class_id;</span><br></pre></td></tr></table></figure></li><li><p>查出各个班级男生和女生的平均分</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT class_id, gender, AVG(score) avg</span><br><span class="line">FROM students</span><br><span class="line">GROUP BY class_id, gender;</span><br><span class="line">-- ORDER BY gender;</span><br></pre></td></tr></table></figure></li></ul><h2 id="多表查询"><a href="#多表查询" class="headerlink" title="多表查询"></a>多表查询</h2><p>查询两个表的乘积，又称笛卡尔查询。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM students, classes;</span><br></pre></td></tr></table></figure><ul><li><p>将两张表的行逐一进行枚举组合后拼在一起返回</p></li><li><p>结果集<strong>列数</strong>是两张表<strong>列数之和</strong></p></li><li><p>结果集<strong>行数</strong>是两张表<strong>行数之积</strong></p></li><li><p>查询时为了区分列，可以设置别名。（注意字段名的访问方式）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">students.id sid,</span><br><span class="line">students.name,</span><br><span class="line">students.gender,</span><br><span class="line">students.score,</span><br><span class="line">classes.id cid,</span><br><span class="line">classes.name cname</span><br><span class="line">FROM students, classes;</span><br></pre></td></tr></table></figure><p>当表名过长时，可以选择给<strong>表</strong>再起一个别名。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">s.id sid,</span><br><span class="line">s.name,</span><br><span class="line">s.gender,</span><br><span class="line">s.score,</span><br><span class="line">c.id cid,</span><br><span class="line">c.name cname</span><br><span class="line">FROM students s, classes c;</span><br></pre></td></tr></table></figure></li></ul><h2 id="连接查询"><a href="#连接查询" class="headerlink" title="连接查询"></a>连接查询</h2><p>对多个表进行<code>JOIN</code>运算：先确定一个主表，然后从其他表中选择性地提取一些行加入到结果集中。</p><ul><li><p>查询学生信息的同时需要知道班级id对应的班级名</p><ul><li><p>内连接</p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT s.id, s.name, s.class_id, c.name class_name, s.gender, s.score</span><br><span class="line">FROM students s</span><br><span class="line">INNER JOIN classes c</span><br><span class="line">ON s.class_id &#x3D; c.id;</span><br></pre></td></tr></table></figure><ul><li>确认主表(students)</li><li>确认连接表(classes)</li><li>确认连接条件(<code>ON</code>)：当条件满足时把主表和连接表的<strong>对应行</strong>连接起来</li><li>可以加上查询语句等辅助功能</li></ul></li><li><p>外连接</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT s.id, s.name, s.class_id, c.name class_name, s.gender, s.score</span><br><span class="line">FROM students s</span><br><span class="line">RIGHT OUTER JOIN classes c</span><br><span class="line">ON s.class_id &#x3D; c.id;</span><br></pre></td></tr></table></figure><blockquote><p>相比于内连接会多出一行</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">idnameclass_idclass_namegenderscore</span><br><span class="line">NULLNULLNULL四班   NULL    NULL</span><br></pre></td></tr></table></figure></blockquote><ul><li><code>RIGHT OUTER JOIN</code>：返回<strong>右表</strong>（连接表）中存在的行（左表不存在无所谓）</li><li><code>LEFT OUTER JOIN</code>：返回<strong>左表</strong>（主表）中存在的行（右表不存在无所谓）</li><li><code>FULL OUTER JOIN</code>：两边表只要有一个存在就返回（<code>RIGHT</code>和<code>LEFT</code>的并集）</li><li><code>INNER JOIN</code>：返回两张表<strong>都存在</strong>的记录</li></ul></li></ul></li></ul><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://www.liaoxuefeng.com/" target="_blank" rel="noopener">https://www.liaoxuefeng.com/</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;全文共&lt;code&gt;1349&lt;/code&gt;字，推荐阅读时间&lt;code&gt;7~10&lt;/code&gt;分钟。&lt;/p&gt;
    
    </summary>
    
    
      <category term="Web" scheme="http://yoursite.com/categories/Web/"/>
    
      <category term="MySQL" scheme="http://yoursite.com/categories/MySQL/"/>
    
    
  </entry>
  
  <entry>
    <title>JavaScript-Chapter3-面向对象编程</title>
    <link href="http://yoursite.com/2020/07/08/JavaScript-Chapter3-%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B/"/>
    <id>http://yoursite.com/2020/07/08/JavaScript-Chapter3-%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B/</id>
    <published>2020-07-08T03:58:19.068Z</published>
    <updated>2020-07-08T03:59:13.050Z</updated>
    
    <content type="html"><![CDATA[<p>全文共<code>1107</code>字，推荐阅读时间<code>7~10</code>分钟。</p><a id="more"></a><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>不同于Java，JavaScript的OO中没有Class和实例的概念。</p><ul><li><p>在JavaScript中，通过<strong>原型</strong>实现OO编程。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Student = &#123;</span><br><span class="line">    name: <span class="string">'Robot'</span>,</span><br><span class="line">    height: <span class="number">1.2</span>,</span><br><span class="line">    run: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.name + <span class="string">' is running...'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> xiaoming = &#123;</span><br><span class="line">    name: <span class="string">'小明'</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">xiaoming.__proto__ = Student;</span><br></pre></td></tr></table></figure><ul><li><p>定义一个模型变量<code>Student</code></p></li><li><p>通过修改对象的<code>__proto__</code>域可以实现对象的<strong>动态</strong>改变，但是在编程时<strong>不推荐</strong>使用这种方式创建对象。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Bird = &#123;</span><br><span class="line">    fly: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.name + <span class="string">' is flying...'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">xiaoming.__proto__ = Bird;</span><br></pre></td></tr></table></figure><blockquote><p>此时<code>xiaoming</code>就<strong>没有</strong><code>run</code>方法了</p></blockquote></li></ul></li><li><p>JavaScript中所有对象<strong>都是实例</strong></p></li><li><p>使用封装好的<code>Object.create()</code>方法改变对象继承的原型</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Student = &#123;</span><br><span class="line">    name: <span class="string">'Robot'</span>,</span><br><span class="line">    height: <span class="number">1.2</span>,</span><br><span class="line">    run: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.name + <span class="string">'is running...'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createStudent</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> s = <span class="built_in">Object</span>.create(Student);</span><br><span class="line">    s.name = name;</span><br><span class="line">    <span class="keyword">return</span> s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> xiaoming = createStudent(<span class="string">'xiaoming'</span>);</span><br><span class="line">xiaoming.run();</span><br><span class="line">xiaoming.__proto___ === Student; <span class="comment">// true</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="创建对象"><a href="#创建对象" class="headerlink" title="创建对象"></a>创建对象</h2><p>所有原型最后都会回到<code>null</code></p><h3 id="构造函数"><a href="#构造函数" class="headerlink" title="构造函数"></a>构造函数</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Student</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">    <span class="keyword">this</span>.hello = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        alert(<span class="string">'Hello, '</span> + <span class="keyword">this</span>.name + <span class="string">'!'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> xiaoming = <span class="keyword">new</span> Student(<span class="string">'xiaoming'</span>);</span><br></pre></td></tr></table></figure><ul><li><p>如果不写<code>new</code>，则<code>Student</code>函数就是一个普通函数；如果写了<code>new</code>，则<code>Student</code>就是一个构造函数，它<strong>根据原型对象</strong>创建一个<strong>新对象</strong>并把<code>this</code>指向它，同时<strong>不需要</strong>显式<code>return</code>.</p></li><li><p><code>xiaoming</code><strong>从新对象</strong>得到了一个<code>constructor</code>属性，指向函数<code>Student</code>.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">xiaoming.constructor === Student.prototype.constructor; <span class="comment">// true</span></span><br><span class="line">Student === Student.prototype.constructor; <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.getPrototypeOf(xiaoming) === Student.prototype; <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line">xiaoming <span class="keyword">instanceof</span> Student; <span class="comment">// true</span></span><br></pre></td></tr></table></figure></li><li><p>关系示意图<br><img src="https://static.liaoxuefeng.com/files/attachments/1024698721053600/l"  /></p><ul><li>某个对象即构造函数对应的<strong>唯一的原型对象</strong></li></ul></li><li><p>不同对象尽管由同一个原型对象创建得到，但是其中的属性除了<code>constructor</code>之外都是<strong>独立的</strong>。（但是访问<code>constructor</code>直接<code>xxx.constructor</code>，<strong>而不是</strong>使用<code>xxx.prototype.constructor</code>.）</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">xiaoming.name; <span class="comment">// '小明'</span></span><br><span class="line">xiaohong.name; <span class="comment">// '小红'</span></span><br><span class="line">xiaoming.hello; <span class="comment">// function: Student.hello()</span></span><br><span class="line">xiaohong.hello; <span class="comment">// function: Student.hello()</span></span><br><span class="line">xiaoming.hello === xiaohong.hello; <span class="comment">// false</span></span><br></pre></td></tr></table></figure><ul><li><p>对于可共享函数，可以采用直接对<strong>原型对象域</strong>操作的办法进行设置。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Student</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Student.prototype.hello = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    alert(<span class="string">'Hello, '</span> + <span class="keyword">this</span>.name + <span class="string">'!'</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li><p>此时所有的<code>Student</code>对象共享同一个<code>hello</code></p><blockquote><p>构造函数中的属性都是独立的，直接在<code>prototype</code>中修改的就是共享的。</p></blockquote></li><li><p>此时<code>this</code>指向调用<strong>该方法</strong>的对象</p></li><li><p><code>prototype</code>这个属性只有构造函数有，对象只有<code>__proto__</code>.</p></li></ul></li></ul></li><li><p>普通函数的首字母小写，构造函数的<strong>首字母大写</strong>。</p></li><li><p>为了省略显示<code>new</code>操作，可以进行封装。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Student</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = props.name || <span class="string">'匿名'</span>; <span class="comment">// 默认值为'匿名'</span></span><br><span class="line">    <span class="keyword">this</span>.grade = props.grade || <span class="number">1</span>; <span class="comment">// 默认值为1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Student.prototype.hello = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    alert(<span class="string">'Hello, '</span> + <span class="keyword">this</span>.name + <span class="string">'!'</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createStudent</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Student(props || &#123;&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> xiaoming = createStudent(&#123;</span><br><span class="line">    name: <span class="string">'xiaoming'</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ul><li>使用<code>||</code>实现默认值操作</li><li>注意传入的参数是<strong>对象</strong></li></ul></li></ul><h2 id="原型继承"><a href="#原型继承" class="headerlink" title="原型继承"></a>原型继承</h2><ul><li><p>定义新的构造函数，并在内部调用被继承的函数，并绑定<code>this</code>.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">PrimaryStudent</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 调用Student构造函数，绑定this变量:</span></span><br><span class="line">    Student.call(<span class="keyword">this</span>, props);</span><br><span class="line">    <span class="keyword">this</span>.grade = props.grade || <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>借助中间函数<code>F</code>实现原型链继承</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// PrimaryStudent构造函数:</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">PrimaryStudent</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">    Student.call(<span class="keyword">this</span>, props);</span><br><span class="line">    <span class="keyword">this</span>.grade = props.grade || <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 空函数F:</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">F</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 把F的原型指向Student.prototype:</span></span><br><span class="line">F.prototype = Student.prototype;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 把PrimaryStudent的原型指向一个新的F对象，F对象的原型正好指向Student.prototype:</span></span><br><span class="line">PrimaryStudent.prototype = <span class="keyword">new</span> F();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 把PrimaryStudent原型的构造函数修复为PrimaryStudent:</span></span><br><span class="line">PrimaryStudent.prototype.constructor = PrimaryStudent;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 继续在PrimaryStudent原型（就是new F()对象）上定义方法：</span></span><br><span class="line">PrimaryStudent.prototype.getGrade = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.grade;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建xiaoming:</span></span><br><span class="line"><span class="keyword">var</span> xiaoming = <span class="keyword">new</span> PrimaryStudent(&#123;</span><br><span class="line">    name: <span class="string">'小明'</span>,</span><br><span class="line">    grade: <span class="number">2</span></span><br><span class="line">&#125;);</span><br><span class="line">xiaoming.name; <span class="comment">// '小明'</span></span><br><span class="line">xiaoming.grade; <span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 验证原型:</span></span><br><span class="line">xiaoming.__proto__ === PrimaryStudent.prototype; <span class="comment">// true</span></span><br><span class="line">xiaoming.__proto__.__proto__ === Student.prototype; <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 验证继承关系:</span></span><br><span class="line">xiaoming <span class="keyword">instanceof</span> PrimaryStudent; <span class="comment">// true</span></span><br><span class="line">xiaoming <span class="keyword">instanceof</span> Student; <span class="comment">// true</span></span><br></pre></td></tr></table></figure><blockquote><p>一个函数本身就算不是构造函数，加了<code>new</code>也能正常执行。</p></blockquote><ul><li><p>关系图</p><p><img src="https://static.liaoxuefeng.com/files/attachments/1034288859918112/l" alt=""></p></li><li><p>为了简化，可以把继承封装为一个函数。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">inherits</span>(<span class="params">Child, Parent</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> F = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line">    F.prototype = Parent.prototype;</span><br><span class="line">    Child.prototype = <span class="keyword">new</span> F();</span><br><span class="line">    Child.prototype.constructor = Child;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>在新的构造函数的原型上定义新方法</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Student</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = props.name || <span class="string">'Unnamed'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Student.prototype.hello = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    alert(<span class="string">'Hello, '</span> + <span class="keyword">this</span>.name + <span class="string">'!'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">PrimaryStudent</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">    Student.call(<span class="keyword">this</span>, props);</span><br><span class="line">    <span class="keyword">this</span>.grade = props.grade || <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现原型继承链:</span></span><br><span class="line">inherits(PrimaryStudent, Student);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 绑定其他方法到PrimaryStudent原型:</span></span><br><span class="line">PrimaryStudent.prototype.getGrade = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.grade;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li></ul><h2 id="class继承"><a href="#class继承" class="headerlink" title="class继承"></a>class继承</h2><p>为了简化原型继承提出了新关键字<code>class</code></p><ul><li><p>使用<code>class</code>直接编写类</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(name) &#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    hello() &#123;</span><br><span class="line">        alert(<span class="string">'Hello, '</span> + <span class="keyword">this</span>.name + <span class="string">'!'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>定义方法<strong>不需要</strong><code>function</code>关键字</li></ul></li><li><p>继承实现</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PrimaryStudent</span> <span class="keyword">extends</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(name, grade) &#123;</span><br><span class="line">        <span class="keyword">super</span>(name);</span><br><span class="line">        <span class="keyword">this</span>.grade = grade;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    myGrade() &#123;</span><br><span class="line">        alert(<span class="string">'I am at grade '</span> + <span class="keyword">this</span>.grade);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>class继承就是为了简化原型继承，但是可能会碰到不兼容的情况，可以使用<code>Babel</code>工具进行<code>class</code>继承到传统原型继承的转换。</p></blockquote></li></ul><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://www.liaoxuefeng.com/" target="_blank" rel="noopener">https://www.liaoxuefeng.com/</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;全文共&lt;code&gt;1107&lt;/code&gt;字，推荐阅读时间&lt;code&gt;7~10&lt;/code&gt;分钟。&lt;/p&gt;
    
    </summary>
    
    
      <category term="Web" scheme="http://yoursite.com/categories/Web/"/>
    
      <category term="JavaScript" scheme="http://yoursite.com/categories/JavaScript/"/>
    
    
  </entry>
  
</feed>
